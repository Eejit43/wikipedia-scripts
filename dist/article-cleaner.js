// <nowiki>
// Note: This script was compiled and minified from TypeScript. For a more readable version, see https://github.com/Eejit43/wikipedia-scripts/blob/main/scripts/article-cleaner.ts

"use strict";(()=>{mw.config.get("wgNamespaceNumber")<0||mw.config.get("wgIsProbablyEditable")&&mw.loader.using(["mediawiki.util","jquery.textSelection"],()=>{mw.util.addCSS(`
#article-cleaner {
    display: none;
}

#content:has(#wpTextbox1) #article-cleaner {
    display: unset;
}`),mw.util.addPortletLink(mw.config.get("skin")==="minerva"?"p-navigation":"p-cactions","#","Perform article cleanup","article-cleaner").addEventListener("click",f=>{f.preventDefault();let p=$("#wpTextbox1");if(p.length===0)return mw.notify("Edit box not found!",{type:"error",autoHideSeconds:"short"});let n=p.textSelection("getContents");if(!n)return mw.notify("Edit box value not found!",{type:"error",autoHideSeconds:"short"});n=g(n),console.log(n),p.textSelection("setContents",n),p.textSelection("setSelection",{start:0}),mw.notify("Article cleanup complete!",{type:"success",autoHideSeconds:"short"})})});function g(c){let f;(e=>(e[e.Expanded=0]="Expanded",e[e.ExpandedAligned=1]="ExpandedAligned",e[e.Minimized=2]="Minimized",e[e.MinimizedSpaced=3]="MinimizedSpaced"))(f||={});class p{location;isNested=!1;fullText;fullTextEscaped;name;parameters=[];subTemplates=[];pipeEscapeRegexes=[/(\[\[[^\]]*?)\|(.*?]])/g,/(<!--.*?)\|(.*?-->)/g,/(<nowiki>.*?)\|(.*?<\/nowiki>)/g];defaultTemplateStyles={1:["infobox","speciesbox","taxobox","automatic taxobox","osm location map","motorsport season"],2:["coord","start date","end date"]};constructor(t){this.location={start:t}}parse(){this.fullText=c.slice(this.location.start,this.location.end),this.fullTextEscaped=this.fullText;for(let e of this.subTemplates)e.parse(),this.fullTextEscaped=this.fullTextEscaped.replace(e.fullText,"");let t=this.fullTextEscaped.slice(2,-2).trim();for(let e of this.pipeEscapeRegexes)for(;e.test(t);)t=t.replaceAll(e,"$1$2");let i=t.split("|").map(e=>e.replaceAll("","|").trim());this.name=i.shift();let r=i.map(e=>{let l=e.indexOf("=");return l===-1?{key:null,value:e.trim()}:{key:e.slice(0,l).trim(),value:e.slice(l+1).trim()}});this.parameters=r}getStyle(){for(let[t,i]of Object.entries(this.defaultTemplateStyles))for(let r of i)if(this.name.toLowerCase().startsWith(r))return Number.parseInt(t)}format(){this.fullText||this.parse();let t=this.getStyle();if(t===void 0)return this.fullText;let i=[`{{${this.name}`];if(t===0||t===1){let e=0;t===1&&(e=Math.max(...this.parameters.map(l=>l.key?.length??0)));for(let l of this.parameters)i.push(`| ${l.key?`${l.key.padEnd(e)} = `:""}${l.value}`)}else for(let e of this.parameters)e.value&&i.push(`|${e.key?`${e.key}=`:""}${e.value}`);i.push("}}"),i.length===2?(i[0]+="}}",i.pop()):t===3&&(i[i.length-2]+="}}",i.pop());let r=i.join(t===0||t===1?`
`:t===3?" ":"");for(let e of this.subTemplates)console.log(r,e.format()),r=r.replace("",e.format());return r}}let n=[],u=[],m=!1,d=!1,h=!1,a=0;function o(s,t=!0){let i=c.slice(a,a+s.length)===s;return i&&t&&(a+=s.length),i}for(;a<c.length;)if(o("<nowiki>"))d=!0;else if(o("</nowiki>"))d=!1;else if(o("<!--"))h=!0;else if(o("-->"))h=!1;else if(!d&&!h)if(o("[["))m=!0;else if(m&&o("]]"))m=!1;else if(o("{{")){let s=new p(a-2);u.length>0&&(s.isNested=!0,u.at(-1)?.subTemplates.push(s)),u.push(s)}else if(o("}}")){let s=u.pop();if(!s)continue;s.location.end=a,n.push(s)}else a++;else a++;let x=c;for(let s of n)s.isNested||(s.parse(),x=x.replace(s.fullText,s.format()));return x}})();

// </nowiki>
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vc2NyaXB0cy9hcnRpY2xlLWNsZWFuZXIudHMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbIigoKSA9PiB7XG4gICAgaWYgKG13LmNvbmZpZy5nZXQoJ3dnTmFtZXNwYWNlTnVtYmVyJykgPCAwKSByZXR1cm47IC8vIERvbid0IHJ1biBpbiB2aXJ0dWFsIG5hbWVzcGFjZXNcbiAgICBpZiAoIW13LmNvbmZpZy5nZXQoJ3dnSXNQcm9iYWJseUVkaXRhYmxlJykpIHJldHVybjsgLy8gRG9uJ3QgcnVuIGlmIHVzZXIgY2FuJ3QgZWRpdCBwYWdlXG5cbiAgICBtdy5sb2FkZXIudXNpbmcoWydtZWRpYXdpa2kudXRpbCcsICdqcXVlcnkudGV4dFNlbGVjdGlvbiddLCAoKSA9PiB7XG4gICAgICAgIG13LnV0aWwuYWRkQ1NTKGBcbiNhcnRpY2xlLWNsZWFuZXIge1xuICAgIGRpc3BsYXk6IG5vbmU7XG59XG5cbiNjb250ZW50Omhhcygjd3BUZXh0Ym94MSkgI2FydGljbGUtY2xlYW5lciB7XG4gICAgZGlzcGxheTogdW5zZXQ7XG59YCk7XG5cbiAgICAgICAgY29uc3QgbGluayA9IG13LnV0aWwuYWRkUG9ydGxldExpbmsoXG4gICAgICAgICAgICBtdy5jb25maWcuZ2V0KCdza2luJykgPT09ICdtaW5lcnZhJyA/ICdwLW5hdmlnYXRpb24nIDogJ3AtY2FjdGlvbnMnLFxuICAgICAgICAgICAgJyMnLFxuICAgICAgICAgICAgJ1BlcmZvcm0gYXJ0aWNsZSBjbGVhbnVwJyxcbiAgICAgICAgICAgICdhcnRpY2xlLWNsZWFuZXInLFxuICAgICAgICApITtcblxuICAgICAgICBsaW5rLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICBjb25zdCBlZGl0Qm94ID0gJCgnI3dwVGV4dGJveDEnKTtcbiAgICAgICAgICAgIGlmIChlZGl0Qm94Lmxlbmd0aCA9PT0gMCkgcmV0dXJuIG13Lm5vdGlmeSgnRWRpdCBib3ggbm90IGZvdW5kIScsIHsgdHlwZTogJ2Vycm9yJywgYXV0b0hpZGVTZWNvbmRzOiAnc2hvcnQnIH0pO1xuXG4gICAgICAgICAgICBsZXQgdGV4dCA9IGVkaXRCb3gudGV4dFNlbGVjdGlvbignZ2V0Q29udGVudHMnKTtcbiAgICAgICAgICAgIGlmICghdGV4dCkgcmV0dXJuIG13Lm5vdGlmeSgnRWRpdCBib3ggdmFsdWUgbm90IGZvdW5kIScsIHsgdHlwZTogJ2Vycm9yJywgYXV0b0hpZGVTZWNvbmRzOiAnc2hvcnQnIH0pO1xuXG4gICAgICAgICAgICB0ZXh0ID0gZm9ybWF0VGVtcGxhdGVzKHRleHQpO1xuXG4gICAgICAgICAgICBjb25zb2xlLmxvZyh0ZXh0KTtcblxuICAgICAgICAgICAgZWRpdEJveC50ZXh0U2VsZWN0aW9uKCdzZXRDb250ZW50cycsIHRleHQpO1xuXG4gICAgICAgICAgICBlZGl0Qm94LnRleHRTZWxlY3Rpb24oJ3NldFNlbGVjdGlvbicsIHsgc3RhcnQ6IDAgfSk7XG5cbiAgICAgICAgICAgIG13Lm5vdGlmeSgnQXJ0aWNsZSBjbGVhbnVwIGNvbXBsZXRlIScsIHsgdHlwZTogJ3N1Y2Nlc3MnLCBhdXRvSGlkZVNlY29uZHM6ICdzaG9ydCcgfSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSkoKTtcblxuLyoqXG4gKiBGb3JtYXRzIHRlbXBsYXRlIHNwYWNpbmcgaW4gYW4gYXJ0aWNsZSdzIGNvbnRlbnQuXG4gKiBAcGFyYW0gY29udGVudCBUaGUgYXJ0aWNsZSBjb250ZW50IHRvIGZvcm1hdC5cbiAqL1xuZnVuY3Rpb24gZm9ybWF0VGVtcGxhdGVzKGNvbnRlbnQ6IHN0cmluZykge1xuICAgIGVudW0gRm9ybWF0U3R5bGUge1xuICAgICAgICBFeHBhbmRlZCxcbiAgICAgICAgRXhwYW5kZWRBbGlnbmVkLFxuICAgICAgICBNaW5pbWl6ZWQsXG4gICAgICAgIE1pbmltaXplZFNwYWNlZCxcbiAgICB9XG5cbiAgICBjbGFzcyBUZW1wbGF0ZSB7XG4gICAgICAgIHB1YmxpYyBsb2NhdGlvbjogeyBzdGFydDogbnVtYmVyOyBlbmQ/OiBudW1iZXIgfTtcbiAgICAgICAgcHVibGljIGlzTmVzdGVkID0gZmFsc2U7XG5cbiAgICAgICAgcHVibGljIGZ1bGxUZXh0Pzogc3RyaW5nO1xuICAgICAgICBwcml2YXRlIGZ1bGxUZXh0RXNjYXBlZD86IHN0cmluZztcbiAgICAgICAgcHJpdmF0ZSBuYW1lPzogc3RyaW5nO1xuICAgICAgICBwcml2YXRlIHBhcmFtZXRlcnM6IHsga2V5OiBzdHJpbmcgfCBudWxsOyB2YWx1ZTogc3RyaW5nIH1bXSA9IFtdO1xuICAgICAgICBwdWJsaWMgc3ViVGVtcGxhdGVzOiBUZW1wbGF0ZVtdID0gW107XG5cbiAgICAgICAgcHJpdmF0ZSBwaXBlRXNjYXBlUmVnZXhlcyA9IFsvKFxcW1xcW1teXFxdXSo/KVxcfCguKj9dXSkvZywgLyg8IS0tLio/KVxcfCguKj8tLT4pL2csIC8oPG5vd2lraT4uKj8pXFx8KC4qPzxcXC9ub3dpa2k+KS9nXTtcblxuICAgICAgICBwcml2YXRlIGRlZmF1bHRUZW1wbGF0ZVN0eWxlcyA9IHtcbiAgICAgICAgICAgIFtGb3JtYXRTdHlsZS5FeHBhbmRlZEFsaWduZWRdOiBbXG4gICAgICAgICAgICAgICAgJ2luZm9ib3gnLFxuICAgICAgICAgICAgICAgICdzcGVjaWVzYm94JyxcbiAgICAgICAgICAgICAgICAndGF4b2JveCcsXG4gICAgICAgICAgICAgICAgJ2F1dG9tYXRpYyB0YXhvYm94JyxcbiAgICAgICAgICAgICAgICAnb3NtIGxvY2F0aW9uIG1hcCcsXG4gICAgICAgICAgICAgICAgJ21vdG9yc3BvcnQgc2Vhc29uJyxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBbRm9ybWF0U3R5bGUuTWluaW1pemVkXTogWydjb29yZCcsICdzdGFydCBkYXRlJywgJ2VuZCBkYXRlJ10sXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3RydWN0b3Ioc3RhcnRMb2NhdGlvbjogbnVtYmVyKSB7XG4gICAgICAgICAgICB0aGlzLmxvY2F0aW9uID0geyBzdGFydDogc3RhcnRMb2NhdGlvbiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcHVibGljIHBhcnNlKCkge1xuICAgICAgICAgICAgdGhpcy5mdWxsVGV4dCA9IGNvbnRlbnQuc2xpY2UodGhpcy5sb2NhdGlvbi5zdGFydCwgdGhpcy5sb2NhdGlvbi5lbmQpO1xuICAgICAgICAgICAgdGhpcy5mdWxsVGV4dEVzY2FwZWQgPSB0aGlzLmZ1bGxUZXh0O1xuXG4gICAgICAgICAgICBmb3IgKGNvbnN0IHN1YlRlbXBsYXRlIG9mIHRoaXMuc3ViVGVtcGxhdGVzKSB7XG4gICAgICAgICAgICAgICAgc3ViVGVtcGxhdGUucGFyc2UoKTtcblxuICAgICAgICAgICAgICAgIHRoaXMuZnVsbFRleHRFc2NhcGVkID0gdGhpcy5mdWxsVGV4dEVzY2FwZWQucmVwbGFjZShzdWJUZW1wbGF0ZS5mdWxsVGV4dCEsICdcXHUwMDAyJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxldCB0cmltbWVkSW5uZXJUZXh0ID0gdGhpcy5mdWxsVGV4dEVzY2FwZWQuc2xpY2UoMiwgLTIpLnRyaW0oKTtcblxuICAgICAgICAgICAgZm9yIChjb25zdCBwaXBlRXNjYXBlUmVnZXggb2YgdGhpcy5waXBlRXNjYXBlUmVnZXhlcylcbiAgICAgICAgICAgICAgICB3aGlsZSAocGlwZUVzY2FwZVJlZ2V4LnRlc3QodHJpbW1lZElubmVyVGV4dCkpXG4gICAgICAgICAgICAgICAgICAgIHRyaW1tZWRJbm5lclRleHQgPSB0cmltbWVkSW5uZXJUZXh0LnJlcGxhY2VBbGwocGlwZUVzY2FwZVJlZ2V4LCAnJDFcXHUwMDAxJDInKTtcblxuICAgICAgICAgICAgY29uc3QgcGFyYW1ldGVycyA9IHRyaW1tZWRJbm5lclRleHQuc3BsaXQoJ3wnKS5tYXAoKHBhcmFtZXRlcikgPT4gcGFyYW1ldGVyLnJlcGxhY2VBbGwoJ1xcdTAwMDEnLCAnfCcpLnRyaW0oKSk7XG5cbiAgICAgICAgICAgIHRoaXMubmFtZSA9IHBhcmFtZXRlcnMuc2hpZnQoKTtcblxuICAgICAgICAgICAgY29uc3Qgc3BsaXRQYXJhbWV0ZXJzID0gcGFyYW1ldGVycy5tYXAoKHBhcmFtZXRlcnMpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBlcXVhbHNMb2NhdGlvbiA9IHBhcmFtZXRlcnMuaW5kZXhPZignPScpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGVxdWFsc0xvY2F0aW9uID09PSAtMSkgcmV0dXJuIHsga2V5OiBudWxsLCB2YWx1ZTogcGFyYW1ldGVycy50cmltKCkgfTtcblxuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIGtleTogcGFyYW1ldGVycy5zbGljZSgwLCBlcXVhbHNMb2NhdGlvbikudHJpbSgpLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogcGFyYW1ldGVycy5zbGljZShlcXVhbHNMb2NhdGlvbiArIDEpLnRyaW0oKSxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMucGFyYW1ldGVycyA9IHNwbGl0UGFyYW1ldGVycztcbiAgICAgICAgfVxuXG4gICAgICAgIHByaXZhdGUgZ2V0U3R5bGUoKSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IFtmb3JtYXRTdHlsZSwgdGVtcGxhdGVQcmVmaXhlc10gb2YgT2JqZWN0LmVudHJpZXModGhpcy5kZWZhdWx0VGVtcGxhdGVTdHlsZXMpKVxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgdGVtcGxhdGVQcmVmaXggb2YgdGVtcGxhdGVQcmVmaXhlcylcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubmFtZSEudG9Mb3dlckNhc2UoKS5zdGFydHNXaXRoKHRlbXBsYXRlUHJlZml4KSkgcmV0dXJuIE51bWJlci5wYXJzZUludChmb3JtYXRTdHlsZSkgYXMgRm9ybWF0U3R5bGU7XG4gICAgICAgIH1cblxuICAgICAgICBwdWJsaWMgZm9ybWF0KCkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmZ1bGxUZXh0KSB0aGlzLnBhcnNlKCk7XG5cbiAgICAgICAgICAgIGNvbnN0IHN0eWxlID0gdGhpcy5nZXRTdHlsZSgpO1xuICAgICAgICAgICAgaWYgKHN0eWxlID09PSB1bmRlZmluZWQpIHJldHVybiB0aGlzLmZ1bGxUZXh0ITtcblxuICAgICAgICAgICAgY29uc3Qgb3V0cHV0ID0gW2B7eyR7dGhpcy5uYW1lfWBdO1xuXG4gICAgICAgICAgICBpZiAoc3R5bGUgPT09IEZvcm1hdFN0eWxlLkV4cGFuZGVkIHx8IHN0eWxlID09PSBGb3JtYXRTdHlsZS5FeHBhbmRlZEFsaWduZWQpIHtcbiAgICAgICAgICAgICAgICBsZXQgcmVxdWlyZWRLZXlMZW5ndGggPSAwO1xuXG4gICAgICAgICAgICAgICAgaWYgKHN0eWxlID09PSBGb3JtYXRTdHlsZS5FeHBhbmRlZEFsaWduZWQpXG4gICAgICAgICAgICAgICAgICAgIHJlcXVpcmVkS2V5TGVuZ3RoID0gTWF0aC5tYXgoLi4udGhpcy5wYXJhbWV0ZXJzLm1hcCgocGFyYW1ldGVyKSA9PiBwYXJhbWV0ZXIua2V5Py5sZW5ndGggPz8gMCkpO1xuXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBwYXJhbWV0ZXIgb2YgdGhpcy5wYXJhbWV0ZXJzKVxuICAgICAgICAgICAgICAgICAgICBvdXRwdXQucHVzaChgfCAke3BhcmFtZXRlci5rZXkgPyBgJHtwYXJhbWV0ZXIua2V5LnBhZEVuZChyZXF1aXJlZEtleUxlbmd0aCl9ID0gYCA6ICcnfSR7cGFyYW1ldGVyLnZhbHVlfWApO1xuICAgICAgICAgICAgfSBlbHNlXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBwYXJhbWV0ZXIgb2YgdGhpcy5wYXJhbWV0ZXJzKVxuICAgICAgICAgICAgICAgICAgICBpZiAocGFyYW1ldGVyLnZhbHVlKSBvdXRwdXQucHVzaChgfCR7cGFyYW1ldGVyLmtleSA/IGAke3BhcmFtZXRlci5rZXl9PWAgOiAnJ30ke3BhcmFtZXRlci52YWx1ZX1gKTtcblxuICAgICAgICAgICAgb3V0cHV0LnB1c2goJ319Jyk7XG5cbiAgICAgICAgICAgIGlmIChvdXRwdXQubGVuZ3RoID09PSAyKSB7XG4gICAgICAgICAgICAgICAgb3V0cHV0WzBdICs9ICd9fSc7XG5cbiAgICAgICAgICAgICAgICBvdXRwdXQucG9wKCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHN0eWxlID09PSBGb3JtYXRTdHlsZS5NaW5pbWl6ZWRTcGFjZWQpIHtcbiAgICAgICAgICAgICAgICBvdXRwdXRbb3V0cHV0Lmxlbmd0aCAtIDJdICs9ICd9fSc7XG5cbiAgICAgICAgICAgICAgICBvdXRwdXQucG9wKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxldCBqb2luZWRPdXRwdXQgPSBvdXRwdXQuam9pbihcbiAgICAgICAgICAgICAgICBzdHlsZSA9PT0gRm9ybWF0U3R5bGUuRXhwYW5kZWQgfHwgc3R5bGUgPT09IEZvcm1hdFN0eWxlLkV4cGFuZGVkQWxpZ25lZFxuICAgICAgICAgICAgICAgICAgICA/ICdcXG4nXG4gICAgICAgICAgICAgICAgICAgIDogc3R5bGUgPT09IEZvcm1hdFN0eWxlLk1pbmltaXplZFNwYWNlZFxuICAgICAgICAgICAgICAgICAgICAgID8gJyAnXG4gICAgICAgICAgICAgICAgICAgICAgOiAnJyxcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGZvciAoY29uc3Qgc3ViVGVtcGxhdGUgb2YgdGhpcy5zdWJUZW1wbGF0ZXMpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhqb2luZWRPdXRwdXQsIHN1YlRlbXBsYXRlLmZvcm1hdCgpKTtcbiAgICAgICAgICAgICAgICBqb2luZWRPdXRwdXQgPSBqb2luZWRPdXRwdXQucmVwbGFjZSgnXFx1MDAwMicsIHN1YlRlbXBsYXRlLmZvcm1hdCgpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGpvaW5lZE91dHB1dDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IGFsbFRlbXBsYXRlczogVGVtcGxhdGVbXSA9IFtdO1xuXG4gICAgY29uc3QgaW5zaWRlVGVtcGxhdGVzOiBUZW1wbGF0ZVtdID0gW107XG4gICAgbGV0IGlzSW5zaWRlTGluayA9IGZhbHNlO1xuICAgIGxldCBpc0luc2lkZU5vd2lraSA9IGZhbHNlO1xuICAgIGxldCBpc0luc2lkZUNvbW1lbnQgPSBmYWxzZTtcblxuICAgIGxldCBjdXJyZW50TG9jYXRpb24gPSAwO1xuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIHRoZSBjb250ZW50IGZvbGxvd2luZyB0aGUgY3VycmVudCBsb2NhdGlvbiBtYXRjaGVzIHRoZSBkZXNpcmVkIHN0cmluZy5cbiAgICAgKiBAcGFyYW0gZGVzaXJlZFN0cmluZyBUaGUgc3RyaW5nIHRvIHNlYXJjaCBmb3IuXG4gICAgICogQHBhcmFtIHNob3VsZEluY3JlbWVudCBXaGV0aGVyIHRvIGluY3JlbWVudCB0aGUgY3VycmVudCBsb2NhdGlvbiBpZiB0aGUgc3RyaW5nIGlzIGZvdW5kLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGlzQXRTdHJpbmcoZGVzaXJlZFN0cmluZzogc3RyaW5nLCBzaG91bGRJbmNyZW1lbnQgPSB0cnVlKSB7XG4gICAgICAgIGNvbnN0IGlzQXRTdHJpbmcgPSBjb250ZW50LnNsaWNlKGN1cnJlbnRMb2NhdGlvbiwgY3VycmVudExvY2F0aW9uICsgZGVzaXJlZFN0cmluZy5sZW5ndGgpID09PSBkZXNpcmVkU3RyaW5nO1xuXG4gICAgICAgIGlmIChpc0F0U3RyaW5nICYmIHNob3VsZEluY3JlbWVudCkgY3VycmVudExvY2F0aW9uICs9IGRlc2lyZWRTdHJpbmcubGVuZ3RoO1xuXG4gICAgICAgIHJldHVybiBpc0F0U3RyaW5nO1xuICAgIH1cblxuICAgIHdoaWxlIChjdXJyZW50TG9jYXRpb24gPCBjb250ZW50Lmxlbmd0aClcbiAgICAgICAgaWYgKGlzQXRTdHJpbmcoJzxub3dpa2k+JykpIGlzSW5zaWRlTm93aWtpID0gdHJ1ZTtcbiAgICAgICAgZWxzZSBpZiAoaXNBdFN0cmluZygnPC9ub3dpa2k+JykpIGlzSW5zaWRlTm93aWtpID0gZmFsc2U7XG4gICAgICAgIGVsc2UgaWYgKGlzQXRTdHJpbmcoJzwhLS0nKSkgaXNJbnNpZGVDb21tZW50ID0gdHJ1ZTtcbiAgICAgICAgZWxzZSBpZiAoaXNBdFN0cmluZygnLS0+JykpIGlzSW5zaWRlQ29tbWVudCA9IGZhbHNlO1xuICAgICAgICBlbHNlIGlmICghaXNJbnNpZGVOb3dpa2kgJiYgIWlzSW5zaWRlQ29tbWVudClcbiAgICAgICAgICAgIGlmIChpc0F0U3RyaW5nKCdbWycpKSBpc0luc2lkZUxpbmsgPSB0cnVlO1xuICAgICAgICAgICAgZWxzZSBpZiAoaXNJbnNpZGVMaW5rICYmIGlzQXRTdHJpbmcoJ11dJykpIGlzSW5zaWRlTGluayA9IGZhbHNlO1xuICAgICAgICAgICAgZWxzZSBpZiAoaXNBdFN0cmluZygne3snKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRlbXBsYXRlID0gbmV3IFRlbXBsYXRlKGN1cnJlbnRMb2NhdGlvbiAtIDIpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGluc2lkZVRlbXBsYXRlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlLmlzTmVzdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgaW5zaWRlVGVtcGxhdGVzLmF0KC0xKT8uc3ViVGVtcGxhdGVzLnB1c2godGVtcGxhdGUpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGluc2lkZVRlbXBsYXRlcy5wdXNoKHRlbXBsYXRlKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNBdFN0cmluZygnfX0nKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGxhc3RUZW1wbGF0ZSA9IGluc2lkZVRlbXBsYXRlcy5wb3AoKTtcbiAgICAgICAgICAgICAgICBpZiAoIWxhc3RUZW1wbGF0ZSkgY29udGludWU7XG5cbiAgICAgICAgICAgICAgICBsYXN0VGVtcGxhdGUubG9jYXRpb24uZW5kID0gY3VycmVudExvY2F0aW9uO1xuXG4gICAgICAgICAgICAgICAgYWxsVGVtcGxhdGVzLnB1c2gobGFzdFRlbXBsYXRlKTtcbiAgICAgICAgICAgIH0gZWxzZSBjdXJyZW50TG9jYXRpb24rKztcbiAgICAgICAgZWxzZSBjdXJyZW50TG9jYXRpb24rKztcblxuICAgIGxldCBuZXdDb250ZW50ID0gY29udGVudDtcblxuICAgIGZvciAoY29uc3QgdGVtcGxhdGUgb2YgYWxsVGVtcGxhdGVzKVxuICAgICAgICBpZiAoIXRlbXBsYXRlLmlzTmVzdGVkKSB7XG4gICAgICAgICAgICB0ZW1wbGF0ZS5wYXJzZSgpO1xuXG4gICAgICAgICAgICBuZXdDb250ZW50ID0gbmV3Q29udGVudC5yZXBsYWNlKHRlbXBsYXRlLmZ1bGxUZXh0ISwgdGVtcGxhdGUuZm9ybWF0KCkpO1xuICAgICAgICB9XG5cbiAgICByZXR1cm4gbmV3Q29udGVudDtcbn1cbiJdLAogICJtYXBwaW5ncyI6ICI7OzttQkFDUSxHQUFHLE9BQU8sSUFBSSxtQkFBbUIsRUFBSSxHQUNwQyxHQUFHLE9BQU8sSUFBSSxzQkFBc0IsR0FFekMsR0FBRyxPQUFPLE1BQU0sQ0FBQyxpQkFBa0Isc0JBQXNCLEVBQUcsSUFBTSxDQUM5RCxHQUFHLEtBQUssT0FBTztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLEVBT3JCLEVBRW1CLEdBQUcsS0FBSyxlQUNqQixHQUFHLE9BQU8sSUFBSSxNQUFNLElBQU0sVUFBWSxlQUFpQixhQUN2RCxJQUNBLDBCQUNBLGlCQUNKLEVBRUssaUJBQWlCLFFBQVVBLEdBQVUsQ0FDdENBLEVBQU0sZUFBZSxFQUVyQixJQUFNQyxFQUFVLEVBQUUsYUFBYSxFQUMvQixHQUFJQSxFQUFRLFNBQVcsRUFBRyxPQUFPLEdBQUcsT0FBTyxzQkFBdUIsQ0FBRSxLQUFNLFFBQVMsZ0JB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RUFBVyxXQUFXLEVBQUdILEVBQWlCLFdBQzFDRyxFQUFXLE1BQU0sRUFBR0YsRUFBa0IsV0FDdENFLEVBQVcsS0FBSyxFQUFHRixFQUFrQixXQUNyQyxDQUFDRCxHQUFrQixDQUFDQyxFQUN6QixHQUFJRSxFQUFXLElBQUksRUFBR0osRUFBZSxXQUM1QkEsR0FBZ0JJLEVBQVcsSUFBSSxFQUFHSixFQUFlLFdBQ2pESSxFQUFXLElBQUksRUFBRyxDQUN2QixJQUFNRyxFQUFXLElBQUl6QixFQUFTcUIsRUFBa0IsQ0FBQyxFQUU3Q0osRUFBZ0IsT0FBUyxJQUN6QlEsRUFBUyxTQUFXLEdBQ3BCUixFQUFnQixHQUFHLEVBQUUsR0FBRyxhQUFhLEtBQUtRLENBQVEsR0FHdERSLEVBQWdCLEtBQUtRLENBQVEsQ0FDakMsU0FBV0gsRUFBVyxJQUFJLEVBQUcsQ0FDekIsSUFBTUksRUFBZVQsRUFBZ0IsSUFBSSxFQUN6QyxHQUFJLENBQUNTLEVBQWMsU0FFbkJBLEVBQWEsU0FBUyxJQUFNTCxFQUU1QkwsRUFBYSxLQUFLVSxDQUFZLENBQ2xDLE1BQU9MLFNBQ05BLElBRVQsSUFBSU0sRUFBYTdCLEVBRWpCLFFBQVcyQixLQUFZVCxFQUNkUyxFQUFTLFdBQ1ZBLEVBQVMsTUFBTSxFQUVmRSxFQUFhQSxFQUFXLFFBQVFGLEVBQVMsU0FBV0EsRUFBUyxPQUFPLENBQUMsR0FHN0UsT0FBT0UsQ0FDWCIsCiAgIm5hbWVzIjogWyJldmVudCIsICJlZGl0Qm94IiwgInRleHQiLCAiZm9ybWF0VGVtcGxhdGVzIiwgImNvbnRlbnQiLCAiRm9ybWF0U3R5bGUiLCAiVGVtcGxhdGUiLCAic3RhcnRMb2NhdGlvbiIsICJzdWJUZW1wbGF0ZSIsICJ0cmltbWVkSW5uZXJUZXh0IiwgInBpcGVFc2NhcGVSZWdleCIsICJwYXJhbWV0ZXJzIiwgInBhcmFtZXRlciIsICJzcGxpdFBhcmFtZXRlcnMiLCAiZXF1YWxzTG9jYXRpb24iLCAiZm9ybWF0U3R5bGUiLCAidGVtcGxhdGVQcmVmaXhlcyIsICJ0ZW1wbGF0ZVByZWZpeCIsICJzdHlsZSIsICJvdXRwdXQiLCAicmVxdWlyZWRLZXlMZW5ndGgiLCAiam9pbmVkT3V0cHV0IiwgImFsbFRlbXBsYXRlcyIsICJpbnNpZGVUZW1wbGF0ZXMiLCAiaXNJbnNpZGVMaW5rIiwgImlzSW5zaWRlTm93aWtpIiwgImlzSW5zaWRlQ29tbWVudCIsICJjdXJyZW50TG9jYXRpb24iLCAiaXNBdFN0cmluZyIsICJkZXNpcmVkU3RyaW5nIiwgInNob3VsZEluY3JlbWVudCIsICJ0ZW1wbGF0ZSIsICJsYXN0VGVtcGxhdGUiLCAibmV3Q29udGVudCJdCn0K
