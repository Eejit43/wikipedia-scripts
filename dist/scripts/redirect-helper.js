"use strict";
mw.loader.using(["mediawiki.util", "oojs-ui-core", "oojs-ui-widgets", "oojs-ui.styles.icons-content", "oojs-ui.styles.icons-editing-core"], async () => {
  if (mw.config.get("wgNamespaceNumber") < 0)
    return;
  if (!mw.config.get("wgIsProbablyEditable"))
    return;
  if (mw.config.get("wgAction") !== "view" || !mw.config.get("wgIsArticle"))
    return;
  if (mw.util.getParamValue("oldid") || mw.config.get("wgDiffOldId"))
    return;
  const contentText = document.querySelector("#mw-content-text");
  if (!contentText)
    return mw.notify("Failed to find content text element!", { type: "error" });
  const redirectTemplates = JSON.parse((await new mw.Api().get({ action: "query", formatversion: 2, prop: "revisions", rvprop: "content", rvslots: "*", titles: "User:Eejit43/scripts/redirect-helper.json" })).query.pages?.[0]?.revisions?.[0]?.slots?.main?.content || "[]");
  const pageTitle = mw.config.get("wgPageName");
  const pageTitleParsed = mw.Title.newFromText(pageTitle);
  if (!pageTitleParsed)
    return mw.notify("Failed to parse page title!", { type: "error" });
  const pageInfo = await new mw.Api().get({ action: "query", formatversion: 2, prop: "info", titles: pageTitle });
  if (pageInfo.query.pages[0].missing) {
    const button = new OO.ui.ButtonWidget({ label: "Create redirect", icon: "articleRedirect", flags: ["progressive"] });
    button.$element[0].style.marginBottom = "10px";
    button.on("click", () => {
      button.$element[0].remove();
      showRedirectInfo(false);
    });
    contentText.prepend(button.$element[0]);
  } else if (pageInfo.query.pages[0].redirect)
    showRedirectInfo(true);
  else {
    const portletLink = mw.util.addPortletLink(mw.config.get("skin") === "minerva" ? "p-tb" : "p-cactions", "#", "Redirect page", "redirect-helper");
    portletLink.addEventListener("click", (event) => {
      event.preventDefault();
      showRedirectInfo(false);
    });
  }
  async function showRedirectInfo(exists) {
    const editorBox = new OO.ui.PanelLayout({ padded: true, expanded: false, framed: true });
    editorBox.$element[0].style.backgroundColor = "#95d4bc";
    editorBox.$element[0].style.width = "700px";
    editorBox.$element[0].style.maxWidth = "calc(100% - 50px)";
    editorBox.$element[0].style.marginLeft = "auto";
    editorBox.$element[0].style.marginRight = "auto";
    editorBox.$element[0].style.marginBottom = "20px";
    let syncWithMainButton;
    if (pageTitleParsed.isTalkPage()) {
      const mainPageData = await new mw.Api().get({ action: "query", formatversion: 2, prop: "info", titles: pageTitleParsed.getSubjectPage().getPrefixedText() });
      if (mainPageData.query.pages[0].redirect) {
        const mainPageContent = (await new mw.Api().get({ action: "query", formatversion: 2, prop: "revisions", rvprop: "content", rvslots: "*", titles: pageTitleParsed.getSubjectPage().getPrefixedText() })).query.pages[0].revisions[0].slots.main.content.trim();
        syncWithMainButton = new OO.ui.ButtonWidget({ label: "Sync with main page", icon: "link", flags: ["progressive"] });
        syncWithMainButton.on("click", () => {
          const target = /^#redirect:?\s*\[\[\s*([^[\]{|}]+?)\s*(?:\|[^[\]{|}]+?)?]]\s*/i.exec(mainPageContent)?.[1];
          if (!target)
            return mw.notify("Failed to parse main page content!", { type: "error" });
          redirectInput.setValue(mw.Title.newFromText(target)?.getTalkPage()?.toString() ?? "");
          const fromMove = ["R from move", ...redirectTemplates["R from move"]].some((tagOrRedirect) => new RegExp(`{{\\s*[${tagOrRedirect[0].toLowerCase()}${tagOrRedirect[0]}]${tagOrRedirect.slice(1)}\\s*(\\||}})`).test(mainPageContent));
          if (fromMove)
            tagSelect.setValue(["R from move"]);
        });
      }
    }
    class RedirectInputWidget extends OO.ui.TextInputWidget {
      constructor(config) {
        super(config);
        this.getLookupRequest = () => {
          const value = this.getValue();
          const deferred = $.Deferred();
          if (!value)
            deferred.resolve([]);
          else if (value.includes("#")) {
            const title = value.split("#")[0];
            new mw.Api().get({ action: "parse", page: title, prop: "sections", redirects: "1" }).catch(() => null).then((result) => {
              if (result) {
                const matchedSections = result.parse.sections.filter((section) => section.line.toLowerCase().startsWith(value.split("#")[1].toLowerCase()));
                deferred.resolve(matchedSections.map((section) => ({ data: `${result.parse.title}#${section.line}`, label: `${result.parse.title}#${section.line}` })));
              } else
                deferred.resolve([]);
            });
          } else {
            const parsedTitle = mw.Title.newFromText(value);
            new mw.Api().get({ action: "query", formatversion: 2, gaplimit: 20, gapnamespace: parsedTitle?.namespace ?? 0, gapprefix: parsedTitle?.title ?? value, generator: "allpages", prop: "info|pageprops" }).catch(() => null).then((result) => {
              if (result)
                deferred.resolve(
                  result.query?.pages ? result.query.pages.filter((page) => page.title !== pageTitleParsed.toString()).map((page) => ({ data: page.title, label: new OO.ui.HtmlSnippet(`${page.title}${page.pageprops && "disambiguation" in page.pageprops ? " <i>(disambiguation)</i>" : ""}${"redirect" in page ? " <i>(redirect)</i>" : ""}`) })) : []
                );
              else
                deferred.resolve([]);
            });
          }
          return deferred.promise({ abort() {
          } });
        };
        this.getLookupCacheDataFromResponse = (response) => response ?? [];
        this.getLookupMenuOptionsFromData = (data) => data.map(({ data: data2, label }) => new OO.ui.MenuOptionWidget({ data: data2, label }));
        OO.ui.mixin.LookupElement.call(this, config);
      }
    }
    Object.assign(RedirectInputWidget.prototype, OO.ui.mixin.LookupElement.prototype);
    const redirectInput = new RedirectInputWidget({ placeholder: "Target page name", required: true });
    redirectInput.on("change", () => {
      let value = redirectInput.getValue();
      value = value.replace(new RegExp(`^(https?:)?/{2}?${mw.config.get("wgServer").replace(/^\/{2}/, "")}/wiki/`), "");
      value = value.replace(/^:/, "");
      if (value.length > 0) {
        redirectInput.setValue(value[0].toUpperCase() + value.slice(1).replaceAll("_", " "));
        submitButton.setDisabled(false);
      } else
        submitButton.setDisabled(true);
      updateSummary();
      submitButton.setLabel("Submit");
      needsCheck = true;
    });
    const redirectInputLayout = new OO.ui.FieldLayout(redirectInput, { label: new OO.ui.HtmlSnippet("<b>Redirect target:</b>"), align: "top" });
    const tagSelect = new OO.ui.MenuTagMultiselectWidget({
      allowArbitrary: false,
      allowReordering: false,
      options: Object.keys(redirectTemplates).map((tag) => ({ data: tag, label: tag }))
    });
    tagSelect.getMenu().filterMode = "substring";
    tagSelect.on("change", () => {
      const sortedTags = tagSelect.getValue().sort((a, b) => a.toLowerCase().localeCompare(b.toLowerCase()));
      if (tagSelect.getValue().join(";") !== sortedTags.join(";"))
        tagSelect.setValue(sortedTags);
      updateSummary();
      submitButton.setLabel("Submit");
      needsCheck = true;
    });
    const tagSelectLayout = new OO.ui.FieldLayout(tagSelect, { label: new OO.ui.HtmlSnippet("<b>Redirect categorization template(s):</b>"), align: "top" });
    const summaryInput = new OO.ui.ComboBoxInputWidget({
      options: [
        { data: "Resolve double redirect" },
        //
        { data: "Resolve self redirect" },
        { data: "Remove incorrect rcats" }
      ]
    });
    const summaryInputLayout = new OO.ui.FieldLayout(summaryInput, { label: new OO.ui.HtmlSnippet("<b>Summary:</b>"), align: "top" });
    const submitButton = new OO.ui.ButtonWidget({ label: "Submit", disabled: true, flags: ["progressive"] });
    submitButton.$element[0].style.marginBottom = "0";
    let needsCheck = true;
    submitButton.on("click", async () => {
      for (const element of [redirectInput, tagSelect, summaryInput, submitButton, syncTalkCheckbox, patrolCheckbox].filter(Boolean))
        element.setDisabled(true);
      submitButton.setLabel("Checking target validity...");
      let parsedDestination;
      const errors = [];
      if (needsCheck) {
        const destination = redirectInput.getValue().trim();
        if (!/^\s*[^[\]{|}]+\s*$/.test(destination))
          errors.push({ title: destination, message: "is not a valid page title!" });
        try {
          parsedDestination = mw.Title.newFromText(destination);
        } catch {
          if (errors.length === 0)
            errors.push({ title: destination, message: "is not a valid page title!" });
        }
        if (!parsedDestination && errors.length === 0)
          errors.push({ title: destination, message: "is not a valid page title!" });
        if (parsedDestination?.toString() === pageTitleParsed.toString())
          errors.push({ message: "cannot redirect to itself!" });
        const destinationData = await new mw.Api().get({ action: "query", formatversion: 2, prop: "pageprops", titles: destination }).catch((errorCode) => {
          if (errorCode === "missingtitle")
            errors.push({ title: destination, message: "does not exist!" });
          else
            errors.push({ title: destination, message: `was not able to be fetched from the API (${errorCode})!` });
          return null;
        });
        const destinationParseResult = await new mw.Api().get({ action: "parse", page: destination, prop: "sections", redirects: "1" });
        if (destinationParseResult.parse.redirects?.[0]) {
          const destinationRedirect = destinationParseResult.parse.redirects[0].to + (destinationParseResult.parse.redirects[0].tofragment ? `#${destinationParseResult.parse.redirects[0].tofragment}` : "");
          errors.push({ title: destination, message: `is a redirect to <a href="${mw.util.getUrl(destinationRedirect)}" target="_blank">${destinationRedirect}</a>. Retarget to that page instead, as double redirects aren't allowed.` });
        }
        if (destination.split("#").length > 1) {
          const validSection = destinationParseResult.parse.sections.find((section) => section.line === destination.split("#")[1]);
          if (validSection) {
            if (tagSelect.getValue().includes("R to anchor"))
              errors.push({ message: "is tagged as a redirect to an anchor, but it is actually a redirect to a section!" });
            if (!tagSelect.getValue().includes("R to section"))
              errors.push({ message: "is a redirect to a section, but it is not tagged with <code>{{R to section}}</code>!" });
          } else {
            const destinationContent = (await new mw.Api().get({ action: "query", formatversion: 2, prop: "revisions", rvprop: "content", rvslots: "*", titles: parsedDestination.toString() })).query.pages[0].revisions[0].slots.main.content;
            const anchors = [
              ...destinationContent.match(/(?<={{\s*?[Aa](?:nchors?|nchor for redirect|nker|NCHOR|nc)\s*?\|).+?(?=}})/g)?.map((anchor) => anchor.split("|").map((part) => part.trim()))?.flat() ?? [],
              ...destinationContent.match(/(?<={{\s*?(?:[Vv](?:isible anchors?|isanc|Anch|anchor|isibleanchor|a)|[Aa](?:nchord|chored|nchor\+)|[Tt]ext anchor)\s*?\|).+?(?=(?<!!|=)}})/g)?.map(
                (anchor) => anchor.split("|").map((part) => part.trim()).filter((part) => !/^text\s*?=/.test(part))
              )?.flat() ?? [],
              ...destinationContent.match(/(?<=id=)"?.+?(?="|>|\|)/g)?.map((anchor) => anchor.trim()) ?? []
            ];
            if (anchors.includes(destination.split("#")[1])) {
              if (tagSelect.getValue().includes("R to section"))
                errors.push({ message: "is tagged as a redirect to a section, but it is actually a redirect to an anchor!" });
              if (!tagSelect.getValue().includes("R to anchor"))
                errors.push({ message: "is a redirect to an anchor, but it is not tagged with <code>{{R from anchor}}</code>!" });
            } else
              errors.push({ message: `is a redirect to <a href="${mw.util.getUrl(destination)}" target="_blank">${destination}</a>, but that section or anchor does not exist!` });
          }
        }
        if (destination.split("#").length === 1 && (tagSelect.getValue().includes("R to section") || tagSelect.getValue().includes("R to anchor")))
          errors.push({ message: "is not a redirect to a section/anchor, but it is tagged with <code>{{R from section}}</code> or <code>{{R from anchor}}</code>!" });
        if ("disambiguation" in destinationData.query.pages[0].pageprops && !["R from ambiguous sort name", "R from ambiguous term", "R to disambiguation page", "R from incomplete disambiguation", "R from incorrect disambiguation", "R from other disambiguation"].some((template) => tagSelect.getValue().includes(template)))
          errors.push({ message: "is a redirect to a disambiguation page, but it is not tagged with a disambiguation categorization template!" });
        if (!("disambiguation" in destinationData.query.pages[0].pageprops) && ["R from ambiguous sort name", "R from ambiguous term", "R to disambiguation page", "R from incomplete disambiguation", "R from incorrect disambiguation", "R from other disambiguation"].some((template) => tagSelect.getValue().includes(template)))
          errors.push({ message: "is not a redirect to a disambiguation page, but it is tagged with a disambiguation categorization template!" });
        if (tagSelect.getValue().includes("R to disambiguation page") && !pageTitleParsed.getMainText().endsWith(" (disambiguation)"))
          errors.push({ message: 'is tagged with <code>{{R to disambiguation page}}</code>, but this title does not end with " (disambiguation)". Use <code>{{R from ambiguous term}}</code> or a similar categorization template instead!' });
        if (syncTalkCheckbox?.isSelected() && !talkData.query.pages[0].missing && !talkData.query.pages[0].redirect)
          errors.push({ title: pageTitleParsed.getTalkPage().getPrefixedText(), message: "exists, but is not a redirect!" });
      }
      if (errors.length > 0) {
        for (const element of document.querySelectorAll(".redirect-helper-warning"))
          element.remove();
        for (const { title, message } of errors) {
          const label = new OO.ui.HtmlSnippet(`${title ? `<a href="${mw.util.getUrl(title)}" target="_blank">${title}</a>` : "This page"} ${message} Click again without making changes to submit anyway.`);
          const warningMessage = new OO.ui.MessageWidget({ type: "error", classes: ["redirect-helper-warning"], inline: true, label });
          warningMessage.$element[0].style.marginTop = "8px";
          editorBox.$element[0].append(warningMessage.$element[0]);
        }
        for (const element of [redirectInput, tagSelect, summaryInput, submitButton, syncTalkCheckbox, patrolCheckbox].filter(Boolean))
          element.setDisabled(false);
        submitButton.setLabel("Submit anyway");
        needsCheck = false;
        return;
      }
      parsedDestination = mw.Title.newFromText(redirectInput.getValue());
      submitButton.setLabel(`${exists ? "Editing" : "Creating"} redirect...`);
      const output = [
        `#REDIRECT [[${redirectInput.getValue().trim()}]]`,
        //
        tagSelect.getValue().length > 0 ? `{{Redirect category shell|
${tagSelect.getValue().map((tag) => `{{${tag}${oldRedirectTagData?.[tag] ? `|${oldRedirectTagData[tag]}` : ""}}}`).join("\n")}
}}` : null,
        oldStrayText
      ].filter(Boolean).join("\n\n");
      const summary = (summaryInput.getValue() || summaryInput.$tabIndexed[0].placeholder) + " (via [[User:Eejit43/scripts/redirect-helper|redirect-helper]])";
      const result = await new mw.Api().edit(pageTitle, () => ({ text: output, summary })).catch((errorCode, { error }) => {
        if (errorCode === "nocreate-missing")
          return new mw.Api().create(pageTitle, { summary }, output).catch((errorCode2, { error: error2 }) => {
            mw.notify(`Error creating ${pageTitle}: ${error2.info} (${errorCode2})`, { type: "error" });
          });
        else {
          mw.notify(`Error editing or creating ${pageTitle}: ${error.info} (${errorCode})`, { type: "error" });
          return null;
        }
      });
      if (!result)
        return;
      mw.notify(`Redirect ${exists ? "edited" : "created"} successfully!`, { type: "success" });
      if (syncTalkCheckbox?.isSelected()) {
        submitButton.setLabel("Editing talk page...");
        const fromMove = tagSelect.getValue().includes("R from move");
        const output2 = [
          `#REDIRECT [[${parsedDestination.getTalkPage().getPrefixedText()}]]`,
          //
          fromMove ? "{{Redirect category shell|\n{{R from move}}\n}}" : null
        ].filter(Boolean).join("\n\n");
        const talkPage = pageTitleParsed.getTalkPage().getPrefixedText();
        const talkResult = await new mw.Api().edit(talkPage, () => ({ text: output2, summary: "Syncing redirect from main page (via [[User:Eejit43/scripts/redirect-helper|redirect-helper]])" })).catch((errorCode, { error }) => {
          if (errorCode === "nocreate-missing")
            return new mw.Api().create(talkPage, { summary: "Syncing redirect from main page (via [[User:Eejit43/scripts/redirect-helper|redirect-helper]])" }, output2).catch((errorCode2, { error: error2 }) => {
              mw.notify(`Error creating ${talkPage}: ${error2.info} (${errorCode2})`, { type: "error" });
            });
          else {
            mw.notify(`Error editing or creating ${talkPage}: ${error.info} (${errorCode})`, { type: "error" });
            return null;
          }
        });
        if (!talkResult)
          return;
        mw.notify("Talk page synced successfully!", { type: "success" });
      }
      if (patrolCheckbox?.isSelected()) {
        submitButton.setLabel("Patrolling redirect...");
        const patrolLink = document.querySelector(".patrollink a");
        const markReviewedButton = document.querySelector("#mwe-pt-mark-as-reviewed-button");
        if (patrolLink) {
          const patrolResult = await new mw.Api().postWithToken("patrol", { action: "patrol", rcid: new URL(patrolLink.href).searchParams.get("rcid") }).catch((errorCode, { error }) => {
            mw.notify(`Error patrolling ${pageTitle} via API: ${error.info} (${errorCode})`, { type: "error" });
            return null;
          });
          if (patrolResult)
            mw.notify("Redirect patrolled successfully!", { type: "success" });
        } else if (markReviewedButton) {
          markReviewedButton.click();
          mw.notify("Redirect patrolled successfully!", { type: "success" });
        } else
          mw.notify("Page curation toolbar not found, redirect cannot be patrolled!", { type: "error" });
      }
      submitButton.setLabel("Complete, reloading...");
      window.location.href = mw.util.getUrl(pageTitle, { redirect: "no" });
    });
    let talkData;
    let syncTalkCheckbox, syncTalkLayout;
    if (!pageTitleParsed.isTalkPage()) {
      talkData = await new mw.Api().get({ action: "query", formatversion: 2, prop: "info", titles: pageTitleParsed.getTalkPage().getPrefixedText() });
      syncTalkCheckbox = new OO.ui.CheckboxInputWidget({ selected: !!talkData.query.pages[0].redirect });
      syncTalkLayout = new OO.ui.Widget({ content: [new OO.ui.FieldLayout(syncTalkCheckbox, { label: "Sync talk page", align: "inline" })] });
      syncTalkLayout.$element[0].style.marginBottom = "0";
    }
    let shouldPromptPatrol;
    if (mw.config.get("wgNamespaceNumber") !== 0)
      shouldPromptPatrol = false;
    else if (document.querySelector(".patrollink"))
      shouldPromptPatrol = true;
    else if (document.querySelector("#mwe-pt-mark-as-reviewed-button"))
      shouldPromptPatrol = true;
    else if (document.querySelector("#mwe-pt-mark-as-unreviewed-button"))
      shouldPromptPatrol = false;
    else {
      if (!mw.config.get("wgArticleId"))
        shouldPromptPatrol = false;
      const userPermissions = await new mw.Api().get({ action: "query", meta: "userinfo", uiprop: "rights" });
      if (!userPermissions.query.userinfo.rights.includes("patrol"))
        shouldPromptPatrol = false;
      const patrolResponse = await new mw.Api().get({ action: "pagetriagelist", page_id: mw.config.get("wgArticleId") });
      if (patrolResponse.pagetriagelist.pages[0]?.user_name === mw.config.get("wgUserName"))
        shouldPromptPatrol = false;
      else if (patrolResponse.pagetriagelist.result !== "success" || patrolResponse.pagetriagelist.pages.length === 0)
        shouldPromptPatrol = false;
      else
        shouldPromptPatrol = !Number.parseInt(patrolResponse.pagetriagelist.pages[0]?.patrol_status);
    }
    let patrolCheckbox, patrolLayout;
    if (shouldPromptPatrol) {
      patrolCheckbox = new OO.ui.CheckboxInputWidget({ selected: true });
      patrolLayout = new OO.ui.Widget({ content: [new OO.ui.FieldLayout(patrolCheckbox, { label: "Mark as patrolled", align: "inline" })] });
      patrolLayout.$element[0].style.marginBottom = "0";
    }
    const submitLayout = new OO.ui.HorizontalLayout({ items: [submitButton, syncTalkLayout, patrolLayout].filter(Boolean) });
    submitLayout.$element[0].style.marginTop = "10px";
    editorBox.$element[0].append(...[syncWithMainButton?.$element?.[0], redirectInputLayout.$element[0], tagSelectLayout.$element[0], summaryInputLayout.$element[0], submitLayout.$element[0]].filter(Boolean));
    contentText.prepend(editorBox.$element[0]);
    function updateSummary() {
      const redirectValue = redirectInput.getValue().trim();
      if (!redirectValue)
        summaryInput.$tabIndexed[0].placeholder = "";
      else if (exists) {
        const targetChanged = redirectValue !== oldRedirectTarget;
        const tagsChanged = tagSelect.getValue().join(";") !== oldRedirectTags?.join(";");
        if (targetChanged && tagsChanged)
          summaryInput.$tabIndexed[0].placeholder = `Changing redirect to [[${redirectValue}]] and changing categorization templates`;
        else if (targetChanged)
          summaryInput.$tabIndexed[0].placeholder = `Changing redirect to [[${redirectValue}]]`;
        else if (tagsChanged)
          summaryInput.$tabIndexed[0].placeholder = "Changing categorization templates";
        else
          summaryInput.$tabIndexed[0].placeholder = "Redirect cleanup";
      } else
        summaryInput.$tabIndexed[0].placeholder = `Creating redirect to [[${redirectValue}]]`;
    }
    let oldRedirectTarget, oldRedirectTags, oldRedirectTagData, oldStrayText;
    if (exists) {
      const pageContent = (await new mw.Api().get({ action: "query", formatversion: 2, prop: "revisions", rvprop: "content", rvslots: "*", titles: pageTitle })).query.pages[0].revisions[0].slots.main.content.trim();
      oldRedirectTarget = /^#redirect:?\s*\[\[\s*([^[\]{|}]+?)\s*(?:\|[^[\]{|}]+?)?]]\s*/i.exec(pageContent)?.[1];
      oldRedirectTags = Object.entries(redirectTemplates).map(([tag, redirects]) => [tag, ...redirects].some((tagOrRedirect) => new RegExp(`{{\\s*[${tagOrRedirect[0].toLowerCase()}${tagOrRedirect[0]}]${tagOrRedirect.slice(1)}\\s*(\\||}})`).test(pageContent)) ? tag : null).filter(Boolean).sort((a, b) => a.toLowerCase().localeCompare(b.toLowerCase()));
      oldRedirectTagData = Object.fromEntries(
        oldRedirectTags.map((tag) => {
          const match = new RegExp(`{{\\s*(?:${[tag, ...redirectTemplates[tag]].map((tag2) => `[${tag2[0].toLowerCase()}${tag2[0]}]${tag2.slice(1)}`).join("|")})\\|?(.*?)\\s*}}`).exec(pageContent);
          return match ? [tag, match[1]] : null;
        }).filter(Boolean)
      );
      oldStrayText = [pageContent.match(/{{short description\|.*?}}/i)?.[0], pageContent.match(/{{DISPLAYTITLE:.*?}}/)?.[0], pageContent.match(/{{italic title\|?.*?}}/i)?.[0], pageContent.match(/{{DEFAULTSORT:.*?}}/)?.[0]].filter(Boolean).join("\n");
      if (oldRedirectTarget)
        redirectInput.setValue(oldRedirectTarget.replaceAll("_", " "));
      else
        mw.notify("Could not find redirect target!", { type: "error" });
      tagSelect.setValue(oldRedirectTags);
    }
  }
});
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vc2NyaXB0cy9yZWRpcmVjdC1oZWxwZXIudHMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbImltcG9ydCB7IE1lZGlhV2lraURhdGFFcnJvciwgUGFnZVJldmlzaW9uc1Jlc3VsdCB9IGZyb20gJy4uL2dsb2JhbC10eXBlcyc7XG5cbmludGVyZmFjZSBQYWdlSW5mb1Jlc3VsdCB7XG4gICAgcXVlcnk6IHsgcGFnZXM6IHsgbWlzc2luZz86IHN0cmluZzsgcmVkaXJlY3Q/OiBzdHJpbmcgfVtdIH07XG59XG5cbmludGVyZmFjZSBBbGxQYWdlc0dlbmVyYXRvclJlc3VsdCB7XG4gICAgcXVlcnk6IHsgcGFnZXM6IHsgdGl0bGU6IHN0cmluZzsgcGFnZXByb3BzOiB7IGRpc2FtYmlndWF0aW9uPzogc3RyaW5nIH07IHJlZGlyZWN0Pzogc3RyaW5nIH1bXSB9O1xufVxuXG5pbnRlcmZhY2UgUGFnZVBhcnNlUmVzdWx0IHtcbiAgICBwYXJzZTogeyB0aXRsZTogc3RyaW5nOyByZWRpcmVjdHM6IHsgdG86IHN0cmluZzsgdG9mcmFnbWVudDogc3RyaW5nIH1bXTsgc2VjdGlvbnM6IHsgbGluZTogc3RyaW5nIH1bXSB9O1xufVxuXG5pbnRlcmZhY2UgUGFnZXByb3BzUmVzdWx0IHtcbiAgICBxdWVyeTogeyBwYWdlczogeyBwYWdlcHJvcHM6IHsgZGlzYW1iaWd1YXRpb24/OiBzdHJpbmcgfSB9W10gfTtcbn1cblxuaW50ZXJmYWNlIFVzZXJQZXJtaXNzaW9uc1Jlc3BvbnNlIHtcbiAgICBxdWVyeTogeyB1c2VyaW5mbzogeyByaWdodHM6IHN0cmluZ1tdIH0gfTtcbn1cblxuaW50ZXJmYWNlIFBhZ2VUcmlhZ2VMaXN0UmVzcG9uc2Uge1xuICAgIHBhZ2V0cmlhZ2VsaXN0OiB7IHBhZ2VzOiB7IHVzZXJfbmFtZTogc3RyaW5nOyBwYXRyb2xfc3RhdHVzOiBzdHJpbmcgfVtdOyByZXN1bHQ6IHN0cmluZyB9OyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uYW1pbmctY29udmVudGlvblxufVxuXG5tdy5sb2FkZXIudXNpbmcoWydtZWRpYXdpa2kudXRpbCcsICdvb2pzLXVpLWNvcmUnLCAnb29qcy11aS13aWRnZXRzJywgJ29vanMtdWkuc3R5bGVzLmljb25zLWNvbnRlbnQnLCAnb29qcy11aS5zdHlsZXMuaWNvbnMtZWRpdGluZy1jb3JlJ10sIGFzeW5jICgpID0+IHtcbiAgICBpZiAobXcuY29uZmlnLmdldCgnd2dOYW1lc3BhY2VOdW1iZXInKSA8IDApIHJldHVybjsgLy8gRG9uJ3QgcnVuIGluIHZpcnR1YWwgbmFtZXNwYWNlc1xuICAgIGlmICghbXcuY29uZmlnLmdldCgnd2dJc1Byb2JhYmx5RWRpdGFibGUnKSkgcmV0dXJuOyAvLyBEb24ndCBydW4gaWYgdXNlciBjYW4ndCBlZGl0IHBhZ2VcbiAgICBpZiAobXcuY29uZmlnLmdldCgnd2dBY3Rpb24nKSAhPT0gJ3ZpZXcnIHx8ICFtdy5jb25maWcuZ2V0KCd3Z0lzQXJ0aWNsZScpKSByZXR1cm47IC8vIERvbid0IHJ1biBpZiBub3Qgdmlld2luZyBwYWdlXG4gICAgaWYgKG13LnV0aWwuZ2V0UGFyYW1WYWx1ZSgnb2xkaWQnKSB8fCBtdy5jb25maWcuZ2V0KCd3Z0RpZmZPbGRJZCcpKSByZXR1cm47IC8vIERvbid0IHJ1biBpZiB2aWV3aW5nIG9sZCByZXZpc2lvbiBvciBkaWZmXG5cbiAgICBjb25zdCBjb250ZW50VGV4dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNtdy1jb250ZW50LXRleHQnKSBhcyBIVE1MRGl2RWxlbWVudDtcblxuICAgIGlmICghY29udGVudFRleHQpIHJldHVybiBtdy5ub3RpZnkoJ0ZhaWxlZCB0byBmaW5kIGNvbnRlbnQgdGV4dCBlbGVtZW50IScsIHsgdHlwZTogJ2Vycm9yJyB9KTtcblxuICAgIGNvbnN0IHJlZGlyZWN0VGVtcGxhdGVzID0gSlNPTi5wYXJzZSgoKGF3YWl0IG5ldyBtdy5BcGkoKS5nZXQoeyBhY3Rpb246ICdxdWVyeScsIGZvcm1hdHZlcnNpb246IDIsIHByb3A6ICdyZXZpc2lvbnMnLCBydnByb3A6ICdjb250ZW50JywgcnZzbG90czogJyonLCB0aXRsZXM6ICdVc2VyOkVlaml0NDMvc2NyaXB0cy9yZWRpcmVjdC1oZWxwZXIuanNvbicgfSkpIGFzIFBhZ2VSZXZpc2lvbnNSZXN1bHQpLnF1ZXJ5LnBhZ2VzPy5bMF0/LnJldmlzaW9ucz8uWzBdPy5zbG90cz8ubWFpbj8uY29udGVudCB8fCAnW10nKSBhcyBSZWNvcmQ8c3RyaW5nLCBzdHJpbmdbXT47XG5cbiAgICBjb25zdCBwYWdlVGl0bGUgPSBtdy5jb25maWcuZ2V0KCd3Z1BhZ2VOYW1lJyk7XG4gICAgY29uc3QgcGFnZVRpdGxlUGFyc2VkID0gbXcuVGl0bGUubmV3RnJvbVRleHQocGFnZVRpdGxlKSE7XG5cbiAgICBpZiAoIXBhZ2VUaXRsZVBhcnNlZCkgcmV0dXJuIG13Lm5vdGlmeSgnRmFpbGVkIHRvIHBhcnNlIHBhZ2UgdGl0bGUhJywgeyB0eXBlOiAnZXJyb3InIH0pO1xuXG4gICAgY29uc3QgcGFnZUluZm8gPSAoYXdhaXQgbmV3IG13LkFwaSgpLmdldCh7IGFjdGlvbjogJ3F1ZXJ5JywgZm9ybWF0dmVyc2lvbjogMiwgcHJvcDogJ2luZm8nLCB0aXRsZXM6IHBhZ2VUaXRsZSB9KSkgYXMgUGFnZUluZm9SZXN1bHQ7XG5cbiAgICBpZiAocGFnZUluZm8ucXVlcnkucGFnZXNbMF0ubWlzc2luZykge1xuICAgICAgICBjb25zdCBidXR0b24gPSBuZXcgT08udWkuQnV0dG9uV2lkZ2V0KHsgbGFiZWw6ICdDcmVhdGUgcmVkaXJlY3QnLCBpY29uOiAnYXJ0aWNsZVJlZGlyZWN0JywgZmxhZ3M6IFsncHJvZ3Jlc3NpdmUnXSB9KTtcbiAgICAgICAgYnV0dG9uLiRlbGVtZW50WzBdLnN0eWxlLm1hcmdpbkJvdHRvbSA9ICcxMHB4JztcbiAgICAgICAgYnV0dG9uLm9uKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgICAgIGJ1dHRvbi4kZWxlbWVudFswXS5yZW1vdmUoKTtcbiAgICAgICAgICAgIHNob3dSZWRpcmVjdEluZm8oZmFsc2UpO1xuICAgICAgICB9KTtcblxuICAgICAgICBjb250ZW50VGV4dC5wcmVwZW5kKGJ1dHRvbi4kZWxlbWVudFswXSk7XG4gICAgfSBlbHNlIGlmIChwYWdlSW5mby5xdWVyeS5wYWdlc1swXS5yZWRpcmVjdCkgc2hvd1JlZGlyZWN0SW5mbyh0cnVlKTtcbiAgICBlbHNlIHtcbiAgICAgICAgY29uc3QgcG9ydGxldExpbmsgPSBtdy51dGlsLmFkZFBvcnRsZXRMaW5rKG13LmNvbmZpZy5nZXQoJ3NraW4nKSA9PT0gJ21pbmVydmEnID8gJ3AtdGInIDogJ3AtY2FjdGlvbnMnLCAnIycsICdSZWRpcmVjdCBwYWdlJywgJ3JlZGlyZWN0LWhlbHBlcicpO1xuICAgICAgICBwb3J0bGV0TGluay5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldmVudCkgPT4ge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHNob3dSZWRpcmVjdEluZm8oZmFsc2UpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTaG93cyB0aGUgcmVkaXJlY3QgaW5mb3JtYXRpb24gYm94LlxuICAgICAqIEBwYXJhbSBleGlzdHMgV2hldGhlciB0aGUgcGFnZSBleGlzdHMuXG4gICAgICovXG4gICAgYXN5bmMgZnVuY3Rpb24gc2hvd1JlZGlyZWN0SW5mbyhleGlzdHM6IGJvb2xlYW4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgY29uc3QgZWRpdG9yQm94ID0gbmV3IE9PLnVpLlBhbmVsTGF5b3V0KHsgcGFkZGVkOiB0cnVlLCBleHBhbmRlZDogZmFsc2UsIGZyYW1lZDogdHJ1ZSB9KTtcbiAgICAgICAgZWRpdG9yQm94LiRlbGVtZW50WzBdLnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICcjOTVkNGJjJztcbiAgICAgICAgZWRpdG9yQm94LiRlbGVtZW50WzBdLnN0eWxlLndpZHRoID0gJzcwMHB4JztcbiAgICAgICAgZWRpdG9yQm94LiRlbGVtZW50WzBdLnN0eWxlLm1heFdpZHRoID0gJ2NhbGMoMTAwJSAtIDUwcHgpJztcbiAgICAgICAgZWRpdG9yQm94LiRlbGVtZW50WzBdLnN0eWxlLm1hcmdpbkxlZnQgPSAnYXV0byc7XG4gICAgICAgIGVkaXRvckJveC4kZWxlbWVudFswXS5zdHlsZS5tYXJnaW5SaWdodCA9ICdhdXRvJztcbiAgICAgICAgZWRpdG9yQm94LiRlbGVtZW50WzBdLnN0eWxlLm1hcmdpbkJvdHRvbSA9ICcyMHB4JztcblxuICAgICAgICBsZXQgc3luY1dpdGhNYWluQnV0dG9uO1xuXG4gICAgICAgIGlmIChwYWdlVGl0bGVQYXJzZWQuaXNUYWxrUGFnZSgpKSB7XG4gICAgICAgICAgICBjb25zdCBtYWluUGFnZURhdGEgPSAoYXdhaXQgbmV3IG13LkFwaSgpLmdldCh7IGFjdGlvbjogJ3F1ZXJ5JywgZm9ybWF0dmVyc2lvbjogMiwgcHJvcDogJ2luZm8nLCB0aXRsZXM6IHBhZ2VUaXRsZVBhcnNlZC5nZXRTdWJqZWN0UGFnZSgpIS5nZXRQcmVmaXhlZFRleHQoKSB9KSkgYXMgUGFnZUluZm9SZXN1bHQ7XG5cbiAgICAgICAgICAgIGlmIChtYWluUGFnZURhdGEucXVlcnkucGFnZXNbMF0ucmVkaXJlY3QpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBtYWluUGFnZUNvbnRlbnQgPSAoKGF3YWl0IG5ldyBtdy5BcGkoKS5nZXQoeyBhY3Rpb246ICdxdWVyeScsIGZvcm1hdHZlcnNpb246IDIsIHByb3A6ICdyZXZpc2lvbnMnLCBydnByb3A6ICdjb250ZW50JywgcnZzbG90czogJyonLCB0aXRsZXM6IHBhZ2VUaXRsZVBhcnNlZC5nZXRTdWJqZWN0UGFnZSgpIS5nZXRQcmVmaXhlZFRleHQoKSB9KSkgYXMgUGFnZVJldmlzaW9uc1Jlc3VsdCkucXVlcnkucGFnZXNbMF0ucmV2aXNpb25zWzBdLnNsb3RzLm1haW4uY29udGVudC50cmltKCk7XG4gICAgICAgICAgICAgICAgc3luY1dpdGhNYWluQnV0dG9uID0gbmV3IE9PLnVpLkJ1dHRvbldpZGdldCh7IGxhYmVsOiAnU3luYyB3aXRoIG1haW4gcGFnZScsIGljb246ICdsaW5rJywgZmxhZ3M6IFsncHJvZ3Jlc3NpdmUnXSB9KTtcbiAgICAgICAgICAgICAgICBzeW5jV2l0aE1haW5CdXR0b24ub24oJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXQgPSAvXiNyZWRpcmVjdDo/XFxzKlxcW1xcW1xccyooW15bXFxde3x9XSs/KVxccyooPzpcXHxbXltcXF17fH1dKz8pP11dXFxzKi9pLmV4ZWMobWFpblBhZ2VDb250ZW50KT8uWzFdO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRhcmdldCkgcmV0dXJuIG13Lm5vdGlmeSgnRmFpbGVkIHRvIHBhcnNlIG1haW4gcGFnZSBjb250ZW50IScsIHsgdHlwZTogJ2Vycm9yJyB9KTtcblxuICAgICAgICAgICAgICAgICAgICByZWRpcmVjdElucHV0LnNldFZhbHVlKG13LlRpdGxlLm5ld0Zyb21UZXh0KHRhcmdldCk/LmdldFRhbGtQYWdlKCk/LnRvU3RyaW5nKCkgPz8gJycpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBmcm9tTW92ZSA9IFsnUiBmcm9tIG1vdmUnLCAuLi5yZWRpcmVjdFRlbXBsYXRlc1snUiBmcm9tIG1vdmUnXV0uc29tZSgodGFnT3JSZWRpcmVjdCkgPT4gbmV3IFJlZ0V4cChge3tcXFxccypbJHt0YWdPclJlZGlyZWN0WzBdLnRvTG93ZXJDYXNlKCl9JHt0YWdPclJlZGlyZWN0WzBdfV0ke3RhZ09yUmVkaXJlY3Quc2xpY2UoMSl9XFxcXHMqKFxcXFx8fH19KWApLnRlc3QobWFpblBhZ2VDb250ZW50KSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmcm9tTW92ZSkgdGFnU2VsZWN0LnNldFZhbHVlKFsnUiBmcm9tIG1vdmUnXSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvKiBSZWRpcmVjdCB0YXJnZXQgaW5wdXQgKi9cbiAgICAgICAgaW50ZXJmYWNlIFJlZGlyZWN0SW5wdXRXaWRnZXRDb25maWcgZXh0ZW5kcyBPTy51aS5UZXh0SW5wdXRXaWRnZXQuQ29uZmlnT3B0aW9ucywgT08udWkubWl4aW4uTG9va3VwRWxlbWVudC5Db25maWdPcHRpb25zIHt9XG5cbiAgICAgICAgY2xhc3MgUmVkaXJlY3RJbnB1dFdpZGdldCBleHRlbmRzIE9PLnVpLlRleHRJbnB1dFdpZGdldCB7XG4gICAgICAgICAgICBjb25zdHJ1Y3Rvcihjb25maWc6IFJlZGlyZWN0SW5wdXRXaWRnZXRDb25maWcpIHtcbiAgICAgICAgICAgICAgICBzdXBlcihjb25maWcpO1xuICAgICAgICAgICAgICAgIE9PLnVpLm1peGluLkxvb2t1cEVsZW1lbnQuY2FsbCh0aGlzIGFzIHVua25vd24gYXMgT08udWkubWl4aW4uTG9va3VwRWxlbWVudCwgY29uZmlnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZ2V0TG9va3VwUmVxdWVzdCA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuZ2V0VmFsdWUoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBkZWZlcnJlZCA9ICQuRGVmZXJyZWQoKTtcblxuICAgICAgICAgICAgICAgIGlmICghdmFsdWUpIGRlZmVycmVkLnJlc29sdmUoW10pO1xuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHZhbHVlLmluY2x1ZGVzKCcjJykpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGl0bGUgPSB2YWx1ZS5zcGxpdCgnIycpWzBdO1xuXG4gICAgICAgICAgICAgICAgICAgIG5ldyBtdy5BcGkoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmdldCh7IGFjdGlvbjogJ3BhcnNlJywgcGFnZTogdGl0bGUsIHByb3A6ICdzZWN0aW9ucycsIHJlZGlyZWN0czogJzEnIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKCkgPT4gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKChyZXN1bHQ6IFBhZ2VQYXJzZVJlc3VsdCB8IG51bGwpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1hdGNoZWRTZWN0aW9ucyA9IHJlc3VsdC5wYXJzZS5zZWN0aW9ucy5maWx0ZXIoKHNlY3Rpb24pID0+IHNlY3Rpb24ubGluZS50b0xvd2VyQ2FzZSgpLnN0YXJ0c1dpdGgodmFsdWUuc3BsaXQoJyMnKVsxXS50b0xvd2VyQ2FzZSgpKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUobWF0Y2hlZFNlY3Rpb25zLm1hcCgoc2VjdGlvbikgPT4gKHsgZGF0YTogYCR7cmVzdWx0LnBhcnNlLnRpdGxlfSMke3NlY3Rpb24ubGluZX1gLCBsYWJlbDogYCR7cmVzdWx0LnBhcnNlLnRpdGxlfSMke3NlY3Rpb24ubGluZX1gIH0pKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGRlZmVycmVkLnJlc29sdmUoW10pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGFyc2VkVGl0bGUgPSBtdy5UaXRsZS5uZXdGcm9tVGV4dCh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIG5ldyBtdy5BcGkoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmdldCh7IGFjdGlvbjogJ3F1ZXJ5JywgZm9ybWF0dmVyc2lvbjogMiwgZ2FwbGltaXQ6IDIwLCBnYXBuYW1lc3BhY2U6IHBhcnNlZFRpdGxlPy5uYW1lc3BhY2UgPz8gMCwgZ2FwcHJlZml4OiBwYXJzZWRUaXRsZT8udGl0bGUgPz8gdmFsdWUsIGdlbmVyYXRvcjogJ2FsbHBhZ2VzJywgcHJvcDogJ2luZm98cGFnZXByb3BzJyB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKCgpID0+IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbigocmVzdWx0OiBBbGxQYWdlc0dlbmVyYXRvclJlc3VsdCB8IG51bGwpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnF1ZXJ5Py5wYWdlcyAvL1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gcmVzdWx0LnF1ZXJ5LnBhZ2VzIC8vXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZpbHRlcigocGFnZSkgPT4gcGFnZS50aXRsZSAhPT0gcGFnZVRpdGxlUGFyc2VkLnRvU3RyaW5nKCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLm1hcCgocGFnZSkgPT4gKHsgZGF0YTogcGFnZS50aXRsZSwgbGFiZWw6IG5ldyBPTy51aS5IdG1sU25pcHBldChgJHtwYWdlLnRpdGxlfSR7cGFnZS5wYWdlcHJvcHMgJiYgJ2Rpc2FtYmlndWF0aW9uJyBpbiBwYWdlLnBhZ2Vwcm9wcyA/ICcgPGk+KGRpc2FtYmlndWF0aW9uKTwvaT4nIDogJyd9JHsncmVkaXJlY3QnIGluIHBhZ2UgPyAnIDxpPihyZWRpcmVjdCk8L2k+JyA6ICcnfWApIH0pKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogW11cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGRlZmVycmVkLnJlc29sdmUoW10pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2UoeyBhYm9ydCgpIHt9IH0pOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1lbXB0eS1mdW5jdGlvblxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgZ2V0TG9va3VwQ2FjaGVEYXRhRnJvbVJlc3BvbnNlID0gPFQ+KHJlc3BvbnNlOiBUW10gfCBudWxsIHwgdW5kZWZpbmVkKSA9PiByZXNwb25zZSA/PyBbXTtcblxuICAgICAgICAgICAgZ2V0TG9va3VwTWVudU9wdGlvbnNGcm9tRGF0YSA9IChkYXRhOiB7IGRhdGE6IHN0cmluZzsgbGFiZWw6IHN0cmluZyB9W10pID0+IGRhdGEubWFwKCh7IGRhdGEsIGxhYmVsIH0pID0+IG5ldyBPTy51aS5NZW51T3B0aW9uV2lkZ2V0KHsgZGF0YSwgbGFiZWwgfSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgT2JqZWN0LmFzc2lnbihSZWRpcmVjdElucHV0V2lkZ2V0LnByb3RvdHlwZSwgT08udWkubWl4aW4uTG9va3VwRWxlbWVudC5wcm90b3R5cGUpO1xuXG4gICAgICAgIGNvbnN0IHJlZGlyZWN0SW5wdXQgPSBuZXcgUmVkaXJlY3RJbnB1dFdpZGdldCh7IHBsYWNlaG9sZGVyOiAnVGFyZ2V0IHBhZ2UgbmFtZScsIHJlcXVpcmVkOiB0cnVlIH0pO1xuICAgICAgICByZWRpcmVjdElucHV0Lm9uKCdjaGFuZ2UnLCAoKSA9PiB7XG4gICAgICAgICAgICBsZXQgdmFsdWUgPSByZWRpcmVjdElucHV0LmdldFZhbHVlKCk7XG4gICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UobmV3IFJlZ0V4cChgXihodHRwcz86KT8vezJ9PyR7bXcuY29uZmlnLmdldCgnd2dTZXJ2ZXInKS5yZXBsYWNlKC9eXFwvezJ9LywgJycpfS93aWtpL2ApLCAnJyk7XG4gICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL146LywgJycpO1xuXG4gICAgICAgICAgICBpZiAodmFsdWUubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHJlZGlyZWN0SW5wdXQuc2V0VmFsdWUodmFsdWVbMF0udG9VcHBlckNhc2UoKSArIHZhbHVlLnNsaWNlKDEpLnJlcGxhY2VBbGwoJ18nLCAnICcpKTtcbiAgICAgICAgICAgICAgICBzdWJtaXRCdXR0b24uc2V0RGlzYWJsZWQoZmFsc2UpO1xuICAgICAgICAgICAgfSBlbHNlIHN1Ym1pdEJ1dHRvbi5zZXREaXNhYmxlZCh0cnVlKTtcblxuICAgICAgICAgICAgdXBkYXRlU3VtbWFyeSgpO1xuICAgICAgICAgICAgc3VibWl0QnV0dG9uLnNldExhYmVsKCdTdWJtaXQnKTtcbiAgICAgICAgICAgIG5lZWRzQ2hlY2sgPSB0cnVlO1xuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCByZWRpcmVjdElucHV0TGF5b3V0ID0gbmV3IE9PLnVpLkZpZWxkTGF5b3V0KHJlZGlyZWN0SW5wdXQsIHsgbGFiZWw6IG5ldyBPTy51aS5IdG1sU25pcHBldCgnPGI+UmVkaXJlY3QgdGFyZ2V0OjwvYj4nKSwgYWxpZ246ICd0b3AnIH0pO1xuXG4gICAgICAgIC8qIFJlZGlyZWN0IGNhdGVnb3JpemF0aW9uIHRlbXBsYXRlIHNlbGVjdGlvbiAqL1xuICAgICAgICBjb25zdCB0YWdTZWxlY3QgPSBuZXcgT08udWkuTWVudVRhZ011bHRpc2VsZWN0V2lkZ2V0KHtcbiAgICAgICAgICAgIGFsbG93QXJiaXRyYXJ5OiBmYWxzZSxcbiAgICAgICAgICAgIGFsbG93UmVvcmRlcmluZzogZmFsc2UsXG4gICAgICAgICAgICBvcHRpb25zOiBPYmplY3Qua2V5cyhyZWRpcmVjdFRlbXBsYXRlcykubWFwKCh0YWcpID0+ICh7IGRhdGE6IHRhZywgbGFiZWw6IHRhZyB9KSlcbiAgICAgICAgfSk7XG4gICAgICAgICh0YWdTZWxlY3QuZ2V0TWVudSgpIGFzIE9PLnVpLk1lbnVTZWxlY3RXaWRnZXQuQ29uZmlnT3B0aW9ucykuZmlsdGVyTW9kZSA9ICdzdWJzdHJpbmcnO1xuICAgICAgICB0YWdTZWxlY3Qub24oJ2NoYW5nZScsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHNvcnRlZFRhZ3MgPSAodGFnU2VsZWN0LmdldFZhbHVlKCkgYXMgc3RyaW5nW10pLnNvcnQoKGEsIGIpID0+IGEudG9Mb3dlckNhc2UoKS5sb2NhbGVDb21wYXJlKGIudG9Mb3dlckNhc2UoKSkpO1xuXG4gICAgICAgICAgICBpZiAoKHRhZ1NlbGVjdC5nZXRWYWx1ZSgpIGFzIHN0cmluZ1tdKS5qb2luKCc7JykgIT09IHNvcnRlZFRhZ3Muam9pbignOycpKSB0YWdTZWxlY3Quc2V0VmFsdWUoc29ydGVkVGFncyk7XG5cbiAgICAgICAgICAgIHVwZGF0ZVN1bW1hcnkoKTtcbiAgICAgICAgICAgIHN1Ym1pdEJ1dHRvbi5zZXRMYWJlbCgnU3VibWl0Jyk7XG4gICAgICAgICAgICBuZWVkc0NoZWNrID0gdHJ1ZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgdGFnU2VsZWN0TGF5b3V0ID0gbmV3IE9PLnVpLkZpZWxkTGF5b3V0KHRhZ1NlbGVjdCwgeyBsYWJlbDogbmV3IE9PLnVpLkh0bWxTbmlwcGV0KCc8Yj5SZWRpcmVjdCBjYXRlZ29yaXphdGlvbiB0ZW1wbGF0ZShzKTo8L2I+JyksIGFsaWduOiAndG9wJyB9KTtcblxuICAgICAgICAvKiBTdW1tYXJ5IGlucHV0ICovXG4gICAgICAgIGNvbnN0IHN1bW1hcnlJbnB1dCA9IG5ldyBPTy51aS5Db21ib0JveElucHV0V2lkZ2V0KHtcbiAgICAgICAgICAgIG9wdGlvbnM6IFtcbiAgICAgICAgICAgICAgICB7IGRhdGE6ICdSZXNvbHZlIGRvdWJsZSByZWRpcmVjdCcgfSwgLy9cbiAgICAgICAgICAgICAgICB7IGRhdGE6ICdSZXNvbHZlIHNlbGYgcmVkaXJlY3QnIH0sXG4gICAgICAgICAgICAgICAgeyBkYXRhOiAnUmVtb3ZlIGluY29ycmVjdCByY2F0cycgfVxuICAgICAgICAgICAgXVxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBzdW1tYXJ5SW5wdXRMYXlvdXQgPSBuZXcgT08udWkuRmllbGRMYXlvdXQoc3VtbWFyeUlucHV0LCB7IGxhYmVsOiBuZXcgT08udWkuSHRtbFNuaXBwZXQoJzxiPlN1bW1hcnk6PC9iPicpLCBhbGlnbjogJ3RvcCcgfSk7XG5cbiAgICAgICAgLyogU3VibWl0IGJ1dHRvbiAqL1xuICAgICAgICBjb25zdCBzdWJtaXRCdXR0b24gPSBuZXcgT08udWkuQnV0dG9uV2lkZ2V0KHsgbGFiZWw6ICdTdWJtaXQnLCBkaXNhYmxlZDogdHJ1ZSwgZmxhZ3M6IFsncHJvZ3Jlc3NpdmUnXSB9KTtcbiAgICAgICAgc3VibWl0QnV0dG9uLiRlbGVtZW50WzBdLnN0eWxlLm1hcmdpbkJvdHRvbSA9ICcwJztcblxuICAgICAgICBsZXQgbmVlZHNDaGVjayA9IHRydWU7XG4gICAgICAgIHN1Ym1pdEJ1dHRvbi5vbignY2xpY2snLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgW3JlZGlyZWN0SW5wdXQsIHRhZ1NlbGVjdCwgc3VtbWFyeUlucHV0LCBzdWJtaXRCdXR0b24sIHN5bmNUYWxrQ2hlY2tib3gsIHBhdHJvbENoZWNrYm94XS5maWx0ZXIoQm9vbGVhbikpIChlbGVtZW50IGFzIE9PLnVpLldpZGdldCkuc2V0RGlzYWJsZWQodHJ1ZSk7XG4gICAgICAgICAgICBzdWJtaXRCdXR0b24uc2V0TGFiZWwoJ0NoZWNraW5nIHRhcmdldCB2YWxpZGl0eS4uLicpO1xuXG4gICAgICAgICAgICBsZXQgcGFyc2VkRGVzdGluYXRpb247XG5cbiAgICAgICAgICAgIGNvbnN0IGVycm9ycyA9IFtdO1xuXG4gICAgICAgICAgICAvKiBUaXRsZSB2YWxpZGF0aW9uICovXG4gICAgICAgICAgICBpZiAobmVlZHNDaGVjaykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGRlc3RpbmF0aW9uID0gcmVkaXJlY3RJbnB1dC5nZXRWYWx1ZSgpLnRyaW0oKTtcblxuICAgICAgICAgICAgICAgIC8qIEludmFsaWQgY2hhcmFjdGVycyAqL1xuICAgICAgICAgICAgICAgIGlmICghL15cXHMqW15bXFxde3x9XStcXHMqJC8udGVzdChkZXN0aW5hdGlvbikpIGVycm9ycy5wdXNoKHsgdGl0bGU6IGRlc3RpbmF0aW9uLCBtZXNzYWdlOiAnaXMgbm90IGEgdmFsaWQgcGFnZSB0aXRsZSEnIH0pO1xuXG4gICAgICAgICAgICAgICAgLyogRmFpbGVkIGR1cmluZyB0aXRsZSBwYXJzaW5nICovXG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgcGFyc2VkRGVzdGluYXRpb24gPSBtdy5UaXRsZS5uZXdGcm9tVGV4dChkZXN0aW5hdGlvbik7XG4gICAgICAgICAgICAgICAgfSBjYXRjaCB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlcnJvcnMubGVuZ3RoID09PSAwKSBlcnJvcnMucHVzaCh7IHRpdGxlOiBkZXN0aW5hdGlvbiwgbWVzc2FnZTogJ2lzIG5vdCBhIHZhbGlkIHBhZ2UgdGl0bGUhJyB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCFwYXJzZWREZXN0aW5hdGlvbiAmJiBlcnJvcnMubGVuZ3RoID09PSAwKSBlcnJvcnMucHVzaCh7IHRpdGxlOiBkZXN0aW5hdGlvbiwgbWVzc2FnZTogJ2lzIG5vdCBhIHZhbGlkIHBhZ2UgdGl0bGUhJyB9KTtcblxuICAgICAgICAgICAgICAgIC8qIFNlbGYgcmVkaXJlY3RzICovXG4gICAgICAgICAgICAgICAgaWYgKHBhcnNlZERlc3RpbmF0aW9uPy50b1N0cmluZygpID09PSBwYWdlVGl0bGVQYXJzZWQudG9TdHJpbmcoKSkgZXJyb3JzLnB1c2goeyBtZXNzYWdlOiAnY2Fubm90IHJlZGlyZWN0IHRvIGl0c2VsZiEnIH0pO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgZGVzdGluYXRpb25EYXRhID0gKGF3YWl0IG5ldyBtdy5BcGkoKS5nZXQoeyBhY3Rpb246ICdxdWVyeScsIGZvcm1hdHZlcnNpb246IDIsIHByb3A6ICdwYWdlcHJvcHMnLCB0aXRsZXM6IGRlc3RpbmF0aW9uIH0pLmNhdGNoKChlcnJvckNvZGU6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgICAgICAgICAvKiBOb24tZXhpc3RlbnQgZGVzdGluYXRpb24gKi8gaWYgKGVycm9yQ29kZSA9PT0gJ21pc3Npbmd0aXRsZScpIGVycm9ycy5wdXNoKHsgdGl0bGU6IGRlc3RpbmF0aW9uLCBtZXNzYWdlOiAnZG9lcyBub3QgZXhpc3QhJyB9KTtcbiAgICAgICAgICAgICAgICAgICAgLyogT3RoZXIgQVBJIGVycm9yICovIGVsc2UgZXJyb3JzLnB1c2goeyB0aXRsZTogZGVzdGluYXRpb24sIG1lc3NhZ2U6IGB3YXMgbm90IGFibGUgdG8gYmUgZmV0Y2hlZCBmcm9tIHRoZSBBUEkgKCR7ZXJyb3JDb2RlfSkhYCB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgfSkpIGFzIFBhZ2Vwcm9wc1Jlc3VsdCB8IG51bGw7XG4gICAgICAgICAgICAgICAgY29uc3QgZGVzdGluYXRpb25QYXJzZVJlc3VsdCA9IChhd2FpdCBuZXcgbXcuQXBpKCkuZ2V0KHsgYWN0aW9uOiAncGFyc2UnLCBwYWdlOiBkZXN0aW5hdGlvbiwgcHJvcDogJ3NlY3Rpb25zJywgcmVkaXJlY3RzOiAnMScgfSkpIGFzIFBhZ2VQYXJzZVJlc3VsdDtcblxuICAgICAgICAgICAgICAgIC8qIERvdWJsZSByZWRpcmVjdHMgKi9cbiAgICAgICAgICAgICAgICBpZiAoZGVzdGluYXRpb25QYXJzZVJlc3VsdC5wYXJzZS5yZWRpcmVjdHM/LlswXSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBkZXN0aW5hdGlvblJlZGlyZWN0ID0gZGVzdGluYXRpb25QYXJzZVJlc3VsdC5wYXJzZS5yZWRpcmVjdHNbMF0udG8gKyAoZGVzdGluYXRpb25QYXJzZVJlc3VsdC5wYXJzZS5yZWRpcmVjdHNbMF0udG9mcmFnbWVudCA/IGAjJHtkZXN0aW5hdGlvblBhcnNlUmVzdWx0LnBhcnNlLnJlZGlyZWN0c1swXS50b2ZyYWdtZW50fWAgOiAnJyk7XG4gICAgICAgICAgICAgICAgICAgIGVycm9ycy5wdXNoKHsgdGl0bGU6IGRlc3RpbmF0aW9uLCBtZXNzYWdlOiBgaXMgYSByZWRpcmVjdCB0byA8YSBocmVmPVwiJHttdy51dGlsLmdldFVybChkZXN0aW5hdGlvblJlZGlyZWN0KX1cIiB0YXJnZXQ9XCJfYmxhbmtcIj4ke2Rlc3RpbmF0aW9uUmVkaXJlY3R9PC9hPi4gUmV0YXJnZXQgdG8gdGhhdCBwYWdlIGluc3RlYWQsIGFzIGRvdWJsZSByZWRpcmVjdHMgYXJlbid0IGFsbG93ZWQuYCB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvKiBOb24tZXhpc3RlbnQgc2VjdGlvbiAqL1xuICAgICAgICAgICAgICAgIGlmIChkZXN0aW5hdGlvbi5zcGxpdCgnIycpLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsaWRTZWN0aW9uID0gZGVzdGluYXRpb25QYXJzZVJlc3VsdC5wYXJzZS5zZWN0aW9ucy5maW5kKChzZWN0aW9uKSA9PiBzZWN0aW9uLmxpbmUgPT09IGRlc3RpbmF0aW9uLnNwbGl0KCcjJylbMV0pO1xuICAgICAgICAgICAgICAgICAgICBpZiAodmFsaWRTZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFnU2VsZWN0LmdldFZhbHVlKCkuaW5jbHVkZXMoJ1IgdG8gYW5jaG9yJykpIGVycm9ycy5wdXNoKHsgbWVzc2FnZTogJ2lzIHRhZ2dlZCBhcyBhIHJlZGlyZWN0IHRvIGFuIGFuY2hvciwgYnV0IGl0IGlzIGFjdHVhbGx5IGEgcmVkaXJlY3QgdG8gYSBzZWN0aW9uIScgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRhZ1NlbGVjdC5nZXRWYWx1ZSgpLmluY2x1ZGVzKCdSIHRvIHNlY3Rpb24nKSkgZXJyb3JzLnB1c2goeyBtZXNzYWdlOiAnaXMgYSByZWRpcmVjdCB0byBhIHNlY3Rpb24sIGJ1dCBpdCBpcyBub3QgdGFnZ2VkIHdpdGggPGNvZGU+e3tSIHRvIHNlY3Rpb259fTwvY29kZT4hJyB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRlc3RpbmF0aW9uQ29udGVudCA9ICgoYXdhaXQgbmV3IG13LkFwaSgpLmdldCh7IGFjdGlvbjogJ3F1ZXJ5JywgZm9ybWF0dmVyc2lvbjogMiwgcHJvcDogJ3JldmlzaW9ucycsIHJ2cHJvcDogJ2NvbnRlbnQnLCBydnNsb3RzOiAnKicsIHRpdGxlczogcGFyc2VkRGVzdGluYXRpb24hLnRvU3RyaW5nKCkgfSkpIGFzIFBhZ2VSZXZpc2lvbnNSZXN1bHQpLnF1ZXJ5LnBhZ2VzWzBdLnJldmlzaW9uc1swXS5zbG90cy5tYWluLmNvbnRlbnQ7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFuY2hvcnMgPSBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLi4uKGRlc3RpbmF0aW9uQ29udGVudFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAubWF0Y2goLyg/PD17e1xccyo/W0FhXSg/Om5jaG9ycz98bmNob3IgZm9yIHJlZGlyZWN0fG5rZXJ8TkNIT1J8bmMpXFxzKj9cXHwpLis/KD89fX0pL2cpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8ubWFwKChhbmNob3I6IHN0cmluZykgPT4gYW5jaG9yLnNwbGl0KCd8JykubWFwKChwYXJ0KSA9PiBwYXJ0LnRyaW0oKSkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8uZmxhdCgpID8/IFtdKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuLi4oZGVzdGluYXRpb25Db250ZW50XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5tYXRjaCgvKD88PXt7XFxzKj8oPzpbVnZdKD86aXNpYmxlIGFuY2hvcnM/fGlzYW5jfEFuY2h8YW5jaG9yfGlzaWJsZWFuY2hvcnxhKXxbQWFdKD86bmNob3JkfGNob3JlZHxuY2hvclxcKyl8W1R0XWV4dCBhbmNob3IpXFxzKj9cXHwpLis/KD89KD88ISF8PSl9fSkvZylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPy5tYXAoKGFuY2hvcjogc3RyaW5nKSA9PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5jaG9yXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnNwbGl0KCd8JylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAubWFwKChwYXJ0KSA9PiBwYXJ0LnRyaW0oKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKChwYXJ0KSA9PiAhL150ZXh0XFxzKj89Ly50ZXN0KHBhcnQpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8uZmxhdCgpID8/IFtdKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuLi4oZGVzdGluYXRpb25Db250ZW50Lm1hdGNoKC8oPzw9aWQ9KVwiPy4rPyg/PVwifD58XFx8KS9nKT8ubWFwKChhbmNob3I6IHN0cmluZykgPT4gYW5jaG9yLnRyaW0oKSkgPz8gW10pXG4gICAgICAgICAgICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFuY2hvcnMuaW5jbHVkZXMoZGVzdGluYXRpb24uc3BsaXQoJyMnKVsxXSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFnU2VsZWN0LmdldFZhbHVlKCkuaW5jbHVkZXMoJ1IgdG8gc2VjdGlvbicpKSBlcnJvcnMucHVzaCh7IG1lc3NhZ2U6ICdpcyB0YWdnZWQgYXMgYSByZWRpcmVjdCB0byBhIHNlY3Rpb24sIGJ1dCBpdCBpcyBhY3R1YWxseSBhIHJlZGlyZWN0IHRvIGFuIGFuY2hvciEnIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGFnU2VsZWN0LmdldFZhbHVlKCkuaW5jbHVkZXMoJ1IgdG8gYW5jaG9yJykpIGVycm9ycy5wdXNoKHsgbWVzc2FnZTogJ2lzIGEgcmVkaXJlY3QgdG8gYW4gYW5jaG9yLCBidXQgaXQgaXMgbm90IHRhZ2dlZCB3aXRoIDxjb2RlPnt7UiBmcm9tIGFuY2hvcn19PC9jb2RlPiEnIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGVycm9ycy5wdXNoKHsgbWVzc2FnZTogYGlzIGEgcmVkaXJlY3QgdG8gPGEgaHJlZj1cIiR7bXcudXRpbC5nZXRVcmwoZGVzdGluYXRpb24pfVwiIHRhcmdldD1cIl9ibGFua1wiPiR7ZGVzdGluYXRpb259PC9hPiwgYnV0IHRoYXQgc2VjdGlvbiBvciBhbmNob3IgZG9lcyBub3QgZXhpc3QhYCB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8qIEltcHJvcGVybHkgdGFnZ2VkIGFzIHJlZGlyZWN0IHRvIHNlY3Rpb24vYW5jaG9yICovXG4gICAgICAgICAgICAgICAgaWYgKGRlc3RpbmF0aW9uLnNwbGl0KCcjJykubGVuZ3RoID09PSAxICYmICh0YWdTZWxlY3QuZ2V0VmFsdWUoKS5pbmNsdWRlcygnUiB0byBzZWN0aW9uJykgfHwgdGFnU2VsZWN0LmdldFZhbHVlKCkuaW5jbHVkZXMoJ1IgdG8gYW5jaG9yJykpKSBlcnJvcnMucHVzaCh7IG1lc3NhZ2U6ICdpcyBub3QgYSByZWRpcmVjdCB0byBhIHNlY3Rpb24vYW5jaG9yLCBidXQgaXQgaXMgdGFnZ2VkIHdpdGggPGNvZGU+e3tSIGZyb20gc2VjdGlvbn19PC9jb2RlPiBvciA8Y29kZT57e1IgZnJvbSBhbmNob3J9fTwvY29kZT4hJyB9KTtcblxuICAgICAgICAgICAgICAgIC8qIFJlZGlyZWN0IHRvIGRpc2FtYmlndWF0aW9uIHBhZ2Ugd2l0aG91dCB0ZW1wbGF0ZSAqL1xuICAgICAgICAgICAgICAgIGlmICgnZGlzYW1iaWd1YXRpb24nIGluIGRlc3RpbmF0aW9uRGF0YSEucXVlcnkucGFnZXNbMF0ucGFnZXByb3BzICYmICFbJ1IgZnJvbSBhbWJpZ3VvdXMgc29ydCBuYW1lJywgJ1IgZnJvbSBhbWJpZ3VvdXMgdGVybScsICdSIHRvIGRpc2FtYmlndWF0aW9uIHBhZ2UnLCAnUiBmcm9tIGluY29tcGxldGUgZGlzYW1iaWd1YXRpb24nLCAnUiBmcm9tIGluY29ycmVjdCBkaXNhbWJpZ3VhdGlvbicsICdSIGZyb20gb3RoZXIgZGlzYW1iaWd1YXRpb24nXS5zb21lKCh0ZW1wbGF0ZSkgPT4gdGFnU2VsZWN0LmdldFZhbHVlKCkuaW5jbHVkZXModGVtcGxhdGUpKSkgZXJyb3JzLnB1c2goeyBtZXNzYWdlOiAnaXMgYSByZWRpcmVjdCB0byBhIGRpc2FtYmlndWF0aW9uIHBhZ2UsIGJ1dCBpdCBpcyBub3QgdGFnZ2VkIHdpdGggYSBkaXNhbWJpZ3VhdGlvbiBjYXRlZ29yaXphdGlvbiB0ZW1wbGF0ZSEnIH0pO1xuXG4gICAgICAgICAgICAgICAgLyogSW1wcm9wZXJseSB0YWdnZWQgYXMgcmVkaXJlY3QgdG8gZGlzYW1iaWd1YXRpb24gcGFnZSAqL1xuICAgICAgICAgICAgICAgIGlmICghKCdkaXNhbWJpZ3VhdGlvbicgaW4gZGVzdGluYXRpb25EYXRhIS5xdWVyeS5wYWdlc1swXS5wYWdlcHJvcHMpICYmIFsnUiBmcm9tIGFtYmlndW91cyBzb3J0IG5hbWUnLCAnUiBmcm9tIGFtYmlndW91cyB0ZXJtJywgJ1IgdG8gZGlzYW1iaWd1YXRpb24gcGFnZScsICdSIGZyb20gaW5jb21wbGV0ZSBkaXNhbWJpZ3VhdGlvbicsICdSIGZyb20gaW5jb3JyZWN0IGRpc2FtYmlndWF0aW9uJywgJ1IgZnJvbSBvdGhlciBkaXNhbWJpZ3VhdGlvbiddLnNvbWUoKHRlbXBsYXRlKSA9PiB0YWdTZWxlY3QuZ2V0VmFsdWUoKS5pbmNsdWRlcyh0ZW1wbGF0ZSkpKSBlcnJvcnMucHVzaCh7IG1lc3NhZ2U6ICdpcyBub3QgYSByZWRpcmVjdCB0byBhIGRpc2FtYmlndWF0aW9uIHBhZ2UsIGJ1dCBpdCBpcyB0YWdnZWQgd2l0aCBhIGRpc2FtYmlndWF0aW9uIGNhdGVnb3JpemF0aW9uIHRlbXBsYXRlIScgfSk7XG5cbiAgICAgICAgICAgICAgICAvKiB7e1IgdG8gZGlzYW1iaWd1YXRpb24gcGFnZX19IHdpdGhvdXQgXCIgKGRpc2FtYmlndWF0aW9uKVwiIGF0IGVuZCBvZiB0aXRsZSAqL1xuICAgICAgICAgICAgICAgIGlmICh0YWdTZWxlY3QuZ2V0VmFsdWUoKS5pbmNsdWRlcygnUiB0byBkaXNhbWJpZ3VhdGlvbiBwYWdlJykgJiYgIXBhZ2VUaXRsZVBhcnNlZC5nZXRNYWluVGV4dCgpLmVuZHNXaXRoKCcgKGRpc2FtYmlndWF0aW9uKScpKSBlcnJvcnMucHVzaCh7IG1lc3NhZ2U6ICdpcyB0YWdnZWQgd2l0aCA8Y29kZT57e1IgdG8gZGlzYW1iaWd1YXRpb24gcGFnZX19PC9jb2RlPiwgYnV0IHRoaXMgdGl0bGUgZG9lcyBub3QgZW5kIHdpdGggXCIgKGRpc2FtYmlndWF0aW9uKVwiLiBVc2UgPGNvZGU+e3tSIGZyb20gYW1iaWd1b3VzIHRlcm19fTwvY29kZT4gb3IgYSBzaW1pbGFyIGNhdGVnb3JpemF0aW9uIHRlbXBsYXRlIGluc3RlYWQhJyB9KTtcblxuICAgICAgICAgICAgICAgIC8qIFN5bmNpbmcgdGFsayBwYWdlIGJ1dCB0YWxrIHBhZ2UgZXhpc3RzIGFuZCBpc24ndCBhIHJlZGlyZWN0ICovXG4gICAgICAgICAgICAgICAgaWYgKHN5bmNUYWxrQ2hlY2tib3g/LmlzU2VsZWN0ZWQoKSAmJiAhdGFsa0RhdGEhLnF1ZXJ5LnBhZ2VzWzBdLm1pc3NpbmcgJiYgIXRhbGtEYXRhIS5xdWVyeS5wYWdlc1swXS5yZWRpcmVjdCkgZXJyb3JzLnB1c2goeyB0aXRsZTogcGFnZVRpdGxlUGFyc2VkLmdldFRhbGtQYWdlKCkhLmdldFByZWZpeGVkVGV4dCgpLCBtZXNzYWdlOiAnZXhpc3RzLCBidXQgaXMgbm90IGEgcmVkaXJlY3QhJyB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGVycm9ycy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBlbGVtZW50IG9mIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5yZWRpcmVjdC1oZWxwZXItd2FybmluZycpKSBlbGVtZW50LnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgeyB0aXRsZSwgbWVzc2FnZSB9IG9mIGVycm9ycykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBsYWJlbCA9IG5ldyBPTy51aS5IdG1sU25pcHBldChgJHt0aXRsZSA/IGA8YSBocmVmPVwiJHttdy51dGlsLmdldFVybCh0aXRsZSl9XCIgdGFyZ2V0PVwiX2JsYW5rXCI+JHt0aXRsZX08L2E+YCA6ICdUaGlzIHBhZ2UnfSAke21lc3NhZ2V9IENsaWNrIGFnYWluIHdpdGhvdXQgbWFraW5nIGNoYW5nZXMgdG8gc3VibWl0IGFueXdheS5gKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgd2FybmluZ01lc3NhZ2UgPSBuZXcgT08udWkuTWVzc2FnZVdpZGdldCh7IHR5cGU6ICdlcnJvcicsIGNsYXNzZXM6IFsncmVkaXJlY3QtaGVscGVyLXdhcm5pbmcnXSwgaW5saW5lOiB0cnVlLCBsYWJlbCB9KTtcbiAgICAgICAgICAgICAgICAgICAgd2FybmluZ01lc3NhZ2UuJGVsZW1lbnRbMF0uc3R5bGUubWFyZ2luVG9wID0gJzhweCc7XG5cbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yQm94LiRlbGVtZW50WzBdLmFwcGVuZCh3YXJuaW5nTWVzc2FnZS4kZWxlbWVudFswXSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBlbGVtZW50IG9mIFtyZWRpcmVjdElucHV0LCB0YWdTZWxlY3QsIHN1bW1hcnlJbnB1dCwgc3VibWl0QnV0dG9uLCBzeW5jVGFsa0NoZWNrYm94LCBwYXRyb2xDaGVja2JveF0uZmlsdGVyKEJvb2xlYW4pKSAoZWxlbWVudCBhcyBPTy51aS5XaWRnZXQpLnNldERpc2FibGVkKGZhbHNlKTtcblxuICAgICAgICAgICAgICAgIHN1Ym1pdEJ1dHRvbi5zZXRMYWJlbCgnU3VibWl0IGFueXdheScpO1xuICAgICAgICAgICAgICAgIG5lZWRzQ2hlY2sgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcGFyc2VkRGVzdGluYXRpb24gPSBtdy5UaXRsZS5uZXdGcm9tVGV4dChyZWRpcmVjdElucHV0LmdldFZhbHVlKCkpO1xuXG4gICAgICAgICAgICAvKiBFZGl0L2NyZWF0ZSByZWRpcmVjdCAqL1xuICAgICAgICAgICAgc3VibWl0QnV0dG9uLnNldExhYmVsKGAke2V4aXN0cyA/ICdFZGl0aW5nJyA6ICdDcmVhdGluZyd9IHJlZGlyZWN0Li4uYCk7XG5cbiAgICAgICAgICAgIGNvbnN0IG91dHB1dCA9IFtcbiAgICAgICAgICAgICAgICBgI1JFRElSRUNUIFtbJHtyZWRpcmVjdElucHV0LmdldFZhbHVlKCkudHJpbSgpfV1dYCwgLy9cbiAgICAgICAgICAgICAgICB0YWdTZWxlY3QuZ2V0VmFsdWUoKS5sZW5ndGggPiAwID8gYHt7UmVkaXJlY3QgY2F0ZWdvcnkgc2hlbGx8XFxuJHsodGFnU2VsZWN0LmdldFZhbHVlKCkgYXMgc3RyaW5nW10pLm1hcCgodGFnKSA9PiBge3ske3RhZ30ke29sZFJlZGlyZWN0VGFnRGF0YT8uW3RhZ10gPyBgfCR7b2xkUmVkaXJlY3RUYWdEYXRhW3RhZ119YCA6ICcnfX19YCkuam9pbignXFxuJyl9XFxufX1gIDogbnVsbCxcbiAgICAgICAgICAgICAgICBvbGRTdHJheVRleHRcbiAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pXG4gICAgICAgICAgICAgICAgLmpvaW4oJ1xcblxcbicpO1xuXG4gICAgICAgICAgICBjb25zdCBzdW1tYXJ5ID0gKHN1bW1hcnlJbnB1dC5nZXRWYWx1ZSgpIHx8IChzdW1tYXJ5SW5wdXQuJHRhYkluZGV4ZWRbMF0gYXMgSFRNTElucHV0RWxlbWVudCkucGxhY2Vob2xkZXIpICsgJyAodmlhIFtbVXNlcjpFZWppdDQzL3NjcmlwdHMvcmVkaXJlY3QtaGVscGVyfHJlZGlyZWN0LWhlbHBlcl1dKSc7XG5cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG5ldyBtdy5BcGkoKVxuICAgICAgICAgICAgICAgIC5lZGl0KHBhZ2VUaXRsZSwgKCkgPT4gKHsgdGV4dDogb3V0cHV0LCBzdW1tYXJ5IH0pKVxuICAgICAgICAgICAgICAgIC5jYXRjaCgoZXJyb3JDb2RlOiBzdHJpbmcsIHsgZXJyb3IgfTogTWVkaWFXaWtpRGF0YUVycm9yKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlcnJvckNvZGUgPT09ICdub2NyZWF0ZS1taXNzaW5nJylcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgbXcuQXBpKCkuY3JlYXRlKHBhZ2VUaXRsZSwgeyBzdW1tYXJ5IH0sIG91dHB1dCkuY2F0Y2goKGVycm9yQ29kZTogc3RyaW5nLCB7IGVycm9yIH06IE1lZGlhV2lraURhdGFFcnJvcikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG13Lm5vdGlmeShgRXJyb3IgY3JlYXRpbmcgJHtwYWdlVGl0bGV9OiAke2Vycm9yLmluZm99ICgke2Vycm9yQ29kZX0pYCwgeyB0eXBlOiAnZXJyb3InIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgbXcubm90aWZ5KGBFcnJvciBlZGl0aW5nIG9yIGNyZWF0aW5nICR7cGFnZVRpdGxlfTogJHtlcnJvci5pbmZvfSAoJHtlcnJvckNvZGV9KWAsIHsgdHlwZTogJ2Vycm9yJyB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmICghcmVzdWx0KSByZXR1cm47XG5cbiAgICAgICAgICAgIG13Lm5vdGlmeShgUmVkaXJlY3QgJHtleGlzdHMgPyAnZWRpdGVkJyA6ICdjcmVhdGVkJ30gc3VjY2Vzc2Z1bGx5IWAsIHsgdHlwZTogJ3N1Y2Nlc3MnIH0pO1xuXG4gICAgICAgICAgICAvKiBTeW5jIHRhbGsgcGFnZSBjaGVja2JveCBoYW5kbGVyICovXG4gICAgICAgICAgICBpZiAoc3luY1RhbGtDaGVja2JveD8uaXNTZWxlY3RlZCgpKSB7XG4gICAgICAgICAgICAgICAgc3VibWl0QnV0dG9uLnNldExhYmVsKCdFZGl0aW5nIHRhbGsgcGFnZS4uLicpO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgZnJvbU1vdmUgPSB0YWdTZWxlY3QuZ2V0VmFsdWUoKS5pbmNsdWRlcygnUiBmcm9tIG1vdmUnKTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IG91dHB1dCA9IFtcbiAgICAgICAgICAgICAgICAgICAgYCNSRURJUkVDVCBbWyR7cGFyc2VkRGVzdGluYXRpb24hLmdldFRhbGtQYWdlKCkhLmdldFByZWZpeGVkVGV4dCgpfV1dYCwgLy9cbiAgICAgICAgICAgICAgICAgICAgZnJvbU1vdmUgPyAne3tSZWRpcmVjdCBjYXRlZ29yeSBzaGVsbHxcXG57e1IgZnJvbSBtb3ZlfX1cXG59fScgOiBudWxsXG4gICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pXG4gICAgICAgICAgICAgICAgICAgIC5qb2luKCdcXG5cXG4nKTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IHRhbGtQYWdlID0gcGFnZVRpdGxlUGFyc2VkLmdldFRhbGtQYWdlKCkhLmdldFByZWZpeGVkVGV4dCgpO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgdGFsa1Jlc3VsdCA9IGF3YWl0IG5ldyBtdy5BcGkoKVxuICAgICAgICAgICAgICAgICAgICAuZWRpdCh0YWxrUGFnZSwgKCkgPT4gKHsgdGV4dDogb3V0cHV0LCBzdW1tYXJ5OiAnU3luY2luZyByZWRpcmVjdCBmcm9tIG1haW4gcGFnZSAodmlhIFtbVXNlcjpFZWppdDQzL3NjcmlwdHMvcmVkaXJlY3QtaGVscGVyfHJlZGlyZWN0LWhlbHBlcl1dKScgfSkpXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaCgoZXJyb3JDb2RlOiBzdHJpbmcsIHsgZXJyb3IgfTogTWVkaWFXaWtpRGF0YUVycm9yKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3JDb2RlID09PSAnbm9jcmVhdGUtbWlzc2luZycpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBtdy5BcGkoKS5jcmVhdGUodGFsa1BhZ2UsIHsgc3VtbWFyeTogJ1N5bmNpbmcgcmVkaXJlY3QgZnJvbSBtYWluIHBhZ2UgKHZpYSBbW1VzZXI6RWVqaXQ0My9zY3JpcHRzL3JlZGlyZWN0LWhlbHBlcnxyZWRpcmVjdC1oZWxwZXJdXSknIH0sIG91dHB1dCkuY2F0Y2goKGVycm9yQ29kZTogc3RyaW5nLCB7IGVycm9yIH06IE1lZGlhV2lraURhdGFFcnJvcikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtdy5ub3RpZnkoYEVycm9yIGNyZWF0aW5nICR7dGFsa1BhZ2V9OiAke2Vycm9yLmluZm99ICgke2Vycm9yQ29kZX0pYCwgeyB0eXBlOiAnZXJyb3InIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbXcubm90aWZ5KGBFcnJvciBlZGl0aW5nIG9yIGNyZWF0aW5nICR7dGFsa1BhZ2V9OiAke2Vycm9yLmluZm99ICgke2Vycm9yQ29kZX0pYCwgeyB0eXBlOiAnZXJyb3InIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGlmICghdGFsa1Jlc3VsdCkgcmV0dXJuO1xuXG4gICAgICAgICAgICAgICAgbXcubm90aWZ5KCdUYWxrIHBhZ2Ugc3luY2VkIHN1Y2Nlc3NmdWxseSEnLCB7IHR5cGU6ICdzdWNjZXNzJyB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLyogUGF0cm9sIGNoZWNrYm94IGhhbmRsZXIgKi9cbiAgICAgICAgICAgIGlmIChwYXRyb2xDaGVja2JveD8uaXNTZWxlY3RlZCgpKSB7XG4gICAgICAgICAgICAgICAgc3VibWl0QnV0dG9uLnNldExhYmVsKCdQYXRyb2xsaW5nIHJlZGlyZWN0Li4uJyk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBwYXRyb2xMaW5rOiBIVE1MQW5jaG9yRWxlbWVudCB8IG51bGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucGF0cm9sbGluayBhJyk7XG4gICAgICAgICAgICAgICAgY29uc3QgbWFya1Jldmlld2VkQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI213ZS1wdC1tYXJrLWFzLXJldmlld2VkLWJ1dHRvbicpIGFzIEhUTUxCdXR0b25FbGVtZW50IHwgbnVsbDtcblxuICAgICAgICAgICAgICAgIGlmIChwYXRyb2xMaW5rKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhdHJvbFJlc3VsdCA9IGF3YWl0IG5ldyBtdy5BcGkoKS5wb3N0V2l0aFRva2VuKCdwYXRyb2wnLCB7IGFjdGlvbjogJ3BhdHJvbCcsIHJjaWQ6IG5ldyBVUkwocGF0cm9sTGluay5ocmVmKS5zZWFyY2hQYXJhbXMuZ2V0KCdyY2lkJykhIH0pLmNhdGNoKChlcnJvckNvZGU6IHN0cmluZywgeyBlcnJvciB9OiBNZWRpYVdpa2lEYXRhRXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG13Lm5vdGlmeShgRXJyb3IgcGF0cm9sbGluZyAke3BhZ2VUaXRsZX0gdmlhIEFQSTogJHtlcnJvci5pbmZvfSAoJHtlcnJvckNvZGV9KWAsIHsgdHlwZTogJ2Vycm9yJyB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBhdHJvbFJlc3VsdCkgbXcubm90aWZ5KCdSZWRpcmVjdCBwYXRyb2xsZWQgc3VjY2Vzc2Z1bGx5IScsIHsgdHlwZTogJ3N1Y2Nlc3MnIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobWFya1Jldmlld2VkQnV0dG9uKSB7XG4gICAgICAgICAgICAgICAgICAgIG1hcmtSZXZpZXdlZEJ1dHRvbi5jbGljaygpO1xuICAgICAgICAgICAgICAgICAgICBtdy5ub3RpZnkoJ1JlZGlyZWN0IHBhdHJvbGxlZCBzdWNjZXNzZnVsbHkhJywgeyB0eXBlOiAnc3VjY2VzcycgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIG13Lm5vdGlmeSgnUGFnZSBjdXJhdGlvbiB0b29sYmFyIG5vdCBmb3VuZCwgcmVkaXJlY3QgY2Fubm90IGJlIHBhdHJvbGxlZCEnLCB7IHR5cGU6ICdlcnJvcicgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHN1Ym1pdEJ1dHRvbi5zZXRMYWJlbCgnQ29tcGxldGUsIHJlbG9hZGluZy4uLicpO1xuXG4gICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IG13LnV0aWwuZ2V0VXJsKHBhZ2VUaXRsZSwgeyByZWRpcmVjdDogJ25vJyB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgbGV0IHRhbGtEYXRhOiBQYWdlSW5mb1Jlc3VsdCB8IHVuZGVmaW5lZDtcblxuICAgICAgICBsZXQgc3luY1RhbGtDaGVja2JveDogT08udWkuQ2hlY2tib3hJbnB1dFdpZGdldCB8IHVuZGVmaW5lZCwgc3luY1RhbGtMYXlvdXQ6IE9PLnVpLldpZGdldCB8IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKCFwYWdlVGl0bGVQYXJzZWQuaXNUYWxrUGFnZSgpKSB7XG4gICAgICAgICAgICB0YWxrRGF0YSA9IChhd2FpdCBuZXcgbXcuQXBpKCkuZ2V0KHsgYWN0aW9uOiAncXVlcnknLCBmb3JtYXR2ZXJzaW9uOiAyLCBwcm9wOiAnaW5mbycsIHRpdGxlczogcGFnZVRpdGxlUGFyc2VkLmdldFRhbGtQYWdlKCkhLmdldFByZWZpeGVkVGV4dCgpIH0pKSBhcyBQYWdlSW5mb1Jlc3VsdDtcbiAgICAgICAgICAgIHN5bmNUYWxrQ2hlY2tib3ggPSBuZXcgT08udWkuQ2hlY2tib3hJbnB1dFdpZGdldCh7IHNlbGVjdGVkOiAhIXRhbGtEYXRhLnF1ZXJ5LnBhZ2VzWzBdLnJlZGlyZWN0IH0pO1xuXG4gICAgICAgICAgICBzeW5jVGFsa0xheW91dCA9IG5ldyBPTy51aS5XaWRnZXQoeyBjb250ZW50OiBbbmV3IE9PLnVpLkZpZWxkTGF5b3V0KHN5bmNUYWxrQ2hlY2tib3gsIHsgbGFiZWw6ICdTeW5jIHRhbGsgcGFnZScsIGFsaWduOiAnaW5saW5lJyB9KV0gfSk7XG4gICAgICAgICAgICBzeW5jVGFsa0xheW91dC4kZWxlbWVudFswXS5zdHlsZS5tYXJnaW5Cb3R0b20gPSAnMCc7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgc2hvdWxkUHJvbXB0UGF0cm9sO1xuICAgICAgICBpZiAobXcuY29uZmlnLmdldCgnd2dOYW1lc3BhY2VOdW1iZXInKSAhPT0gMCkgc2hvdWxkUHJvbXB0UGF0cm9sID0gZmFsc2U7XG4gICAgICAgIGVsc2UgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wYXRyb2xsaW5rJykpIHNob3VsZFByb21wdFBhdHJvbCA9IHRydWU7XG4gICAgICAgIGVsc2UgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNtd2UtcHQtbWFyay1hcy1yZXZpZXdlZC1idXR0b24nKSkgc2hvdWxkUHJvbXB0UGF0cm9sID0gdHJ1ZTtcbiAgICAgICAgZWxzZSBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI213ZS1wdC1tYXJrLWFzLXVucmV2aWV3ZWQtYnV0dG9uJykpIHNob3VsZFByb21wdFBhdHJvbCA9IGZhbHNlO1xuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmICghbXcuY29uZmlnLmdldCgnd2dBcnRpY2xlSWQnKSkgc2hvdWxkUHJvbXB0UGF0cm9sID0gZmFsc2U7XG4gICAgICAgICAgICBjb25zdCB1c2VyUGVybWlzc2lvbnMgPSAoYXdhaXQgbmV3IG13LkFwaSgpLmdldCh7IGFjdGlvbjogJ3F1ZXJ5JywgbWV0YTogJ3VzZXJpbmZvJywgdWlwcm9wOiAncmlnaHRzJyB9KSkgYXMgVXNlclBlcm1pc3Npb25zUmVzcG9uc2U7XG4gICAgICAgICAgICBpZiAoIXVzZXJQZXJtaXNzaW9ucy5xdWVyeS51c2VyaW5mby5yaWdodHMuaW5jbHVkZXMoJ3BhdHJvbCcpKSBzaG91bGRQcm9tcHRQYXRyb2wgPSBmYWxzZTtcblxuICAgICAgICAgICAgY29uc3QgcGF0cm9sUmVzcG9uc2UgPSAoYXdhaXQgbmV3IG13LkFwaSgpLmdldCh7IGFjdGlvbjogJ3BhZ2V0cmlhZ2VsaXN0JywgcGFnZV9pZDogbXcuY29uZmlnLmdldCgnd2dBcnRpY2xlSWQnKSB9KSkgYXMgUGFnZVRyaWFnZUxpc3RSZXNwb25zZTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbmFtaW5nLWNvbnZlbnRpb25cblxuICAgICAgICAgICAgaWYgKHBhdHJvbFJlc3BvbnNlLnBhZ2V0cmlhZ2VsaXN0LnBhZ2VzWzBdPy51c2VyX25hbWUgPT09IG13LmNvbmZpZy5nZXQoJ3dnVXNlck5hbWUnKSkgc2hvdWxkUHJvbXB0UGF0cm9sID0gZmFsc2U7XG4gICAgICAgICAgICBlbHNlIGlmIChwYXRyb2xSZXNwb25zZS5wYWdldHJpYWdlbGlzdC5yZXN1bHQgIT09ICdzdWNjZXNzJyB8fCBwYXRyb2xSZXNwb25zZS5wYWdldHJpYWdlbGlzdC5wYWdlcy5sZW5ndGggPT09IDApIHNob3VsZFByb21wdFBhdHJvbCA9IGZhbHNlO1xuICAgICAgICAgICAgZWxzZSBzaG91bGRQcm9tcHRQYXRyb2wgPSAhTnVtYmVyLnBhcnNlSW50KHBhdHJvbFJlc3BvbnNlLnBhZ2V0cmlhZ2VsaXN0LnBhZ2VzWzBdPy5wYXRyb2xfc3RhdHVzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBwYXRyb2xDaGVja2JveDogT08udWkuQ2hlY2tib3hJbnB1dFdpZGdldCB8IHVuZGVmaW5lZCwgcGF0cm9sTGF5b3V0OiBPTy51aS5XaWRnZXQgfCB1bmRlZmluZWQ7XG4gICAgICAgIGlmIChzaG91bGRQcm9tcHRQYXRyb2wpIHtcbiAgICAgICAgICAgIHBhdHJvbENoZWNrYm94ID0gbmV3IE9PLnVpLkNoZWNrYm94SW5wdXRXaWRnZXQoeyBzZWxlY3RlZDogdHJ1ZSB9KTtcblxuICAgICAgICAgICAgcGF0cm9sTGF5b3V0ID0gbmV3IE9PLnVpLldpZGdldCh7IGNvbnRlbnQ6IFtuZXcgT08udWkuRmllbGRMYXlvdXQocGF0cm9sQ2hlY2tib3gsIHsgbGFiZWw6ICdNYXJrIGFzIHBhdHJvbGxlZCcsIGFsaWduOiAnaW5saW5lJyB9KV0gfSk7XG4gICAgICAgICAgICBwYXRyb2xMYXlvdXQuJGVsZW1lbnRbMF0uc3R5bGUubWFyZ2luQm90dG9tID0gJzAnO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgc3VibWl0TGF5b3V0ID0gbmV3IE9PLnVpLkhvcml6b250YWxMYXlvdXQoeyBpdGVtczogW3N1Ym1pdEJ1dHRvbiwgc3luY1RhbGtMYXlvdXQsIHBhdHJvbExheW91dF0uZmlsdGVyKEJvb2xlYW4pIGFzIE9PLnVpLldpZGdldFtdIH0pO1xuICAgICAgICBzdWJtaXRMYXlvdXQuJGVsZW1lbnRbMF0uc3R5bGUubWFyZ2luVG9wID0gJzEwcHgnO1xuXG4gICAgICAgIC8qIEFkZCBlbGVtZW50cyB0byBzY3JlZW4gKi9cbiAgICAgICAgZWRpdG9yQm94LiRlbGVtZW50WzBdLmFwcGVuZCguLi4oW3N5bmNXaXRoTWFpbkJ1dHRvbj8uJGVsZW1lbnQ/LlswXSwgcmVkaXJlY3RJbnB1dExheW91dC4kZWxlbWVudFswXSwgdGFnU2VsZWN0TGF5b3V0LiRlbGVtZW50WzBdLCBzdW1tYXJ5SW5wdXRMYXlvdXQuJGVsZW1lbnRbMF0sIHN1Ym1pdExheW91dC4kZWxlbWVudFswXV0uZmlsdGVyKEJvb2xlYW4pIGFzIEhUTUxFbGVtZW50W10pKTtcblxuICAgICAgICBjb250ZW50VGV4dC5wcmVwZW5kKGVkaXRvckJveC4kZWxlbWVudFswXSk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVwZGF0ZXMgdGhlIHN1bW1hcnkgaW5wdXQgcGxhY2Vob2xkZXIuXG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiB1cGRhdGVTdW1tYXJ5KCkge1xuICAgICAgICAgICAgY29uc3QgcmVkaXJlY3RWYWx1ZSA9IHJlZGlyZWN0SW5wdXQuZ2V0VmFsdWUoKS50cmltKCk7XG5cbiAgICAgICAgICAgIGlmICghcmVkaXJlY3RWYWx1ZSkgKHN1bW1hcnlJbnB1dC4kdGFiSW5kZXhlZFswXSBhcyBIVE1MSW5wdXRFbGVtZW50KS5wbGFjZWhvbGRlciA9ICcnO1xuICAgICAgICAgICAgZWxzZSBpZiAoZXhpc3RzKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0Q2hhbmdlZCA9IHJlZGlyZWN0VmFsdWUgIT09IG9sZFJlZGlyZWN0VGFyZ2V0O1xuICAgICAgICAgICAgICAgIGNvbnN0IHRhZ3NDaGFuZ2VkID0gdGFnU2VsZWN0LmdldFZhbHVlKCkuam9pbignOycpICE9PSBvbGRSZWRpcmVjdFRhZ3M/LmpvaW4oJzsnKTtcblxuICAgICAgICAgICAgICAgIGlmICh0YXJnZXRDaGFuZ2VkICYmIHRhZ3NDaGFuZ2VkKSAoc3VtbWFyeUlucHV0LiR0YWJJbmRleGVkWzBdIGFzIEhUTUxJbnB1dEVsZW1lbnQpLnBsYWNlaG9sZGVyID0gYENoYW5naW5nIHJlZGlyZWN0IHRvIFtbJHtyZWRpcmVjdFZhbHVlfV1dIGFuZCBjaGFuZ2luZyBjYXRlZ29yaXphdGlvbiB0ZW1wbGF0ZXNgO1xuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRhcmdldENoYW5nZWQpIChzdW1tYXJ5SW5wdXQuJHRhYkluZGV4ZWRbMF0gYXMgSFRNTElucHV0RWxlbWVudCkucGxhY2Vob2xkZXIgPSBgQ2hhbmdpbmcgcmVkaXJlY3QgdG8gW1ske3JlZGlyZWN0VmFsdWV9XV1gO1xuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRhZ3NDaGFuZ2VkKSAoc3VtbWFyeUlucHV0LiR0YWJJbmRleGVkWzBdIGFzIEhUTUxJbnB1dEVsZW1lbnQpLnBsYWNlaG9sZGVyID0gJ0NoYW5naW5nIGNhdGVnb3JpemF0aW9uIHRlbXBsYXRlcyc7XG4gICAgICAgICAgICAgICAgZWxzZSAoc3VtbWFyeUlucHV0LiR0YWJJbmRleGVkWzBdIGFzIEhUTUxJbnB1dEVsZW1lbnQpLnBsYWNlaG9sZGVyID0gJ1JlZGlyZWN0IGNsZWFudXAnO1xuICAgICAgICAgICAgfSBlbHNlIChzdW1tYXJ5SW5wdXQuJHRhYkluZGV4ZWRbMF0gYXMgSFRNTElucHV0RWxlbWVudCkucGxhY2Vob2xkZXIgPSBgQ3JlYXRpbmcgcmVkaXJlY3QgdG8gW1ske3JlZGlyZWN0VmFsdWV9XV1gO1xuICAgICAgICB9XG5cbiAgICAgICAgLyogTG9hZCBjdXJyZW50IHRhcmdldCBhbmQgdGFncywgaWYgYXBwbGljYWJsZSAqL1xuICAgICAgICBsZXQgb2xkUmVkaXJlY3RUYXJnZXQ6IHN0cmluZyB8IHVuZGVmaW5lZCwgb2xkUmVkaXJlY3RUYWdzOiBzdHJpbmdbXSB8IHVuZGVmaW5lZCwgb2xkUmVkaXJlY3RUYWdEYXRhOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+IHwgdW5kZWZpbmVkLCBvbGRTdHJheVRleHQ6IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKGV4aXN0cykge1xuICAgICAgICAgICAgY29uc3QgcGFnZUNvbnRlbnQgPSAoKGF3YWl0IG5ldyBtdy5BcGkoKS5nZXQoeyBhY3Rpb246ICdxdWVyeScsIGZvcm1hdHZlcnNpb246IDIsIHByb3A6ICdyZXZpc2lvbnMnLCBydnByb3A6ICdjb250ZW50JywgcnZzbG90czogJyonLCB0aXRsZXM6IHBhZ2VUaXRsZSB9KSkgYXMgUGFnZVJldmlzaW9uc1Jlc3VsdCkucXVlcnkucGFnZXNbMF0ucmV2aXNpb25zWzBdLnNsb3RzLm1haW4uY29udGVudC50cmltKCk7XG5cbiAgICAgICAgICAgIG9sZFJlZGlyZWN0VGFyZ2V0ID0gL14jcmVkaXJlY3Q6P1xccypcXFtcXFtcXHMqKFteW1xcXXt8fV0rPylcXHMqKD86XFx8W15bXFxde3x9XSs/KT9dXVxccyovaS5leGVjKHBhZ2VDb250ZW50KT8uWzFdO1xuICAgICAgICAgICAgb2xkUmVkaXJlY3RUYWdzID0gKFxuICAgICAgICAgICAgICAgIE9iamVjdC5lbnRyaWVzKHJlZGlyZWN0VGVtcGxhdGVzKVxuICAgICAgICAgICAgICAgICAgICAubWFwKChbdGFnLCByZWRpcmVjdHNdKSA9PiAoW3RhZywgLi4ucmVkaXJlY3RzXS5zb21lKCh0YWdPclJlZGlyZWN0KSA9PiBuZXcgUmVnRXhwKGB7e1xcXFxzKlske3RhZ09yUmVkaXJlY3RbMF0udG9Mb3dlckNhc2UoKX0ke3RhZ09yUmVkaXJlY3RbMF19XSR7dGFnT3JSZWRpcmVjdC5zbGljZSgxKX1cXFxccyooXFxcXHx8fX0pYCkudGVzdChwYWdlQ29udGVudCkpID8gdGFnIDogbnVsbCkpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbikgYXMgc3RyaW5nW11cbiAgICAgICAgICAgICkuc29ydCgoYSwgYikgPT4gYS50b0xvd2VyQ2FzZSgpLmxvY2FsZUNvbXBhcmUoYi50b0xvd2VyQ2FzZSgpKSk7XG4gICAgICAgICAgICBvbGRSZWRpcmVjdFRhZ0RhdGEgPSBPYmplY3QuZnJvbUVudHJpZXMoXG4gICAgICAgICAgICAgICAgb2xkUmVkaXJlY3RUYWdzXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoKHRhZykgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbWF0Y2ggPSBuZXcgUmVnRXhwKGB7e1xcXFxzKig/OiR7W3RhZywgLi4ucmVkaXJlY3RUZW1wbGF0ZXNbdGFnXV0ubWFwKCh0YWcpID0+IGBbJHt0YWdbMF0udG9Mb3dlckNhc2UoKX0ke3RhZ1swXX1dJHt0YWcuc2xpY2UoMSl9YCkuam9pbignfCcpfSlcXFxcfD8oLio/KVxcXFxzKn19YCkuZXhlYyhwYWdlQ29udGVudCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2ggPyBbdGFnLCBtYXRjaFsxXV0gOiBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pIGFzIFtzdHJpbmcsIHN0cmluZ11bXVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIG9sZFN0cmF5VGV4dCA9IFtwYWdlQ29udGVudC5tYXRjaCgve3tzaG9ydCBkZXNjcmlwdGlvblxcfC4qP319L2kpPy5bMF0sIHBhZ2VDb250ZW50Lm1hdGNoKC97e0RJU1BMQVlUSVRMRTouKj99fS8pPy5bMF0sIHBhZ2VDb250ZW50Lm1hdGNoKC97e2l0YWxpYyB0aXRsZVxcfD8uKj99fS9pKT8uWzBdLCBwYWdlQ29udGVudC5tYXRjaCgve3tERUZBVUxUU09SVDouKj99fS8pPy5bMF1dLmZpbHRlcihCb29sZWFuKS5qb2luKCdcXG4nKTtcblxuICAgICAgICAgICAgaWYgKG9sZFJlZGlyZWN0VGFyZ2V0KSByZWRpcmVjdElucHV0LnNldFZhbHVlKG9sZFJlZGlyZWN0VGFyZ2V0LnJlcGxhY2VBbGwoJ18nLCAnICcpKTtcbiAgICAgICAgICAgIGVsc2UgbXcubm90aWZ5KCdDb3VsZCBub3QgZmluZCByZWRpcmVjdCB0YXJnZXQhJywgeyB0eXBlOiAnZXJyb3InIH0pO1xuICAgICAgICAgICAgdGFnU2VsZWN0LnNldFZhbHVlKG9sZFJlZGlyZWN0VGFncyk7XG4gICAgICAgIH1cbiAgICB9XG59KTtcbiJdLAogICJtYXBwaW5ncyI6ICI7QUEwQkEsR0FBRyxPQUFPLE1BQU0sQ0FBQyxrQkFBa0IsZ0JBQWdCLG1CQUFtQixnQ0FBZ0MsbUNBQW1DLEdBQUcsWUFBWTtBQUNwSixNQUFJLEdBQUcsT0FBTyxJQUFJLG1CQUFtQixJQUFJO0FBQUc7QUFDNUMsTUFBSSxDQUFDLEdBQUcsT0FBTyxJQUFJLHNCQUFzQjtBQUFHO0FBQzVDLE1BQUksR0FBRyxPQUFPLElBQUksVUFBVSxNQUFNLFVBQVUsQ0FBQyxHQUFHLE9BQU8sSUFBSSxhQUFhO0FBQUc7QUFDM0UsTUFBSSxHQUFHLEtBQUssY0FBYyxPQUFPLEtBQUssR0FBRyxPQUFPLElBQUksYUFBYTtBQUFHO0FBRXBFLFFBQU0sY0FBYyxTQUFTLGNBQWMsa0JBQWtCO0FBRTdELE1BQUksQ0FBQztBQUFhLFdBQU8sR0FBRyxPQUFPLHdDQUF3QyxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBRTVGLFFBQU0sb0JBQW9CLEtBQUssT0FBUSxNQUFNLElBQUksR0FBRyxJQUFJLEVBQUUsSUFBSSxFQUFFLFFBQVEsU0FBUyxlQUFlLEdBQUcsTUFBTSxhQUFhLFFBQVEsV0FBVyxTQUFTLEtBQUssUUFBUSw0Q0FBNEMsQ0FBQyxHQUEyQixNQUFNLFFBQVEsQ0FBQyxHQUFHLFlBQVksQ0FBQyxHQUFHLE9BQU8sTUFBTSxXQUFXLElBQUk7QUFFclMsUUFBTSxZQUFZLEdBQUcsT0FBTyxJQUFJLFlBQVk7QUFDNUMsUUFBTSxrQkFBa0IsR0FBRyxNQUFNLFlBQVksU0FBUztBQUV0RCxNQUFJLENBQUM7QUFBaUIsV0FBTyxHQUFHLE9BQU8sK0JBQStCLEVBQUUsTUFBTSxRQUFRLENBQUM7QUFF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LENBQUMsQ0FBQyxJQUFJQSxLQUFJLE1BQU0sQ0FBQyxDQUFDLEVBQUUsRUFBRSxLQUFLLEdBQUcsQ0FBQyxrQkFBa0IsRUFBRSxLQUFLLFdBQVc7QUFDckwsaUJBQU8sUUFBUSxDQUFDLEtBQUssTUFBTSxDQUFDLENBQUMsSUFBSTtBQUFBLFFBQ3JDLENBQUMsRUFDQSxPQUFPLE9BQU87QUFBQSxNQUN2QjtBQUNBLHFCQUFlLENBQUMsWUFBWSxNQUFNLDZCQUE2QixJQUFJLENBQUMsR0FBRyxZQUFZLE1BQU0sc0JBQXNCLElBQUksQ0FBQyxHQUFHLFlBQVksTUFBTSx5QkFBeUIsSUFBSSxDQUFDLEdBQUcsWUFBWSxNQUFNLHFCQUFxQixJQUFJLENBQUMsQ0FBQyxFQUFFLE9BQU8sT0FBTyxFQUFFLEtBQUssSUFBSTtBQUVsUCxVQUFJO0FBQW1CLHNCQUFjLFNBQVMsa0JBQWtCLFdBQVcsS0FBSyxHQUFHLENBQUM7QUFBQTtBQUMvRSxXQUFHLE9BQU8sbUNBQW1DLEVBQUUsTUFBTSxRQUFRLENBQUM7QUFDbkUsZ0JBQVUsU0FBUyxlQUFlO0FBQUEsSUFDdEM7QUFBQSxFQUNKO0FBQ0osQ0FBQzsiLAogICJuYW1lcyI6IFsiZGF0YSIsICJlcnJvckNvZGUiLCAiZXJyb3IiLCAib3V0cHV0IiwgInRhZyJdCn0K
