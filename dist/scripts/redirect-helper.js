"use strict";
mw.loader.using(["mediawiki.util", "oojs-ui-core", "oojs-ui-widgets", "oojs-ui.styles.icons-content", "oojs-ui.styles.icons-editing-core"], async () => {
  if (mw.config.get("wgNamespaceNumber") < 0)
    return;
  if (!mw.config.get("wgIsProbablyEditable"))
    return;
  if (mw.config.get("wgAction") !== "view" || !mw.config.get("wgIsArticle"))
    return;
  if (mw.util.getParamValue("oldid") || mw.config.get("wgDiffOldId"))
    return;
  const contentText = document.querySelector("#mw-content-text");
  if (!contentText)
    return mw.notify("Failed to find content text element!", { type: "error" });
  const redirectTemplates = JSON.parse(
    (await new mw.Api().get({
      action: "query",
      formatversion: 2,
      prop: "revisions",
      rvprop: "content",
      rvslots: "*",
      titles: "User:Eejit43/scripts/redirect-helper.json"
    })).query.pages?.[0]?.revisions?.[0]?.slots?.main?.content || "[]"
  );
  const pageTitle = mw.config.get("wgPageName");
  const pageTitleParsed = mw.Title.newFromText(pageTitle);
  if (!pageTitleParsed)
    return mw.notify("Failed to parse page title!", { type: "error" });
  const pageInfo = await new mw.Api().get({ action: "query", formatversion: 2, prop: "info", titles: pageTitle });
  if (pageInfo.query.pages[0].missing) {
    const button = new OO.ui.ButtonWidget({ label: "Create redirect", icon: "articleRedirect", flags: ["progressive"] });
    button.$element[0].style.marginBottom = "20px";
    button.on("click", () => {
      button.$element[0].remove();
      showRedirectInfo(false);
    });
    contentText.prepend(button.$element[0]);
  } else if (pageInfo.query.pages[0].redirect)
    showRedirectInfo(true);
  else {
    const portletLink = mw.util.addPortletLink(mw.config.get("skin") === "minerva" ? "p-tb" : "p-cactions", "#", "Redirect page", "redirect-helper");
    portletLink.addEventListener("click", (event) => {
      event.preventDefault();
      showRedirectInfo(false);
    });
  }
  async function showRedirectInfo(exists) {
    const editorBox = new OO.ui.PanelLayout({ padded: true, expanded: false, framed: true });
    editorBox.$element[0].style.backgroundColor = "#95d4bc";
    editorBox.$element[0].style.width = "700px";
    editorBox.$element[0].style.maxWidth = "calc(100% - 50px)";
    editorBox.$element[0].style.marginLeft = "auto";
    editorBox.$element[0].style.marginRight = "auto";
    editorBox.$element[0].style.marginBottom = "20px";
    let syncWithMainButton;
    if (pageTitleParsed.isTalkPage()) {
      const mainPageData = await new mw.Api().get({ action: "query", formatversion: 2, prop: "info", titles: pageTitleParsed.getSubjectPage().getPrefixedText() });
      if (mainPageData.query.pages[0].redirect) {
        const mainPageContent = (await new mw.Api().get({
          action: "query",
          formatversion: 2,
          prop: "revisions",
          rvprop: "content",
          rvslots: "*",
          titles: pageTitleParsed.getSubjectPage().getPrefixedText()
        })).query.pages[0].revisions[0].slots.main.content.trim();
        syncWithMainButton = new OO.ui.ButtonWidget({ label: "Sync with main page", icon: "link", flags: ["progressive"] });
        syncWithMainButton.on("click", () => {
          const target = /^#redirect:?\s*\[\[\s*([^[\]{|}]+?)\s*(?:\|[^[\]{|}]+?)?]]\s*/i.exec(mainPageContent)?.[1];
          if (!target)
            return mw.notify("Failed to parse main page content!", { type: "error" });
          redirectInput.setValue(mw.Title.newFromText(target)?.getTalkPage()?.toString() ?? "");
          const fromMove = ["R from move", ...redirectTemplates["R from move"]].some(
            (tagOrRedirect) => new RegExp(`{{\\s*[${tagOrRedirect[0].toLowerCase()}${tagOrRedirect[0]}]${tagOrRedirect.slice(1)}\\s*(\\||}})`).test(mainPageContent)
          );
          if (fromMove)
            tagSelect.setValue(["R from move"]);
        });
      }
    }
    class RedirectInputWidget extends OO.ui.TextInputWidget {
      constructor(config) {
        super(config);
        this.getLookupRequest = () => {
          const value = this.getValue();
          const deferred = $.Deferred();
          if (!value)
            deferred.resolve([]);
          else if (value.includes("#")) {
            const title = value.split("#")[0];
            new mw.Api().get({ action: "parse", page: title, prop: "sections", redirects: "1" }).catch(() => null).then((result) => {
              if (result) {
                const matchedSections = result.parse.sections.filter((section) => section.line.toLowerCase().startsWith(value.split("#")[1].toLowerCase()));
                deferred.resolve(matchedSections.map((section) => ({ data: `${result.parse.title}#${section.line}`, label: `${result.parse.title}#${section.line}` })));
              } else
                deferred.resolve([]);
            });
          } else {
            const parsedTitle = mw.Title.newFromText(value);
            new mw.Api().get({
              action: "query",
              formatversion: 2,
              gaplimit: 20,
              gapnamespace: parsedTitle?.namespace ?? 0,
              gapprefix: parsedTitle?.title ?? value,
              generator: "allpages",
              prop: "info|pageprops"
            }).catch(() => null).then((result) => {
              if (result)
                deferred.resolve(
                  result.query?.pages ? result.query.pages.filter((page) => page.title !== pageTitleParsed.toString()).map((page) => ({
                    data: page.title,
                    label: new OO.ui.HtmlSnippet(
                      `${page.title}${page.pageprops && "disambiguation" in page.pageprops ? " <i>(disambiguation)</i>" : ""}${"redirect" in page ? " <i>(redirect)</i>" : ""}`
                    )
                  })) : []
                );
              else
                deferred.resolve([]);
            });
          }
          return deferred.promise({ abort() {
          } });
        };
        this.getLookupCacheDataFromResponse = (response) => response ?? [];
        this.getLookupMenuOptionsFromData = (data) => data.map(({ data: data2, label }) => new OO.ui.MenuOptionWidget({ data: data2, label }));
        OO.ui.mixin.LookupElement.call(this, config);
      }
    }
    Object.assign(RedirectInputWidget.prototype, OO.ui.mixin.LookupElement.prototype);
    const redirectInput = new RedirectInputWidget({ placeholder: "Target page name", required: true });
    redirectInput.on("change", () => {
      let value = redirectInput.getValue();
      value = value.replace(new RegExp(`^(https?:)?/{2}?${mw.config.get("wgServer").replace(/^\/{2}/, "")}/wiki/`), "");
      value = value.replace(/^:/, "");
      if (value.length > 0) {
        redirectInput.setValue(value[0].toUpperCase() + value.slice(1).replaceAll("_", " "));
        submitButton.setDisabled(false);
      } else
        submitButton.setDisabled(true);
      updateSummary();
      submitButton.setLabel("Submit");
      needsCheck = true;
    });
    const redirectInputLayout = new OO.ui.FieldLayout(redirectInput, { label: new OO.ui.HtmlSnippet("<b>Redirect target:</b>"), align: "top" });
    const tagSelect = new OO.ui.MenuTagMultiselectWidget({
      allowArbitrary: false,
      allowReordering: false,
      options: Object.keys(redirectTemplates).map((tag) => ({ data: tag, label: tag }))
    });
    tagSelect.getMenu().filterMode = "substring";
    tagSelect.on("change", () => {
      const sortedTags = tagSelect.getValue().sort((a, b) => a.toLowerCase().localeCompare(b.toLowerCase()));
      if (tagSelect.getValue().join(";") !== sortedTags.join(";"))
        tagSelect.setValue(sortedTags);
      updateSummary();
      submitButton.setLabel("Submit");
      needsCheck = true;
    });
    const tagSelectLayout = new OO.ui.FieldLayout(tagSelect, { label: new OO.ui.HtmlSnippet("<b>Redirect categorization template(s):</b>"), align: "top" });
    const summaryInput = new OO.ui.ComboBoxInputWidget({
      options: [
        { data: "Resolve double redirect" },
        //
        { data: "Resolve self redirect" },
        { data: "Remove incorrect rcats" }
      ]
    });
    const summaryInputLayout = new OO.ui.FieldLayout(summaryInput, { label: new OO.ui.HtmlSnippet("<b>Summary:</b>"), align: "top" });
    const submitButton = new OO.ui.ButtonWidget({ label: "Submit", disabled: true, flags: ["progressive"] });
    submitButton.$element[0].style.marginBottom = "0";
    let needsCheck = true;
    submitButton.on("click", async () => {
      for (const element of [redirectInput, tagSelect, summaryInput, submitButton, syncTalkCheckbox, patrolCheckbox].filter(Boolean))
        element.setDisabled(true);
      submitButton.setLabel("Checking target validity...");
      let parsedDestination;
      const errors = [];
      if (needsCheck) {
        const destination = redirectInput.getValue().trim();
        if (!/^\s*[^[\]{|}]+\s*$/.test(destination))
          errors.push({ title: destination, message: "is not a valid page title!" });
        try {
          parsedDestination = mw.Title.newFromText(destination);
        } catch {
          if (errors.length === 0)
            errors.push({ title: destination, message: "is not a valid page title!" });
        }
        if (!parsedDestination && errors.length === 0)
          errors.push({ title: destination, message: "is not a valid page title!" });
        if (parsedDestination?.toString() === pageTitleParsed.toString())
          errors.push({ message: "cannot redirect to itself!" });
        const destinationData = await new mw.Api().get({ action: "query", formatversion: 2, prop: "pageprops", titles: destination }).catch((errorCode) => {
          if (errorCode === "missingtitle")
            errors.push({ title: destination, message: "does not exist!" });
          else
            errors.push({ title: destination, message: `was not able to be fetched from the API (${errorCode})!` });
          return null;
        });
        const destinationParseResult = await new mw.Api().get({ action: "parse", page: destination, prop: "sections", redirects: "1" });
        if (destinationParseResult.parse.redirects?.[0]) {
          const destinationRedirect = destinationParseResult.parse.redirects[0].to + (destinationParseResult.parse.redirects[0].tofragment ? `#${destinationParseResult.parse.redirects[0].tofragment}` : "");
          errors.push({
            title: destination,
            message: `is a redirect to <a href="${mw.util.getUrl(
              destinationRedirect
            )}" target="_blank">${destinationRedirect}</a>. Retarget to that page instead, as double redirects aren't allowed.`
          });
        }
        if (destination.split("#").length > 1) {
          const validSection = destinationParseResult.parse.sections.find((section) => section.line === destination.split("#")[1]);
          if (validSection) {
            if (tagSelect.getValue().includes("R to anchor"))
              errors.push({ message: "is tagged as a redirect to an anchor, but it is actually a redirect to a section!" });
            if (!tagSelect.getValue().includes("R to section"))
              errors.push({ message: "is a redirect to a section, but it is not tagged with <code>{{R to section}}</code>!" });
          } else {
            const destinationContent = (await new mw.Api().get({
              action: "query",
              formatversion: 2,
              prop: "revisions",
              rvprop: "content",
              rvslots: "*",
              titles: parsedDestination.toString()
            })).query.pages[0].revisions[0].slots.main.content;
            const anchors = [
              ...destinationContent.match(/(?<={{\s*?[Aa](?:nchors?|nchor for redirect|nker|NCHOR|nc)\s*?\|).+?(?=}})/g)?.map((anchor) => anchor.split("|").map((part) => part.trim()))?.flat() ?? [],
              ...destinationContent.match(/(?<={{\s*?(?:[Vv](?:isible anchors?|isanc|Anch|anchor|isibleanchor|a)|[Aa](?:nchord|chored|nchor\+)|[Tt]ext anchor)\s*?\|).+?(?=(?<!!|=)}})/g)?.map(
                (anchor) => anchor.split("|").map((part) => part.trim()).filter((part) => !/^text\s*?=/.test(part))
              )?.flat() ?? [],
              ...destinationContent.match(/(?<=id=)"?.+?(?="|>|\|)/g)?.map((anchor) => anchor.trim()) ?? []
            ];
            if (anchors.includes(destination.split("#")[1])) {
              if (tagSelect.getValue().includes("R to section"))
                errors.push({ message: "is tagged as a redirect to a section, but it is actually a redirect to an anchor!" });
              if (!tagSelect.getValue().includes("R to anchor"))
                errors.push({ message: "is a redirect to an anchor, but it is not tagged with <code>{{R from anchor}}</code>!" });
            } else
              errors.push({ message: `is a redirect to <a href="${mw.util.getUrl(destination)}" target="_blank">${destination}</a>, but that section or anchor does not exist!` });
          }
        }
        if (destination.split("#").length === 1 && (tagSelect.getValue().includes("R to section") || tagSelect.getValue().includes("R to anchor")))
          errors.push({ message: "is not a redirect to a section/anchor, but it is tagged with <code>{{R from section}}</code> or <code>{{R from anchor}}</code>!" });
        if (destinationData.query.pages[0].pageprops && "disambiguation" in destinationData.query.pages[0].pageprops && ![
          "R from ambiguous sort name",
          "R from ambiguous term",
          "R to disambiguation page",
          "R from incomplete disambiguation",
          "R from incorrect disambiguation",
          "R from other disambiguation"
        ].some((template) => tagSelect.getValue().includes(template)))
          errors.push({ message: "is a redirect to a disambiguation page, but it is not tagged with a disambiguation categorization template!" });
        if (destinationData.query.pages[0].pageprops && !("disambiguation" in destinationData.query.pages[0].pageprops) && ["R from ambiguous sort name", "R from ambiguous term", "R to disambiguation page", "R from incomplete disambiguation"].some((template) => tagSelect.getValue().includes(template)))
          errors.push({ message: "is not a redirect to a disambiguation page, but it is tagged with a disambiguation categorization template!" });
        if (tagSelect.getValue().includes("R to disambiguation page") && !pageTitleParsed.getMainText().endsWith(" (disambiguation)"))
          errors.push({
            message: 'is tagged with <code>{{R to disambiguation page}}</code>, but this title does not end with " (disambiguation)". Use <code>{{R from ambiguous term}}</code> or a similar categorization template instead!'
          });
        if (syncTalkCheckbox?.isSelected() && !talkData.query.pages[0].missing && !talkData.query.pages[0].redirect)
          errors.push({ title: pageTitleParsed.getTalkPage().getPrefixedText(), message: "exists, but is not a redirect!" });
      }
      if (errors.length > 0) {
        for (const element of document.querySelectorAll(".redirect-helper-warning"))
          element.remove();
        for (const { title, message } of errors) {
          const label = new OO.ui.HtmlSnippet(
            `${title ? `<a href="${mw.util.getUrl(title)}" target="_blank">${title}</a>` : "This page"} ${message} Click again without making changes to submit anyway.`
          );
          const warningMessage = new OO.ui.MessageWidget({ type: "error", classes: ["redirect-helper-warning"], inline: true, label });
          warningMessage.$element[0].style.marginTop = "8px";
          editorBox.$element[0].append(warningMessage.$element[0]);
        }
        for (const element of [redirectInput, tagSelect, summaryInput, submitButton, syncTalkCheckbox, patrolCheckbox].filter(Boolean))
          element.setDisabled(false);
        submitButton.setLabel("Submit anyway");
        needsCheck = false;
        return;
      }
      parsedDestination = mw.Title.newFromText(redirectInput.getValue());
      submitButton.setLabel(`${exists ? "Editing" : "Creating"} redirect...`);
      const output = [
        `#REDIRECT [[${redirectInput.getValue().trim()}]]`,
        //
        tagSelect.getValue().length > 0 ? `{{Redirect category shell|
${tagSelect.getValue().map((tag) => `{{${tag}${oldRedirectTagData?.[tag] ? `|${oldRedirectTagData[tag]}` : ""}}}`).join("\n")}
}}` : null,
        oldStrayText
      ].filter(Boolean).join("\n\n");
      const summary = (summaryInput.getValue() || summaryInput.$tabIndexed[0].placeholder) + " (via [[User:Eejit43/scripts/redirect-helper|redirect-helper]])";
      const result = await new mw.Api().edit(pageTitle, () => ({ text: output, summary })).catch((errorCode, errorInfo) => {
        if (errorCode === "nocreate-missing")
          return new mw.Api().create(pageTitle, { summary }, output).catch((errorCode2, errorInfo2) => {
            mw.notify(`Error creating ${pageTitle}: ${errorInfo2?.error.info ?? "Unknown error"} (${errorCode2})`, { type: "error" });
          });
        else {
          mw.notify(`Error editing or creating ${pageTitle}: ${errorInfo?.error.info ?? "Unknown error"} (${errorCode})`, { type: "error" });
          return null;
        }
      });
      if (!result)
        return;
      mw.notify(`Redirect ${exists ? "edited" : "created"} successfully!`, { type: "success" });
      if (syncTalkCheckbox?.isSelected()) {
        submitButton.setLabel("Editing talk page...");
        const fromMove = tagSelect.getValue().includes("R from move");
        const output2 = [
          `#REDIRECT [[${parsedDestination.getTalkPage().getPrefixedText()}]]`,
          //
          fromMove ? "{{Redirect category shell|\n{{R from move}}\n}}" : null
        ].filter(Boolean).join("\n\n");
        const talkPage = pageTitleParsed.getTalkPage().getPrefixedText();
        const talkResult = await new mw.Api().edit(talkPage, () => ({ text: output2, summary: "Syncing redirect from main page (via [[User:Eejit43/scripts/redirect-helper|redirect-helper]])" })).catch((errorCode, errorInfo) => {
          if (errorCode === "nocreate-missing")
            return new mw.Api().create(talkPage, { summary: "Syncing redirect from main page (via [[User:Eejit43/scripts/redirect-helper|redirect-helper]])" }, output2).catch((errorCode2, errorInfo2) => {
              mw.notify(`Error creating ${talkPage}: ${errorInfo2?.error.info ?? "Unknown error"} (${errorCode2})`, { type: "error" });
            });
          else {
            mw.notify(`Error editing or creating ${talkPage}: ${errorInfo?.error.info ?? "Unknown error"} (${errorCode})`, { type: "error" });
            return null;
          }
        });
        if (!talkResult)
          return;
        mw.notify("Talk page synced successfully!", { type: "success" });
      }
      if (patrolCheckbox?.isSelected()) {
        submitButton.setLabel("Patrolling redirect...");
        const patrolLink = document.querySelector(".patrollink a");
        const markReviewedButton = document.querySelector("#mwe-pt-mark-as-reviewed-button");
        if (patrolLink) {
          const patrolResult = await new mw.Api().postWithToken("patrol", { action: "patrol", rcid: new URL(patrolLink.href).searchParams.get("rcid") }).catch((errorCode, errorInfo) => {
            mw.notify(`Error patrolling ${pageTitle} via API: ${errorInfo?.error.info ?? "Unknown error"} (${errorCode})`, { type: "error" });
            return null;
          });
          if (patrolResult)
            mw.notify("Redirect patrolled successfully!", { type: "success" });
        } else if (markReviewedButton) {
          markReviewedButton.click();
          mw.notify("Redirect patrolled successfully!", { type: "success" });
        } else
          mw.notify("Page curation toolbar not found, redirect cannot be patrolled!", { type: "error" });
      }
      submitButton.setLabel("Complete, reloading...");
      window.location.href = mw.util.getUrl(pageTitle, { redirect: "no" });
    });
    let talkData;
    let syncTalkCheckbox, syncTalkLayout;
    if (!pageTitleParsed.isTalkPage()) {
      talkData = await new mw.Api().get({ action: "query", formatversion: 2, prop: "info", titles: pageTitleParsed.getTalkPage().getPrefixedText() });
      syncTalkCheckbox = new OO.ui.CheckboxInputWidget({ selected: !!talkData.query.pages[0].redirect });
      syncTalkLayout = new OO.ui.Widget({ content: [new OO.ui.FieldLayout(syncTalkCheckbox, { label: "Sync talk page", align: "inline" })] });
      syncTalkLayout.$element[0].style.marginBottom = "0";
    }
    const markButton = document.querySelector("#mwe-pt-mark .mwe-pt-tool-icon");
    markButton?.click();
    markButton?.click();
    let shouldPromptPatrol;
    if (mw.config.get("wgNamespaceNumber") !== 0)
      shouldPromptPatrol = false;
    else if (document.querySelector(".patrollink"))
      shouldPromptPatrol = true;
    else if (document.querySelector("#mwe-pt-mark-as-reviewed-button"))
      shouldPromptPatrol = true;
    else if (document.querySelector("#mwe-pt-mark-as-unreviewed-button"))
      shouldPromptPatrol = false;
    else {
      if (!mw.config.get("wgArticleId"))
        shouldPromptPatrol = false;
      const userPermissions = await new mw.Api().get({ action: "query", meta: "userinfo", uiprop: "rights" });
      if (!userPermissions.query.userinfo.rights.includes("patrol"))
        shouldPromptPatrol = false;
      const patrolResponse = await new mw.Api().get({ action: "pagetriagelist", page_id: mw.config.get("wgArticleId") });
      if (patrolResponse.pagetriagelist.pages[0]?.user_name === mw.config.get("wgUserName"))
        shouldPromptPatrol = false;
      else if (patrolResponse.pagetriagelist.result !== "success" || patrolResponse.pagetriagelist.pages.length === 0)
        shouldPromptPatrol = false;
      else
        shouldPromptPatrol = !Number.parseInt(patrolResponse.pagetriagelist.pages[0]?.patrol_status);
    }
    let patrolCheckbox, patrolLayout;
    if (shouldPromptPatrol) {
      patrolCheckbox = new OO.ui.CheckboxInputWidget({ selected: true });
      patrolLayout = new OO.ui.Widget({ content: [new OO.ui.FieldLayout(patrolCheckbox, { label: "Mark as patrolled", align: "inline" })] });
      patrolLayout.$element[0].style.marginBottom = "0";
    }
    const submitLayout = new OO.ui.HorizontalLayout({ items: [submitButton, syncTalkLayout, patrolLayout].filter(Boolean) });
    submitLayout.$element[0].style.marginTop = "10px";
    editorBox.$element[0].append(
      ...[syncWithMainButton?.$element?.[0], redirectInputLayout.$element[0], tagSelectLayout.$element[0], summaryInputLayout.$element[0], submitLayout.$element[0]].filter(
        Boolean
      )
    );
    contentText.prepend(editorBox.$element[0]);
    function updateSummary() {
      const redirectValue = redirectInput.getValue().trim();
      if (!redirectValue)
        summaryInput.$tabIndexed[0].placeholder = "";
      else if (exists) {
        const targetChanged = redirectValue !== oldRedirectTarget?.replaceAll("_", " ");
        const tagsChanged = tagSelect.getValue().join(";") !== oldRedirectTags?.join(";");
        if (targetChanged && tagsChanged)
          summaryInput.$tabIndexed[0].placeholder = `Changing redirect to [[${redirectValue}]] and changing categorization templates`;
        else if (targetChanged)
          summaryInput.$tabIndexed[0].placeholder = `Changing redirect to [[${redirectValue}]]`;
        else if (tagsChanged)
          summaryInput.$tabIndexed[0].placeholder = "Changing categorization templates";
        else
          summaryInput.$tabIndexed[0].placeholder = "Redirect cleanup";
      } else
        summaryInput.$tabIndexed[0].placeholder = `Creating redirect to [[${redirectValue}]]`;
    }
    let oldRedirectTarget, oldRedirectTags, oldRedirectTagData, oldStrayText;
    if (exists) {
      const pageContent = (await new mw.Api().get({ action: "query", formatversion: 2, prop: "revisions", rvprop: "content", rvslots: "*", titles: pageTitle })).query.pages[0].revisions[0].slots.main.content.trim();
      oldRedirectTarget = /^#redirect:?\s*\[\[\s*([^[\]{|}]+?)\s*(?:\|[^[\]{|}]+?)?]]\s*/i.exec(pageContent)?.[1];
      oldRedirectTags = Object.entries(redirectTemplates).map(
        ([tag, redirects]) => [tag, ...redirects].some((tagOrRedirect) => new RegExp(`{{\\s*[${tagOrRedirect[0].toLowerCase()}${tagOrRedirect[0]}]${tagOrRedirect.slice(1)}\\s*(\\||}})`).test(pageContent)) ? tag : null
      ).filter(Boolean).sort((a, b) => a.toLowerCase().localeCompare(b.toLowerCase()));
      const originalRedirectTags = Object.entries(redirectTemplates).flatMap(([tag, redirects]) => [tag, ...redirects]).map((tagOrRedirect) => new RegExp(`{{\\s*[${tagOrRedirect[0].toLowerCase()}${tagOrRedirect[0]}]${tagOrRedirect.slice(1)}\\s*(\\||}})`).test(pageContent) ? tagOrRedirect : null).filter(Boolean);
      oldRedirectTagData = Object.fromEntries(
        originalRedirectTags.map((tag) => {
          const match = new RegExp(`{{\\s*[${tag[0].toLowerCase()}${tag[0]}]${tag.slice(1)}\\|?(.*?)\\s*}}`).exec(pageContent);
          const newTag = Object.entries(redirectTemplates).find(([template, redirects]) => [template, ...redirects].includes(tag))?.[0];
          return match ? [newTag, match[1]] : null;
        }).filter(Boolean)
      );
      oldStrayText = [
        pageContent.match(/{{short description\|.*?}}/i)?.[0],
        pageContent.match(/{{DISPLAYTITLE:.*?}}/)?.[0],
        pageContent.match(/{{italic title\|?.*?}}/i)?.[0],
        pageContent.match(/{{DEFAULTSORT:.*?}}/)?.[0],
        ...pageContent.match(/\[\[[Cc]ategory:.+?]]/g) ?? []
      ].filter(Boolean).join("\n");
      if (oldRedirectTarget)
        redirectInput.setValue(oldRedirectTarget.replaceAll("_", " "));
      else
        mw.notify("Could not find redirect target!", { type: "error" });
      tagSelect.setValue(oldRedirectTags);
      updateSummary();
    }
  }
});
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vc2NyaXB0cy9yZWRpcmVjdC1oZWxwZXIudHMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbImltcG9ydCB7IE1lZGlhV2lraURhdGFFcnJvciwgUGFnZVJldmlzaW9uc1Jlc3VsdCB9IGZyb20gJy4uL2dsb2JhbC10eXBlcyc7XG5cbmludGVyZmFjZSBQYWdlSW5mb1Jlc3VsdCB7XG4gICAgcXVlcnk6IHsgcGFnZXM6IHsgbWlzc2luZz86IHN0cmluZzsgcmVkaXJlY3Q/OiBzdHJpbmcgfVtdIH07XG59XG5cbmludGVyZmFjZSBBbGxQYWdlc0dlbmVyYXRvclJlc3VsdCB7XG4gICAgcXVlcnk6IHsgcGFnZXM6IHsgdGl0bGU6IHN0cmluZzsgcGFnZXByb3BzOiB7IGRpc2FtYmlndWF0aW9uPzogc3RyaW5nIH07IHJlZGlyZWN0Pzogc3RyaW5nIH1bXSB9O1xufVxuXG5pbnRlcmZhY2UgUGFnZVBhcnNlUmVzdWx0IHtcbiAgICBwYXJzZTogeyB0aXRsZTogc3RyaW5nOyByZWRpcmVjdHM6IHsgdG86IHN0cmluZzsgdG9mcmFnbWVudDogc3RyaW5nIH1bXTsgc2VjdGlvbnM6IHsgbGluZTogc3RyaW5nIH1bXSB9O1xufVxuXG5pbnRlcmZhY2UgUGFnZXByb3BzUmVzdWx0IHtcbiAgICBxdWVyeTogeyBwYWdlczogeyBwYWdlcHJvcHM/OiB7IGRpc2FtYmlndWF0aW9uPzogc3RyaW5nIH0gfVtdIH07XG59XG5cbmludGVyZmFjZSBVc2VyUGVybWlzc2lvbnNSZXNwb25zZSB7XG4gICAgcXVlcnk6IHsgdXNlcmluZm86IHsgcmlnaHRzOiBzdHJpbmdbXSB9IH07XG59XG5cbmludGVyZmFjZSBQYWdlVHJpYWdlTGlzdFJlc3BvbnNlIHtcbiAgICBwYWdldHJpYWdlbGlzdDogeyBwYWdlczogeyB1c2VyX25hbWU6IHN0cmluZzsgcGF0cm9sX3N0YXR1czogc3RyaW5nIH1bXTsgcmVzdWx0OiBzdHJpbmcgfTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbmFtaW5nLWNvbnZlbnRpb25cbn1cblxubXcubG9hZGVyLnVzaW5nKFsnbWVkaWF3aWtpLnV0aWwnLCAnb29qcy11aS1jb3JlJywgJ29vanMtdWktd2lkZ2V0cycsICdvb2pzLXVpLnN0eWxlcy5pY29ucy1jb250ZW50JywgJ29vanMtdWkuc3R5bGVzLmljb25zLWVkaXRpbmctY29yZSddLCBhc3luYyAoKSA9PiB7XG4gICAgaWYgKG13LmNvbmZpZy5nZXQoJ3dnTmFtZXNwYWNlTnVtYmVyJykgPCAwKSByZXR1cm47IC8vIERvbid0IHJ1biBpbiB2aXJ0dWFsIG5hbWVzcGFjZXNcbiAgICBpZiAoIW13LmNvbmZpZy5nZXQoJ3dnSXNQcm9iYWJseUVkaXRhYmxlJykpIHJldHVybjsgLy8gRG9uJ3QgcnVuIGlmIHVzZXIgY2FuJ3QgZWRpdCBwYWdlXG4gICAgaWYgKG13LmNvbmZpZy5nZXQoJ3dnQWN0aW9uJykgIT09ICd2aWV3JyB8fCAhbXcuY29uZmlnLmdldCgnd2dJc0FydGljbGUnKSkgcmV0dXJuOyAvLyBEb24ndCBydW4gaWYgbm90IHZpZXdpbmcgcGFnZVxuICAgIGlmIChtdy51dGlsLmdldFBhcmFtVmFsdWUoJ29sZGlkJykgfHwgbXcuY29uZmlnLmdldCgnd2dEaWZmT2xkSWQnKSkgcmV0dXJuOyAvLyBEb24ndCBydW4gaWYgdmlld2luZyBvbGQgcmV2aXNpb24gb3IgZGlmZlxuXG4gICAgY29uc3QgY29udGVudFRleHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbXctY29udGVudC10ZXh0JykgYXMgSFRNTERpdkVsZW1lbnQ7XG5cbiAgICBpZiAoIWNvbnRlbnRUZXh0KSByZXR1cm4gbXcubm90aWZ5KCdGYWlsZWQgdG8gZmluZCBjb250ZW50IHRleHQgZWxlbWVudCEnLCB7IHR5cGU6ICdlcnJvcicgfSk7XG5cbiAgICBjb25zdCByZWRpcmVjdFRlbXBsYXRlcyA9IEpTT04ucGFyc2UoXG4gICAgICAgIChcbiAgICAgICAgICAgIChhd2FpdCBuZXcgbXcuQXBpKCkuZ2V0KHtcbiAgICAgICAgICAgICAgICBhY3Rpb246ICdxdWVyeScsXG4gICAgICAgICAgICAgICAgZm9ybWF0dmVyc2lvbjogMixcbiAgICAgICAgICAgICAgICBwcm9wOiAncmV2aXNpb25zJyxcbiAgICAgICAgICAgICAgICBydnByb3A6ICdjb250ZW50JyxcbiAgICAgICAgICAgICAgICBydnNsb3RzOiAnKicsXG4gICAgICAgICAgICAgICAgdGl0bGVzOiAnVXNlcjpFZWppdDQzL3NjcmlwdHMvcmVkaXJlY3QtaGVscGVyLmpzb24nLFxuICAgICAgICAgICAgfSkpIGFzIFBhZ2VSZXZpc2lvbnNSZXN1bHRcbiAgICAgICAgKS5xdWVyeS5wYWdlcz8uWzBdPy5yZXZpc2lvbnM/LlswXT8uc2xvdHM/Lm1haW4/LmNvbnRlbnQgfHwgJ1tdJyxcbiAgICApIGFzIFJlY29yZDxzdHJpbmcsIHN0cmluZ1tdPjtcblxuICAgIGNvbnN0IHBhZ2VUaXRsZSA9IG13LmNvbmZpZy5nZXQoJ3dnUGFnZU5hbWUnKTtcbiAgICBjb25zdCBwYWdlVGl0bGVQYXJzZWQgPSBtdy5UaXRsZS5uZXdGcm9tVGV4dChwYWdlVGl0bGUpITtcblxuICAgIGlmICghcGFnZVRpdGxlUGFyc2VkKSByZXR1cm4gbXcubm90aWZ5KCdGYWlsZWQgdG8gcGFyc2UgcGFnZSB0aXRsZSEnLCB7IHR5cGU6ICdlcnJvcicgfSk7XG5cbiAgICBjb25zdCBwYWdlSW5mbyA9IChhd2FpdCBuZXcgbXcuQXBpKCkuZ2V0KHsgYWN0aW9uOiAncXVlcnknLCBmb3JtYXR2ZXJzaW9uOiAyLCBwcm9wOiAnaW5mbycsIHRpdGxlczogcGFnZVRpdGxlIH0pKSBhcyBQYWdlSW5mb1Jlc3VsdDtcblxuICAgIGlmIChwYWdlSW5mby5xdWVyeS5wYWdlc1swXS5taXNzaW5nKSB7XG4gICAgICAgIGNvbnN0IGJ1dHRvbiA9IG5ldyBPTy51aS5CdXR0b25XaWRnZXQoeyBsYWJlbDogJ0NyZWF0ZSByZWRpcmVjdCcsIGljb246ICdhcnRpY2xlUmVkaXJlY3QnLCBmbGFnczogWydwcm9ncmVzc2l2ZSddIH0pO1xuICAgICAgICBidXR0b24uJGVsZW1lbnRbMF0uc3R5bGUubWFyZ2luQm90dG9tID0gJzIwcHgnO1xuICAgICAgICBidXR0b24ub24oJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICAgICAgYnV0dG9uLiRlbGVtZW50WzBdLnJlbW92ZSgpO1xuICAgICAgICAgICAgc2hvd1JlZGlyZWN0SW5mbyhmYWxzZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnRlbnRUZXh0LnByZXBlbmQoYnV0dG9uLiRlbGVtZW50WzBdKTtcbiAgICB9IGVsc2UgaWYgKHBhZ2VJbmZvLnF1ZXJ5LnBhZ2VzWzBdLnJlZGlyZWN0KSBzaG93UmVkaXJlY3RJbmZvKHRydWUpO1xuICAgIGVsc2Uge1xuICAgICAgICBjb25zdCBwb3J0bGV0TGluayA9IG13LnV0aWwuYWRkUG9ydGxldExpbmsobXcuY29uZmlnLmdldCgnc2tpbicpID09PSAnbWluZXJ2YScgPyAncC10YicgOiAncC1jYWN0aW9ucycsICcjJywgJ1JlZGlyZWN0IHBhZ2UnLCAncmVkaXJlY3QtaGVscGVyJyk7XG4gICAgICAgIHBvcnRsZXRMaW5rLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgc2hvd1JlZGlyZWN0SW5mbyhmYWxzZSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNob3dzIHRoZSByZWRpcmVjdCBpbmZvcm1hdGlvbiBib3guXG4gICAgICogQHBhcmFtIGV4aXN0cyBXaGV0aGVyIHRoZSBwYWdlIGV4aXN0cy5cbiAgICAgKi9cbiAgICBhc3luYyBmdW5jdGlvbiBzaG93UmVkaXJlY3RJbmZvKGV4aXN0czogYm9vbGVhbik6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCBlZGl0b3JCb3ggPSBuZXcgT08udWkuUGFuZWxMYXlvdXQoeyBwYWRkZWQ6IHRydWUsIGV4cGFuZGVkOiBmYWxzZSwgZnJhbWVkOiB0cnVlIH0pO1xuICAgICAgICBlZGl0b3JCb3guJGVsZW1lbnRbMF0uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJyM5NWQ0YmMnO1xuICAgICAgICBlZGl0b3JCb3guJGVsZW1lbnRbMF0uc3R5bGUud2lkdGggPSAnNzAwcHgnO1xuICAgICAgICBlZGl0b3JCb3guJGVsZW1lbnRbMF0uc3R5bGUubWF4V2lkdGggPSAnY2FsYygxMDAlIC0gNTBweCknO1xuICAgICAgICBlZGl0b3JCb3guJGVsZW1lbnRbMF0uc3R5bGUubWFyZ2luTGVmdCA9ICdhdXRvJztcbiAgICAgICAgZWRpdG9yQm94LiRlbGVtZW50WzBdLnN0eWxlLm1hcmdpblJpZ2h0ID0gJ2F1dG8nO1xuICAgICAgICBlZGl0b3JCb3guJGVsZW1lbnRbMF0uc3R5bGUubWFyZ2luQm90dG9tID0gJzIwcHgnO1xuXG4gICAgICAgIGxldCBzeW5jV2l0aE1haW5CdXR0b247XG5cbiAgICAgICAgaWYgKHBhZ2VUaXRsZVBhcnNlZC5pc1RhbGtQYWdlKCkpIHtcbiAgICAgICAgICAgIGNvbnN0IG1haW5QYWdlRGF0YSA9IChhd2FpdCBuZXcgbXcuQXBpKCkuZ2V0KHsgYWN0aW9uOiAncXVlcnknLCBmb3JtYXR2ZXJzaW9uOiAyLCBwcm9wOiAnaW5mbycsIHRpdGxlczogcGFnZVRpdGxlUGFyc2VkLmdldFN1YmplY3RQYWdlKCkhLmdldFByZWZpeGVkVGV4dCgpIH0pKSBhcyBQYWdlSW5mb1Jlc3VsdDtcblxuICAgICAgICAgICAgaWYgKG1haW5QYWdlRGF0YS5xdWVyeS5wYWdlc1swXS5yZWRpcmVjdCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IG1haW5QYWdlQ29udGVudCA9IChcbiAgICAgICAgICAgICAgICAgICAgKGF3YWl0IG5ldyBtdy5BcGkoKS5nZXQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAncXVlcnknLFxuICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0dmVyc2lvbjogMixcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb3A6ICdyZXZpc2lvbnMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgcnZwcm9wOiAnY29udGVudCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBydnNsb3RzOiAnKicsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZXM6IHBhZ2VUaXRsZVBhcnNlZC5nZXRTdWJqZWN0UGFnZSgpIS5nZXRQcmVmaXhlZFRleHQoKSxcbiAgICAgICAgICAgICAgICAgICAgfSkpIGFzIFBhZ2VSZXZpc2lvbnNSZXN1bHRcbiAgICAgICAgICAgICAgICApLnF1ZXJ5LnBhZ2VzWzBdLnJldmlzaW9uc1swXS5zbG90cy5tYWluLmNvbnRlbnQudHJpbSgpO1xuICAgICAgICAgICAgICAgIHN5bmNXaXRoTWFpbkJ1dHRvbiA9IG5ldyBPTy51aS5CdXR0b25XaWRnZXQoeyBsYWJlbDogJ1N5bmMgd2l0aCBtYWluIHBhZ2UnLCBpY29uOiAnbGluaycsIGZsYWdzOiBbJ3Byb2dyZXNzaXZlJ10gfSk7XG4gICAgICAgICAgICAgICAgc3luY1dpdGhNYWluQnV0dG9uLm9uKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0ID0gL14jcmVkaXJlY3Q6P1xccypcXFtcXFtcXHMqKFteW1xcXXt8fV0rPylcXHMqKD86XFx8W15bXFxde3x9XSs/KT9dXVxccyovaS5leGVjKG1haW5QYWdlQ29udGVudCk/LlsxXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0YXJnZXQpIHJldHVybiBtdy5ub3RpZnkoJ0ZhaWxlZCB0byBwYXJzZSBtYWluIHBhZ2UgY29udGVudCEnLCB7IHR5cGU6ICdlcnJvcicgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgcmVkaXJlY3RJbnB1dC5zZXRWYWx1ZShtdy5UaXRsZS5uZXdGcm9tVGV4dCh0YXJnZXQpPy5nZXRUYWxrUGFnZSgpPy50b1N0cmluZygpID8/ICcnKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZnJvbU1vdmUgPSBbJ1IgZnJvbSBtb3ZlJywgLi4ucmVkaXJlY3RUZW1wbGF0ZXNbJ1IgZnJvbSBtb3ZlJ11dLnNvbWUoKHRhZ09yUmVkaXJlY3QpID0+XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgUmVnRXhwKGB7e1xcXFxzKlske3RhZ09yUmVkaXJlY3RbMF0udG9Mb3dlckNhc2UoKX0ke3RhZ09yUmVkaXJlY3RbMF19XSR7dGFnT3JSZWRpcmVjdC5zbGljZSgxKX1cXFxccyooXFxcXHx8fX0pYCkudGVzdChtYWluUGFnZUNvbnRlbnQpLFxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZnJvbU1vdmUpIHRhZ1NlbGVjdC5zZXRWYWx1ZShbJ1IgZnJvbSBtb3ZlJ10pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLyogUmVkaXJlY3QgdGFyZ2V0IGlucHV0ICovXG4gICAgICAgIGludGVyZmFjZSBSZWRpcmVjdElucHV0V2lkZ2V0Q29uZmlnIGV4dGVuZHMgT08udWkuVGV4dElucHV0V2lkZ2V0LkNvbmZpZ09wdGlvbnMsIE9PLnVpLm1peGluLkxvb2t1cEVsZW1lbnQuQ29uZmlnT3B0aW9ucyB7fVxuXG4gICAgICAgIGNsYXNzIFJlZGlyZWN0SW5wdXRXaWRnZXQgZXh0ZW5kcyBPTy51aS5UZXh0SW5wdXRXaWRnZXQge1xuICAgICAgICAgICAgY29uc3RydWN0b3IoY29uZmlnOiBSZWRpcmVjdElucHV0V2lkZ2V0Q29uZmlnKSB7XG4gICAgICAgICAgICAgICAgc3VwZXIoY29uZmlnKTtcbiAgICAgICAgICAgICAgICBPTy51aS5taXhpbi5Mb29rdXBFbGVtZW50LmNhbGwodGhpcyBhcyB1bmtub3duIGFzIE9PLnVpLm1peGluLkxvb2t1cEVsZW1lbnQsIGNvbmZpZyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGdldExvb2t1cFJlcXVlc3QgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLmdldFZhbHVlKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgZGVmZXJyZWQgPSAkLkRlZmVycmVkKCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIXZhbHVlKSBkZWZlcnJlZC5yZXNvbHZlKFtdKTtcbiAgICAgICAgICAgICAgICBlbHNlIGlmICh2YWx1ZS5pbmNsdWRlcygnIycpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHRpdGxlID0gdmFsdWUuc3BsaXQoJyMnKVswXTtcblxuICAgICAgICAgICAgICAgICAgICBuZXcgbXcuQXBpKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5nZXQoeyBhY3Rpb246ICdwYXJzZScsIHBhZ2U6IHRpdGxlLCBwcm9wOiAnc2VjdGlvbnMnLCByZWRpcmVjdHM6ICcxJyB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKCgpID0+IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbigocmVzdWx0OiBQYWdlUGFyc2VSZXN1bHQgfCBudWxsKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXRjaGVkU2VjdGlvbnMgPSByZXN1bHQucGFyc2Uuc2VjdGlvbnMuZmlsdGVyKChzZWN0aW9uKSA9PiBzZWN0aW9uLmxpbmUudG9Mb3dlckNhc2UoKS5zdGFydHNXaXRoKHZhbHVlLnNwbGl0KCcjJylbMV0udG9Mb3dlckNhc2UoKSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKG1hdGNoZWRTZWN0aW9ucy5tYXAoKHNlY3Rpb24pID0+ICh7IGRhdGE6IGAke3Jlc3VsdC5wYXJzZS50aXRsZX0jJHtzZWN0aW9uLmxpbmV9YCwgbGFiZWw6IGAke3Jlc3VsdC5wYXJzZS50aXRsZX0jJHtzZWN0aW9uLmxpbmV9YCB9KSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBkZWZlcnJlZC5yZXNvbHZlKFtdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhcnNlZFRpdGxlID0gbXcuVGl0bGUubmV3RnJvbVRleHQodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICBuZXcgbXcuQXBpKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5nZXQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3F1ZXJ5JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXR2ZXJzaW9uOiAyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhcGxpbWl0OiAyMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYXBuYW1lc3BhY2U6IHBhcnNlZFRpdGxlPy5uYW1lc3BhY2UgPz8gMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYXBwcmVmaXg6IHBhcnNlZFRpdGxlPy50aXRsZSA/PyB2YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZW5lcmF0b3I6ICdhbGxwYWdlcycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcDogJ2luZm98cGFnZXByb3BzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKCkgPT4gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKChyZXN1bHQ6IEFsbFBhZ2VzR2VuZXJhdG9yUmVzdWx0IHwgbnVsbCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucXVlcnk/LnBhZ2VzIC8vXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyByZXN1bHQucXVlcnkucGFnZXMgLy9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKChwYWdlKSA9PiBwYWdlLnRpdGxlICE9PSBwYWdlVGl0bGVQYXJzZWQudG9TdHJpbmcoKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAubWFwKChwYWdlKSA9PiAoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBwYWdlLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogbmV3IE9PLnVpLkh0bWxTbmlwcGV0KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYCR7cGFnZS50aXRsZX0ke3BhZ2UucGFnZXByb3BzICYmICdkaXNhbWJpZ3VhdGlvbicgaW4gcGFnZS5wYWdlcHJvcHMgPyAnIDxpPihkaXNhbWJpZ3VhdGlvbik8L2k+JyA6ICcnfSR7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3JlZGlyZWN0JyBpbiBwYWdlID8gJyA8aT4ocmVkaXJlY3QpPC9pPicgOiAnJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfWAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGRlZmVycmVkLnJlc29sdmUoW10pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2UoeyBhYm9ydCgpIHt9IH0pOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1lbXB0eS1mdW5jdGlvblxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgZ2V0TG9va3VwQ2FjaGVEYXRhRnJvbVJlc3BvbnNlID0gPFQ+KHJlc3BvbnNlOiBUW10gfCBudWxsIHwgdW5kZWZpbmVkKSA9PiByZXNwb25zZSA/PyBbXTtcblxuICAgICAgICAgICAgZ2V0TG9va3VwTWVudU9wdGlvbnNGcm9tRGF0YSA9IChkYXRhOiB7IGRhdGE6IHN0cmluZzsgbGFiZWw6IHN0cmluZyB9W10pID0+IGRhdGEubWFwKCh7IGRhdGEsIGxhYmVsIH0pID0+IG5ldyBPTy51aS5NZW51T3B0aW9uV2lkZ2V0KHsgZGF0YSwgbGFiZWwgfSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgT2JqZWN0LmFzc2lnbihSZWRpcmVjdElucHV0V2lkZ2V0LnByb3RvdHlwZSwgT08udWkubWl4aW4uTG9va3VwRWxlbWVudC5wcm90b3R5cGUpO1xuXG4gICAgICAgIGNvbnN0IHJlZGlyZWN0SW5wdXQgPSBuZXcgUmVkaXJlY3RJbnB1dFdpZGdldCh7IHBsYWNlaG9sZGVyOiAnVGFyZ2V0IHBhZ2UgbmFtZScsIHJlcXVpcmVkOiB0cnVlIH0pO1xuICAgICAgICByZWRpcmVjdElucHV0Lm9uKCdjaGFuZ2UnLCAoKSA9PiB7XG4gICAgICAgICAgICBsZXQgdmFsdWUgPSByZWRpcmVjdElucHV0LmdldFZhbHVlKCk7XG4gICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UobmV3IFJlZ0V4cChgXihodHRwcz86KT8vezJ9PyR7bXcuY29uZmlnLmdldCgnd2dTZXJ2ZXInKS5yZXBsYWNlKC9eXFwvezJ9LywgJycpfS93aWtpL2ApLCAnJyk7XG4gICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL146LywgJycpO1xuXG4gICAgICAgICAgICBpZiAodmFsdWUubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHJlZGlyZWN0SW5wdXQuc2V0VmFsdWUodmFsdWVbMF0udG9VcHBlckNhc2UoKSArIHZhbHVlLnNsaWNlKDEpLnJlcGxhY2VBbGwoJ18nLCAnICcpKTtcbiAgICAgICAgICAgICAgICBzdWJtaXRCdXR0b24uc2V0RGlzYWJsZWQoZmFsc2UpO1xuICAgICAgICAgICAgfSBlbHNlIHN1Ym1pdEJ1dHRvbi5zZXREaXNhYmxlZCh0cnVlKTtcblxuICAgICAgICAgICAgdXBkYXRlU3VtbWFyeSgpO1xuICAgICAgICAgICAgc3VibWl0QnV0dG9uLnNldExhYmVsKCdTdWJtaXQnKTtcbiAgICAgICAgICAgIG5lZWRzQ2hlY2sgPSB0cnVlO1xuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCByZWRpcmVjdElucHV0TGF5b3V0ID0gbmV3IE9PLnVpLkZpZWxkTGF5b3V0KHJlZGlyZWN0SW5wdXQsIHsgbGFiZWw6IG5ldyBPTy51aS5IdG1sU25pcHBldCgnPGI+UmVkaXJlY3QgdGFyZ2V0OjwvYj4nKSwgYWxpZ246ICd0b3AnIH0pO1xuXG4gICAgICAgIC8qIFJlZGlyZWN0IGNhdGVnb3JpemF0aW9uIHRlbXBsYXRlIHNlbGVjdGlvbiAqL1xuICAgICAgICBjb25zdCB0YWdTZWxlY3QgPSBuZXcgT08udWkuTWVudVRhZ011bHRpc2VsZWN0V2lkZ2V0KHtcbiAgICAgICAgICAgIGFsbG93QXJiaXRyYXJ5OiBmYWxzZSxcbiAgICAgICAgICAgIGFsbG93UmVvcmRlcmluZzogZmFsc2UsXG4gICAgICAgICAgICBvcHRpb25zOiBPYmplY3Qua2V5cyhyZWRpcmVjdFRlbXBsYXRlcykubWFwKCh0YWcpID0+ICh7IGRhdGE6IHRhZywgbGFiZWw6IHRhZyB9KSksXG4gICAgICAgIH0pO1xuICAgICAgICAodGFnU2VsZWN0LmdldE1lbnUoKSBhcyBPTy51aS5NZW51U2VsZWN0V2lkZ2V0LkNvbmZpZ09wdGlvbnMpLmZpbHRlck1vZGUgPSAnc3Vic3RyaW5nJztcbiAgICAgICAgdGFnU2VsZWN0Lm9uKCdjaGFuZ2UnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzb3J0ZWRUYWdzID0gKHRhZ1NlbGVjdC5nZXRWYWx1ZSgpIGFzIHN0cmluZ1tdKS5zb3J0KChhLCBiKSA9PiBhLnRvTG93ZXJDYXNlKCkubG9jYWxlQ29tcGFyZShiLnRvTG93ZXJDYXNlKCkpKTtcblxuICAgICAgICAgICAgaWYgKCh0YWdTZWxlY3QuZ2V0VmFsdWUoKSBhcyBzdHJpbmdbXSkuam9pbignOycpICE9PSBzb3J0ZWRUYWdzLmpvaW4oJzsnKSkgdGFnU2VsZWN0LnNldFZhbHVlKHNvcnRlZFRhZ3MpO1xuXG4gICAgICAgICAgICB1cGRhdGVTdW1tYXJ5KCk7XG4gICAgICAgICAgICBzdWJtaXRCdXR0b24uc2V0TGFiZWwoJ1N1Ym1pdCcpO1xuICAgICAgICAgICAgbmVlZHNDaGVjayA9IHRydWU7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IHRhZ1NlbGVjdExheW91dCA9IG5ldyBPTy51aS5GaWVsZExheW91dCh0YWdTZWxlY3QsIHsgbGFiZWw6IG5ldyBPTy51aS5IdG1sU25pcHBldCgnPGI+UmVkaXJlY3QgY2F0ZWdvcml6YXRpb24gdGVtcGxhdGUocyk6PC9iPicpLCBhbGlnbjogJ3RvcCcgfSk7XG5cbiAgICAgICAgLyogU3VtbWFyeSBpbnB1dCAqL1xuICAgICAgICBjb25zdCBzdW1tYXJ5SW5wdXQgPSBuZXcgT08udWkuQ29tYm9Cb3hJbnB1dFdpZGdldCh7XG4gICAgICAgICAgICBvcHRpb25zOiBbXG4gICAgICAgICAgICAgICAgeyBkYXRhOiAnUmVzb2x2ZSBkb3VibGUgcmVkaXJlY3QnIH0sIC8vXG4gICAgICAgICAgICAgICAgeyBkYXRhOiAnUmVzb2x2ZSBzZWxmIHJlZGlyZWN0JyB9LFxuICAgICAgICAgICAgICAgIHsgZGF0YTogJ1JlbW92ZSBpbmNvcnJlY3QgcmNhdHMnIH0sXG4gICAgICAgICAgICBdLFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBzdW1tYXJ5SW5wdXRMYXlvdXQgPSBuZXcgT08udWkuRmllbGRMYXlvdXQoc3VtbWFyeUlucHV0LCB7IGxhYmVsOiBuZXcgT08udWkuSHRtbFNuaXBwZXQoJzxiPlN1bW1hcnk6PC9iPicpLCBhbGlnbjogJ3RvcCcgfSk7XG5cbiAgICAgICAgLyogU3VibWl0IGJ1dHRvbiAqL1xuICAgICAgICBjb25zdCBzdWJtaXRCdXR0b24gPSBuZXcgT08udWkuQnV0dG9uV2lkZ2V0KHsgbGFiZWw6ICdTdWJtaXQnLCBkaXNhYmxlZDogdHJ1ZSwgZmxhZ3M6IFsncHJvZ3Jlc3NpdmUnXSB9KTtcbiAgICAgICAgc3VibWl0QnV0dG9uLiRlbGVtZW50WzBdLnN0eWxlLm1hcmdpbkJvdHRvbSA9ICcwJztcblxuICAgICAgICBsZXQgbmVlZHNDaGVjayA9IHRydWU7XG4gICAgICAgIHN1Ym1pdEJ1dHRvbi5vbignY2xpY2snLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgW3JlZGlyZWN0SW5wdXQsIHRhZ1NlbGVjdCwgc3VtbWFyeUlucHV0LCBzdWJtaXRCdXR0b24sIHN5bmNUYWxrQ2hlY2tib3gsIHBhdHJvbENoZWNrYm94XS5maWx0ZXIoQm9vbGVhbikpIChlbGVtZW50IGFzIE9PLnVpLldpZGdldCkuc2V0RGlzYWJsZWQodHJ1ZSk7XG4gICAgICAgICAgICBzdWJtaXRCdXR0b24uc2V0TGFiZWwoJ0NoZWNraW5nIHRhcmdldCB2YWxpZGl0eS4uLicpO1xuXG4gICAgICAgICAgICBsZXQgcGFyc2VkRGVzdGluYXRpb247XG5cbiAgICAgICAgICAgIGNvbnN0IGVycm9ycyA9IFtdO1xuXG4gICAgICAgICAgICAvKiBUaXRsZSB2YWxpZGF0aW9uICovXG4gICAgICAgICAgICBpZiAobmVlZHNDaGVjaykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGRlc3RpbmF0aW9uID0gcmVkaXJlY3RJbnB1dC5nZXRWYWx1ZSgpLnRyaW0oKTtcblxuICAgICAgICAgICAgICAgIC8qIEludmFsaWQgY2hhcmFjdGVycyAqL1xuICAgICAgICAgICAgICAgIGlmICghL15cXHMqW15bXFxde3x9XStcXHMqJC8udGVzdChkZXN0aW5hdGlvbikpIGVycm9ycy5wdXNoKHsgdGl0bGU6IGRlc3RpbmF0aW9uLCBtZXNzYWdlOiAnaXMgbm90IGEgdmFsaWQgcGFnZSB0aXRsZSEnIH0pO1xuXG4gICAgICAgICAgICAgICAgLyogRmFpbGVkIGR1cmluZyB0aXRsZSBwYXJzaW5nICovXG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgcGFyc2VkRGVzdGluYXRpb24gPSBtdy5UaXRsZS5uZXdGcm9tVGV4dChkZXN0aW5hdGlvbik7XG4gICAgICAgICAgICAgICAgfSBjYXRjaCB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlcnJvcnMubGVuZ3RoID09PSAwKSBlcnJvcnMucHVzaCh7IHRpdGxlOiBkZXN0aW5hdGlvbiwgbWVzc2FnZTogJ2lzIG5vdCBhIHZhbGlkIHBhZ2UgdGl0bGUhJyB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCFwYXJzZWREZXN0aW5hdGlvbiAmJiBlcnJvcnMubGVuZ3RoID09PSAwKSBlcnJvcnMucHVzaCh7IHRpdGxlOiBkZXN0aW5hdGlvbiwgbWVzc2FnZTogJ2lzIG5vdCBhIHZhbGlkIHBhZ2UgdGl0bGUhJyB9KTtcblxuICAgICAgICAgICAgICAgIC8qIFNlbGYgcmVkaXJlY3RzICovXG4gICAgICAgICAgICAgICAgaWYgKHBhcnNlZERlc3RpbmF0aW9uPy50b1N0cmluZygpID09PSBwYWdlVGl0bGVQYXJzZWQudG9TdHJpbmcoKSkgZXJyb3JzLnB1c2goeyBtZXNzYWdlOiAnY2Fubm90IHJlZGlyZWN0IHRvIGl0c2VsZiEnIH0pO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgZGVzdGluYXRpb25EYXRhID0gKGF3YWl0IG5ldyBtdy5BcGkoKS5nZXQoeyBhY3Rpb246ICdxdWVyeScsIGZvcm1hdHZlcnNpb246IDIsIHByb3A6ICdwYWdlcHJvcHMnLCB0aXRsZXM6IGRlc3RpbmF0aW9uIH0pLmNhdGNoKChlcnJvckNvZGU6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgICAgICAgICAvKiBOb24tZXhpc3RlbnQgZGVzdGluYXRpb24gKi8gaWYgKGVycm9yQ29kZSA9PT0gJ21pc3Npbmd0aXRsZScpIGVycm9ycy5wdXNoKHsgdGl0bGU6IGRlc3RpbmF0aW9uLCBtZXNzYWdlOiAnZG9lcyBub3QgZXhpc3QhJyB9KTtcbiAgICAgICAgICAgICAgICAgICAgLyogT3RoZXIgQVBJIGVycm9yICovIGVsc2UgZXJyb3JzLnB1c2goeyB0aXRsZTogZGVzdGluYXRpb24sIG1lc3NhZ2U6IGB3YXMgbm90IGFibGUgdG8gYmUgZmV0Y2hlZCBmcm9tIHRoZSBBUEkgKCR7ZXJyb3JDb2RlfSkhYCB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgfSkpIGFzIFBhZ2Vwcm9wc1Jlc3VsdCB8IG51bGw7XG4gICAgICAgICAgICAgICAgY29uc3QgZGVzdGluYXRpb25QYXJzZVJlc3VsdCA9IChhd2FpdCBuZXcgbXcuQXBpKCkuZ2V0KHsgYWN0aW9uOiAncGFyc2UnLCBwYWdlOiBkZXN0aW5hdGlvbiwgcHJvcDogJ3NlY3Rpb25zJywgcmVkaXJlY3RzOiAnMScgfSkpIGFzIFBhZ2VQYXJzZVJlc3VsdDtcblxuICAgICAgICAgICAgICAgIC8qIERvdWJsZSByZWRpcmVjdHMgKi9cbiAgICAgICAgICAgICAgICBpZiAoZGVzdGluYXRpb25QYXJzZVJlc3VsdC5wYXJzZS5yZWRpcmVjdHM/LlswXSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBkZXN0aW5hdGlvblJlZGlyZWN0ID1cbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uUGFyc2VSZXN1bHQucGFyc2UucmVkaXJlY3RzWzBdLnRvICsgKGRlc3RpbmF0aW9uUGFyc2VSZXN1bHQucGFyc2UucmVkaXJlY3RzWzBdLnRvZnJhZ21lbnQgPyBgIyR7ZGVzdGluYXRpb25QYXJzZVJlc3VsdC5wYXJzZS5yZWRpcmVjdHNbMF0udG9mcmFnbWVudH1gIDogJycpO1xuICAgICAgICAgICAgICAgICAgICBlcnJvcnMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogZGVzdGluYXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBgaXMgYSByZWRpcmVjdCB0byA8YSBocmVmPVwiJHttdy51dGlsLmdldFVybChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0aW5hdGlvblJlZGlyZWN0LFxuICAgICAgICAgICAgICAgICAgICAgICAgKX1cIiB0YXJnZXQ9XCJfYmxhbmtcIj4ke2Rlc3RpbmF0aW9uUmVkaXJlY3R9PC9hPi4gUmV0YXJnZXQgdG8gdGhhdCBwYWdlIGluc3RlYWQsIGFzIGRvdWJsZSByZWRpcmVjdHMgYXJlbid0IGFsbG93ZWQuYCxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLyogTm9uLWV4aXN0ZW50IHNlY3Rpb24gKi9cbiAgICAgICAgICAgICAgICBpZiAoZGVzdGluYXRpb24uc3BsaXQoJyMnKS5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbGlkU2VjdGlvbiA9IGRlc3RpbmF0aW9uUGFyc2VSZXN1bHQucGFyc2Uuc2VjdGlvbnMuZmluZCgoc2VjdGlvbikgPT4gc2VjdGlvbi5saW5lID09PSBkZXN0aW5hdGlvbi5zcGxpdCgnIycpWzFdKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbGlkU2VjdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhZ1NlbGVjdC5nZXRWYWx1ZSgpLmluY2x1ZGVzKCdSIHRvIGFuY2hvcicpKSBlcnJvcnMucHVzaCh7IG1lc3NhZ2U6ICdpcyB0YWdnZWQgYXMgYSByZWRpcmVjdCB0byBhbiBhbmNob3IsIGJ1dCBpdCBpcyBhY3R1YWxseSBhIHJlZGlyZWN0IHRvIGEgc2VjdGlvbiEnIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0YWdTZWxlY3QuZ2V0VmFsdWUoKS5pbmNsdWRlcygnUiB0byBzZWN0aW9uJykpIGVycm9ycy5wdXNoKHsgbWVzc2FnZTogJ2lzIGEgcmVkaXJlY3QgdG8gYSBzZWN0aW9uLCBidXQgaXQgaXMgbm90IHRhZ2dlZCB3aXRoIDxjb2RlPnt7UiB0byBzZWN0aW9ufX08L2NvZGU+IScgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkZXN0aW5hdGlvbkNvbnRlbnQgPSAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKGF3YWl0IG5ldyBtdy5BcGkoKS5nZXQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICdxdWVyeScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdHZlcnNpb246IDIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3A6ICdyZXZpc2lvbnMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBydnByb3A6ICdjb250ZW50JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcnZzbG90czogJyonLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZXM6IHBhcnNlZERlc3RpbmF0aW9uIS50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKSBhcyBQYWdlUmV2aXNpb25zUmVzdWx0XG4gICAgICAgICAgICAgICAgICAgICAgICApLnF1ZXJ5LnBhZ2VzWzBdLnJldmlzaW9uc1swXS5zbG90cy5tYWluLmNvbnRlbnQ7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFuY2hvcnMgPSBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLi4uKGRlc3RpbmF0aW9uQ29udGVudFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAubWF0Y2goLyg/PD17e1xccyo/W0FhXSg/Om5jaG9ycz98bmNob3IgZm9yIHJlZGlyZWN0fG5rZXJ8TkNIT1J8bmMpXFxzKj9cXHwpLis/KD89fX0pL2cpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8ubWFwKChhbmNob3I6IHN0cmluZykgPT4gYW5jaG9yLnNwbGl0KCd8JykubWFwKChwYXJ0KSA9PiBwYXJ0LnRyaW0oKSkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8uZmxhdCgpID8/IFtdKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuLi4oZGVzdGluYXRpb25Db250ZW50XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5tYXRjaCgvKD88PXt7XFxzKj8oPzpbVnZdKD86aXNpYmxlIGFuY2hvcnM/fGlzYW5jfEFuY2h8YW5jaG9yfGlzaWJsZWFuY2hvcnxhKXxbQWFdKD86bmNob3JkfGNob3JlZHxuY2hvclxcKyl8W1R0XWV4dCBhbmNob3IpXFxzKj9cXHwpLis/KD89KD88ISF8PSl9fSkvZylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPy5tYXAoKGFuY2hvcjogc3RyaW5nKSA9PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5jaG9yXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnNwbGl0KCd8JylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAubWFwKChwYXJ0KSA9PiBwYXJ0LnRyaW0oKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKChwYXJ0KSA9PiAhL150ZXh0XFxzKj89Ly50ZXN0KHBhcnQpKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/LmZsYXQoKSA/PyBbXSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLi4uKGRlc3RpbmF0aW9uQ29udGVudC5tYXRjaCgvKD88PWlkPSlcIj8uKz8oPz1cInw+fFxcfCkvZyk/Lm1hcCgoYW5jaG9yOiBzdHJpbmcpID0+IGFuY2hvci50cmltKCkpID8/IFtdKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYW5jaG9ycy5pbmNsdWRlcyhkZXN0aW5hdGlvbi5zcGxpdCgnIycpWzFdKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YWdTZWxlY3QuZ2V0VmFsdWUoKS5pbmNsdWRlcygnUiB0byBzZWN0aW9uJykpIGVycm9ycy5wdXNoKHsgbWVzc2FnZTogJ2lzIHRhZ2dlZCBhcyBhIHJlZGlyZWN0IHRvIGEgc2VjdGlvbiwgYnV0IGl0IGlzIGFjdHVhbGx5IGEgcmVkaXJlY3QgdG8gYW4gYW5jaG9yIScgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0YWdTZWxlY3QuZ2V0VmFsdWUoKS5pbmNsdWRlcygnUiB0byBhbmNob3InKSkgZXJyb3JzLnB1c2goeyBtZXNzYWdlOiAnaXMgYSByZWRpcmVjdCB0byBhbiBhbmNob3IsIGJ1dCBpdCBpcyBub3QgdGFnZ2VkIHdpdGggPGNvZGU+e3tSIGZyb20gYW5jaG9yfX08L2NvZGU+IScgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgZXJyb3JzLnB1c2goeyBtZXNzYWdlOiBgaXMgYSByZWRpcmVjdCB0byA8YSBocmVmPVwiJHttdy51dGlsLmdldFVybChkZXN0aW5hdGlvbil9XCIgdGFyZ2V0PVwiX2JsYW5rXCI+JHtkZXN0aW5hdGlvbn08L2E+LCBidXQgdGhhdCBzZWN0aW9uIG9yIGFuY2hvciBkb2VzIG5vdCBleGlzdCFgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLyogSW1wcm9wZXJseSB0YWdnZWQgYXMgcmVkaXJlY3QgdG8gc2VjdGlvbi9hbmNob3IgKi9cbiAgICAgICAgICAgICAgICBpZiAoZGVzdGluYXRpb24uc3BsaXQoJyMnKS5sZW5ndGggPT09IDEgJiYgKHRhZ1NlbGVjdC5nZXRWYWx1ZSgpLmluY2x1ZGVzKCdSIHRvIHNlY3Rpb24nKSB8fCB0YWdTZWxlY3QuZ2V0VmFsdWUoKS5pbmNsdWRlcygnUiB0byBhbmNob3InKSkpXG4gICAgICAgICAgICAgICAgICAgIGVycm9ycy5wdXNoKHsgbWVzc2FnZTogJ2lzIG5vdCBhIHJlZGlyZWN0IHRvIGEgc2VjdGlvbi9hbmNob3IsIGJ1dCBpdCBpcyB0YWdnZWQgd2l0aCA8Y29kZT57e1IgZnJvbSBzZWN0aW9ufX08L2NvZGU+IG9yIDxjb2RlPnt7UiBmcm9tIGFuY2hvcn19PC9jb2RlPiEnIH0pO1xuXG4gICAgICAgICAgICAgICAgLyogUmVkaXJlY3QgdG8gZGlzYW1iaWd1YXRpb24gcGFnZSB3aXRob3V0IHRlbXBsYXRlICovXG4gICAgICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbkRhdGEhLnF1ZXJ5LnBhZ2VzWzBdLnBhZ2Vwcm9wcyAmJlxuICAgICAgICAgICAgICAgICAgICAnZGlzYW1iaWd1YXRpb24nIGluIGRlc3RpbmF0aW9uRGF0YSEucXVlcnkucGFnZXNbMF0ucGFnZXByb3BzICYmXG4gICAgICAgICAgICAgICAgICAgICFbXG4gICAgICAgICAgICAgICAgICAgICAgICAnUiBmcm9tIGFtYmlndW91cyBzb3J0IG5hbWUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ1IgZnJvbSBhbWJpZ3VvdXMgdGVybScsXG4gICAgICAgICAgICAgICAgICAgICAgICAnUiB0byBkaXNhbWJpZ3VhdGlvbiBwYWdlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICdSIGZyb20gaW5jb21wbGV0ZSBkaXNhbWJpZ3VhdGlvbicsXG4gICAgICAgICAgICAgICAgICAgICAgICAnUiBmcm9tIGluY29ycmVjdCBkaXNhbWJpZ3VhdGlvbicsXG4gICAgICAgICAgICAgICAgICAgICAgICAnUiBmcm9tIG90aGVyIGRpc2FtYmlndWF0aW9uJyxcbiAgICAgICAgICAgICAgICAgICAgXS5zb21lKCh0ZW1wbGF0ZSkgPT4gdGFnU2VsZWN0LmdldFZhbHVlKCkuaW5jbHVkZXModGVtcGxhdGUpKVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgZXJyb3JzLnB1c2goeyBtZXNzYWdlOiAnaXMgYSByZWRpcmVjdCB0byBhIGRpc2FtYmlndWF0aW9uIHBhZ2UsIGJ1dCBpdCBpcyBub3QgdGFnZ2VkIHdpdGggYSBkaXNhbWJpZ3VhdGlvbiBjYXRlZ29yaXphdGlvbiB0ZW1wbGF0ZSEnIH0pO1xuXG4gICAgICAgICAgICAgICAgLyogSW1wcm9wZXJseSB0YWdnZWQgYXMgcmVkaXJlY3QgdG8gZGlzYW1iaWd1YXRpb24gcGFnZSAqL1xuICAgICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAgICAgZGVzdGluYXRpb25EYXRhIS5xdWVyeS5wYWdlc1swXS5wYWdlcHJvcHMgJiZcbiAgICAgICAgICAgICAgICAgICAgISgnZGlzYW1iaWd1YXRpb24nIGluIGRlc3RpbmF0aW9uRGF0YSEucXVlcnkucGFnZXNbMF0ucGFnZXByb3BzKSAmJlxuICAgICAgICAgICAgICAgICAgICBbJ1IgZnJvbSBhbWJpZ3VvdXMgc29ydCBuYW1lJywgJ1IgZnJvbSBhbWJpZ3VvdXMgdGVybScsICdSIHRvIGRpc2FtYmlndWF0aW9uIHBhZ2UnLCAnUiBmcm9tIGluY29tcGxldGUgZGlzYW1iaWd1YXRpb24nXS5zb21lKCh0ZW1wbGF0ZSkgPT4gdGFnU2VsZWN0LmdldFZhbHVlKCkuaW5jbHVkZXModGVtcGxhdGUpKVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgZXJyb3JzLnB1c2goeyBtZXNzYWdlOiAnaXMgbm90IGEgcmVkaXJlY3QgdG8gYSBkaXNhbWJpZ3VhdGlvbiBwYWdlLCBidXQgaXQgaXMgdGFnZ2VkIHdpdGggYSBkaXNhbWJpZ3VhdGlvbiBjYXRlZ29yaXphdGlvbiB0ZW1wbGF0ZSEnIH0pO1xuXG4gICAgICAgICAgICAgICAgLyoge3tSIHRvIGRpc2FtYmlndWF0aW9uIHBhZ2V9fSB3aXRob3V0IFwiIChkaXNhbWJpZ3VhdGlvbilcIiBhdCBlbmQgb2YgdGl0bGUgKi9cbiAgICAgICAgICAgICAgICBpZiAodGFnU2VsZWN0LmdldFZhbHVlKCkuaW5jbHVkZXMoJ1IgdG8gZGlzYW1iaWd1YXRpb24gcGFnZScpICYmICFwYWdlVGl0bGVQYXJzZWQuZ2V0TWFpblRleHQoKS5lbmRzV2l0aCgnIChkaXNhbWJpZ3VhdGlvbiknKSlcbiAgICAgICAgICAgICAgICAgICAgZXJyb3JzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaXMgdGFnZ2VkIHdpdGggPGNvZGU+e3tSIHRvIGRpc2FtYmlndWF0aW9uIHBhZ2V9fTwvY29kZT4sIGJ1dCB0aGlzIHRpdGxlIGRvZXMgbm90IGVuZCB3aXRoIFwiIChkaXNhbWJpZ3VhdGlvbilcIi4gVXNlIDxjb2RlPnt7UiBmcm9tIGFtYmlndW91cyB0ZXJtfX08L2NvZGU+IG9yIGEgc2ltaWxhciBjYXRlZ29yaXphdGlvbiB0ZW1wbGF0ZSBpbnN0ZWFkIScsXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLyogU3luY2luZyB0YWxrIHBhZ2UgYnV0IHRhbGsgcGFnZSBleGlzdHMgYW5kIGlzbid0IGEgcmVkaXJlY3QgKi9cbiAgICAgICAgICAgICAgICBpZiAoc3luY1RhbGtDaGVja2JveD8uaXNTZWxlY3RlZCgpICYmICF0YWxrRGF0YSEucXVlcnkucGFnZXNbMF0ubWlzc2luZyAmJiAhdGFsa0RhdGEhLnF1ZXJ5LnBhZ2VzWzBdLnJlZGlyZWN0KVxuICAgICAgICAgICAgICAgICAgICBlcnJvcnMucHVzaCh7IHRpdGxlOiBwYWdlVGl0bGVQYXJzZWQuZ2V0VGFsa1BhZ2UoKSEuZ2V0UHJlZml4ZWRUZXh0KCksIG1lc3NhZ2U6ICdleGlzdHMsIGJ1dCBpcyBub3QgYSByZWRpcmVjdCEnIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoZXJyb3JzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnJlZGlyZWN0LWhlbHBlci13YXJuaW5nJykpIGVsZW1lbnQucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCB7IHRpdGxlLCBtZXNzYWdlIH0gb2YgZXJyb3JzKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGxhYmVsID0gbmV3IE9PLnVpLkh0bWxTbmlwcGV0KFxuICAgICAgICAgICAgICAgICAgICAgICAgYCR7dGl0bGUgPyBgPGEgaHJlZj1cIiR7bXcudXRpbC5nZXRVcmwodGl0bGUpfVwiIHRhcmdldD1cIl9ibGFua1wiPiR7dGl0bGV9PC9hPmAgOiAnVGhpcyBwYWdlJ30gJHttZXNzYWdlfSBDbGljayBhZ2FpbiB3aXRob3V0IG1ha2luZyBjaGFuZ2VzIHRvIHN1Ym1pdCBhbnl3YXkuYCxcbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgd2FybmluZ01lc3NhZ2UgPSBuZXcgT08udWkuTWVzc2FnZVdpZGdldCh7IHR5cGU6ICdlcnJvcicsIGNsYXNzZXM6IFsncmVkaXJlY3QtaGVscGVyLXdhcm5pbmcnXSwgaW5saW5lOiB0cnVlLCBsYWJlbCB9KTtcbiAgICAgICAgICAgICAgICAgICAgd2FybmluZ01lc3NhZ2UuJGVsZW1lbnRbMF0uc3R5bGUubWFyZ2luVG9wID0gJzhweCc7XG5cbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yQm94LiRlbGVtZW50WzBdLmFwcGVuZCh3YXJuaW5nTWVzc2FnZS4kZWxlbWVudFswXSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBlbGVtZW50IG9mIFtyZWRpcmVjdElucHV0LCB0YWdTZWxlY3QsIHN1bW1hcnlJbnB1dCwgc3VibWl0QnV0dG9uLCBzeW5jVGFsa0NoZWNrYm94LCBwYXRyb2xDaGVja2JveF0uZmlsdGVyKEJvb2xlYW4pKSAoZWxlbWVudCBhcyBPTy51aS5XaWRnZXQpLnNldERpc2FibGVkKGZhbHNlKTtcblxuICAgICAgICAgICAgICAgIHN1Ym1pdEJ1dHRvbi5zZXRMYWJlbCgnU3VibWl0IGFueXdheScpO1xuICAgICAgICAgICAgICAgIG5lZWRzQ2hlY2sgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcGFyc2VkRGVzdGluYXRpb24gPSBtdy5UaXRsZS5uZXdGcm9tVGV4dChyZWRpcmVjdElucHV0LmdldFZhbHVlKCkpO1xuXG4gICAgICAgICAgICAvKiBFZGl0L2NyZWF0ZSByZWRpcmVjdCAqL1xuICAgICAgICAgICAgc3VibWl0QnV0dG9uLnNldExhYmVsKGAke2V4aXN0cyA/ICdFZGl0aW5nJyA6ICdDcmVhdGluZyd9IHJlZGlyZWN0Li4uYCk7XG5cbiAgICAgICAgICAgIGNvbnN0IG91dHB1dCA9IFtcbiAgICAgICAgICAgICAgICBgI1JFRElSRUNUIFtbJHtyZWRpcmVjdElucHV0LmdldFZhbHVlKCkudHJpbSgpfV1dYCwgLy9cbiAgICAgICAgICAgICAgICB0YWdTZWxlY3QuZ2V0VmFsdWUoKS5sZW5ndGggPiAwXG4gICAgICAgICAgICAgICAgICAgID8gYHt7UmVkaXJlY3QgY2F0ZWdvcnkgc2hlbGx8XFxuJHsodGFnU2VsZWN0LmdldFZhbHVlKCkgYXMgc3RyaW5nW10pLm1hcCgodGFnKSA9PiBge3ske3RhZ30ke29sZFJlZGlyZWN0VGFnRGF0YT8uW3RhZ10gPyBgfCR7b2xkUmVkaXJlY3RUYWdEYXRhW3RhZ119YCA6ICcnfX19YCkuam9pbignXFxuJyl9XFxufX1gXG4gICAgICAgICAgICAgICAgICAgIDogbnVsbCxcbiAgICAgICAgICAgICAgICBvbGRTdHJheVRleHQsXG4gICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKVxuICAgICAgICAgICAgICAgIC5qb2luKCdcXG5cXG4nKTtcblxuICAgICAgICAgICAgY29uc3Qgc3VtbWFyeSA9IChzdW1tYXJ5SW5wdXQuZ2V0VmFsdWUoKSB8fCAoc3VtbWFyeUlucHV0LiR0YWJJbmRleGVkWzBdIGFzIEhUTUxJbnB1dEVsZW1lbnQpLnBsYWNlaG9sZGVyKSArICcgKHZpYSBbW1VzZXI6RWVqaXQ0My9zY3JpcHRzL3JlZGlyZWN0LWhlbHBlcnxyZWRpcmVjdC1oZWxwZXJdXSknO1xuXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBuZXcgbXcuQXBpKClcbiAgICAgICAgICAgICAgICAuZWRpdChwYWdlVGl0bGUsICgpID0+ICh7IHRleHQ6IG91dHB1dCwgc3VtbWFyeSB9KSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goKGVycm9yQ29kZTogc3RyaW5nLCBlcnJvckluZm86IE1lZGlhV2lraURhdGFFcnJvcikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3JDb2RlID09PSAnbm9jcmVhdGUtbWlzc2luZycpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IG13LkFwaSgpLmNyZWF0ZShwYWdlVGl0bGUsIHsgc3VtbWFyeSB9LCBvdXRwdXQpLmNhdGNoKChlcnJvckNvZGU6IHN0cmluZywgZXJyb3JJbmZvOiBNZWRpYVdpa2lEYXRhRXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtdy5ub3RpZnkoYEVycm9yIGNyZWF0aW5nICR7cGFnZVRpdGxlfTogJHtlcnJvckluZm8/LmVycm9yLmluZm8gPz8gJ1Vua25vd24gZXJyb3InfSAoJHtlcnJvckNvZGV9KWAsIHsgdHlwZTogJ2Vycm9yJyB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG13Lm5vdGlmeShgRXJyb3IgZWRpdGluZyBvciBjcmVhdGluZyAke3BhZ2VUaXRsZX06ICR7ZXJyb3JJbmZvPy5lcnJvci5pbmZvID8/ICdVbmtub3duIGVycm9yJ30gKCR7ZXJyb3JDb2RlfSlgLCB7IHR5cGU6ICdlcnJvcicgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoIXJlc3VsdCkgcmV0dXJuO1xuXG4gICAgICAgICAgICBtdy5ub3RpZnkoYFJlZGlyZWN0ICR7ZXhpc3RzID8gJ2VkaXRlZCcgOiAnY3JlYXRlZCd9IHN1Y2Nlc3NmdWxseSFgLCB7IHR5cGU6ICdzdWNjZXNzJyB9KTtcblxuICAgICAgICAgICAgLyogU3luYyB0YWxrIHBhZ2UgY2hlY2tib3ggaGFuZGxlciAqL1xuICAgICAgICAgICAgaWYgKHN5bmNUYWxrQ2hlY2tib3g/LmlzU2VsZWN0ZWQoKSkge1xuICAgICAgICAgICAgICAgIHN1Ym1pdEJ1dHRvbi5zZXRMYWJlbCgnRWRpdGluZyB0YWxrIHBhZ2UuLi4nKTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IGZyb21Nb3ZlID0gdGFnU2VsZWN0LmdldFZhbHVlKCkuaW5jbHVkZXMoJ1IgZnJvbSBtb3ZlJyk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBvdXRwdXQgPSBbXG4gICAgICAgICAgICAgICAgICAgIGAjUkVESVJFQ1QgW1ske3BhcnNlZERlc3RpbmF0aW9uIS5nZXRUYWxrUGFnZSgpIS5nZXRQcmVmaXhlZFRleHQoKX1dXWAsIC8vXG4gICAgICAgICAgICAgICAgICAgIGZyb21Nb3ZlID8gJ3t7UmVkaXJlY3QgY2F0ZWdvcnkgc2hlbGx8XFxue3tSIGZyb20gbW92ZX19XFxufX0nIDogbnVsbCxcbiAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbilcbiAgICAgICAgICAgICAgICAgICAgLmpvaW4oJ1xcblxcbicpO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgdGFsa1BhZ2UgPSBwYWdlVGl0bGVQYXJzZWQuZ2V0VGFsa1BhZ2UoKSEuZ2V0UHJlZml4ZWRUZXh0KCk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCB0YWxrUmVzdWx0ID0gYXdhaXQgbmV3IG13LkFwaSgpXG4gICAgICAgICAgICAgICAgICAgIC5lZGl0KHRhbGtQYWdlLCAoKSA9PiAoeyB0ZXh0OiBvdXRwdXQsIHN1bW1hcnk6ICdTeW5jaW5nIHJlZGlyZWN0IGZyb20gbWFpbiBwYWdlICh2aWEgW1tVc2VyOkVlaml0NDMvc2NyaXB0cy9yZWRpcmVjdC1oZWxwZXJ8cmVkaXJlY3QtaGVscGVyXV0pJyB9KSlcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKChlcnJvckNvZGU6IHN0cmluZywgZXJyb3JJbmZvOiBNZWRpYVdpa2lEYXRhRXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnJvckNvZGUgPT09ICdub2NyZWF0ZS1taXNzaW5nJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IG13LkFwaSgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jcmVhdGUodGFsa1BhZ2UsIHsgc3VtbWFyeTogJ1N5bmNpbmcgcmVkaXJlY3QgZnJvbSBtYWluIHBhZ2UgKHZpYSBbW1VzZXI6RWVqaXQ0My9zY3JpcHRzL3JlZGlyZWN0LWhlbHBlcnxyZWRpcmVjdC1oZWxwZXJdXSknIH0sIG91dHB1dClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKChlcnJvckNvZGU6IHN0cmluZywgZXJyb3JJbmZvOiBNZWRpYVdpa2lEYXRhRXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG13Lm5vdGlmeShgRXJyb3IgY3JlYXRpbmcgJHt0YWxrUGFnZX06ICR7ZXJyb3JJbmZvPy5lcnJvci5pbmZvID8/ICdVbmtub3duIGVycm9yJ30gKCR7ZXJyb3JDb2RlfSlgLCB7IHR5cGU6ICdlcnJvcicgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbXcubm90aWZ5KGBFcnJvciBlZGl0aW5nIG9yIGNyZWF0aW5nICR7dGFsa1BhZ2V9OiAke2Vycm9ySW5mbz8uZXJyb3IuaW5mbyA/PyAnVW5rbm93biBlcnJvcid9ICgke2Vycm9yQ29kZX0pYCwgeyB0eXBlOiAnZXJyb3InIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGlmICghdGFsa1Jlc3VsdCkgcmV0dXJuO1xuXG4gICAgICAgICAgICAgICAgbXcubm90aWZ5KCdUYWxrIHBhZ2Ugc3luY2VkIHN1Y2Nlc3NmdWxseSEnLCB7IHR5cGU6ICdzdWNjZXNzJyB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLyogUGF0cm9sIGNoZWNrYm94IGhhbmRsZXIgKi9cbiAgICAgICAgICAgIGlmIChwYXRyb2xDaGVja2JveD8uaXNTZWxlY3RlZCgpKSB7XG4gICAgICAgICAgICAgICAgc3VibWl0QnV0dG9uLnNldExhYmVsKCdQYXRyb2xsaW5nIHJlZGlyZWN0Li4uJyk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBwYXRyb2xMaW5rOiBIVE1MQW5jaG9yRWxlbWVudCB8IG51bGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucGF0cm9sbGluayBhJyk7XG4gICAgICAgICAgICAgICAgY29uc3QgbWFya1Jldmlld2VkQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI213ZS1wdC1tYXJrLWFzLXJldmlld2VkLWJ1dHRvbicpIGFzIEhUTUxCdXR0b25FbGVtZW50IHwgbnVsbDtcblxuICAgICAgICAgICAgICAgIGlmIChwYXRyb2xMaW5rKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhdHJvbFJlc3VsdCA9IGF3YWl0IG5ldyBtdy5BcGkoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnBvc3RXaXRoVG9rZW4oJ3BhdHJvbCcsIHsgYWN0aW9uOiAncGF0cm9sJywgcmNpZDogbmV3IFVSTChwYXRyb2xMaW5rLmhyZWYpLnNlYXJjaFBhcmFtcy5nZXQoJ3JjaWQnKSEgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaCgoZXJyb3JDb2RlOiBzdHJpbmcsIGVycm9ySW5mbzogTWVkaWFXaWtpRGF0YUVycm9yKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbXcubm90aWZ5KGBFcnJvciBwYXRyb2xsaW5nICR7cGFnZVRpdGxlfSB2aWEgQVBJOiAke2Vycm9ySW5mbz8uZXJyb3IuaW5mbyA/PyAnVW5rbm93biBlcnJvcid9ICgke2Vycm9yQ29kZX0pYCwgeyB0eXBlOiAnZXJyb3InIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwYXRyb2xSZXN1bHQpIG13Lm5vdGlmeSgnUmVkaXJlY3QgcGF0cm9sbGVkIHN1Y2Nlc3NmdWxseSEnLCB7IHR5cGU6ICdzdWNjZXNzJyB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1hcmtSZXZpZXdlZEJ1dHRvbikge1xuICAgICAgICAgICAgICAgICAgICBtYXJrUmV2aWV3ZWRCdXR0b24uY2xpY2soKTtcbiAgICAgICAgICAgICAgICAgICAgbXcubm90aWZ5KCdSZWRpcmVjdCBwYXRyb2xsZWQgc3VjY2Vzc2Z1bGx5IScsIHsgdHlwZTogJ3N1Y2Nlc3MnIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBtdy5ub3RpZnkoJ1BhZ2UgY3VyYXRpb24gdG9vbGJhciBub3QgZm91bmQsIHJlZGlyZWN0IGNhbm5vdCBiZSBwYXRyb2xsZWQhJywgeyB0eXBlOiAnZXJyb3InIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzdWJtaXRCdXR0b24uc2V0TGFiZWwoJ0NvbXBsZXRlLCByZWxvYWRpbmcuLi4nKTtcblxuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBtdy51dGlsLmdldFVybChwYWdlVGl0bGUsIHsgcmVkaXJlY3Q6ICdubycgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGxldCB0YWxrRGF0YTogUGFnZUluZm9SZXN1bHQgfCB1bmRlZmluZWQ7XG5cbiAgICAgICAgbGV0IHN5bmNUYWxrQ2hlY2tib3g6IE9PLnVpLkNoZWNrYm94SW5wdXRXaWRnZXQgfCB1bmRlZmluZWQsIHN5bmNUYWxrTGF5b3V0OiBPTy51aS5XaWRnZXQgfCB1bmRlZmluZWQ7XG4gICAgICAgIGlmICghcGFnZVRpdGxlUGFyc2VkLmlzVGFsa1BhZ2UoKSkge1xuICAgICAgICAgICAgdGFsa0RhdGEgPSAoYXdhaXQgbmV3IG13LkFwaSgpLmdldCh7IGFjdGlvbjogJ3F1ZXJ5JywgZm9ybWF0dmVyc2lvbjogMiwgcHJvcDogJ2luZm8nLCB0aXRsZXM6IHBhZ2VUaXRsZVBhcnNlZC5nZXRUYWxrUGFnZSgpIS5nZXRQcmVmaXhlZFRleHQoKSB9KSkgYXMgUGFnZUluZm9SZXN1bHQ7XG4gICAgICAgICAgICBzeW5jVGFsa0NoZWNrYm94ID0gbmV3IE9PLnVpLkNoZWNrYm94SW5wdXRXaWRnZXQoeyBzZWxlY3RlZDogISF0YWxrRGF0YS5xdWVyeS5wYWdlc1swXS5yZWRpcmVjdCB9KTtcblxuICAgICAgICAgICAgc3luY1RhbGtMYXlvdXQgPSBuZXcgT08udWkuV2lkZ2V0KHsgY29udGVudDogW25ldyBPTy51aS5GaWVsZExheW91dChzeW5jVGFsa0NoZWNrYm94LCB7IGxhYmVsOiAnU3luYyB0YWxrIHBhZ2UnLCBhbGlnbjogJ2lubGluZScgfSldIH0pO1xuICAgICAgICAgICAgc3luY1RhbGtMYXlvdXQuJGVsZW1lbnRbMF0uc3R5bGUubWFyZ2luQm90dG9tID0gJzAnO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgbWFya0J1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNtd2UtcHQtbWFyayAubXdlLXB0LXRvb2wtaWNvbicpIGFzIEhUTUxJbWFnZUVsZW1lbnQgfCBudWxsO1xuICAgICAgICBtYXJrQnV0dG9uPy5jbGljaygpO1xuICAgICAgICBtYXJrQnV0dG9uPy5jbGljaygpO1xuXG4gICAgICAgIGxldCBzaG91bGRQcm9tcHRQYXRyb2w7XG4gICAgICAgIGlmIChtdy5jb25maWcuZ2V0KCd3Z05hbWVzcGFjZU51bWJlcicpICE9PSAwKSBzaG91bGRQcm9tcHRQYXRyb2wgPSBmYWxzZTtcbiAgICAgICAgZWxzZSBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBhdHJvbGxpbmsnKSkgc2hvdWxkUHJvbXB0UGF0cm9sID0gdHJ1ZTtcbiAgICAgICAgZWxzZSBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI213ZS1wdC1tYXJrLWFzLXJldmlld2VkLWJ1dHRvbicpKSBzaG91bGRQcm9tcHRQYXRyb2wgPSB0cnVlO1xuICAgICAgICBlbHNlIGlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbXdlLXB0LW1hcmstYXMtdW5yZXZpZXdlZC1idXR0b24nKSkgc2hvdWxkUHJvbXB0UGF0cm9sID0gZmFsc2U7XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKCFtdy5jb25maWcuZ2V0KCd3Z0FydGljbGVJZCcpKSBzaG91bGRQcm9tcHRQYXRyb2wgPSBmYWxzZTtcbiAgICAgICAgICAgIGNvbnN0IHVzZXJQZXJtaXNzaW9ucyA9IChhd2FpdCBuZXcgbXcuQXBpKCkuZ2V0KHsgYWN0aW9uOiAncXVlcnknLCBtZXRhOiAndXNlcmluZm8nLCB1aXByb3A6ICdyaWdodHMnIH0pKSBhcyBVc2VyUGVybWlzc2lvbnNSZXNwb25zZTtcbiAgICAgICAgICAgIGlmICghdXNlclBlcm1pc3Npb25zLnF1ZXJ5LnVzZXJpbmZvLnJpZ2h0cy5pbmNsdWRlcygncGF0cm9sJykpIHNob3VsZFByb21wdFBhdHJvbCA9IGZhbHNlO1xuXG4gICAgICAgICAgICBjb25zdCBwYXRyb2xSZXNwb25zZSA9IChhd2FpdCBuZXcgbXcuQXBpKCkuZ2V0KHsgYWN0aW9uOiAncGFnZXRyaWFnZWxpc3QnLCBwYWdlX2lkOiBtdy5jb25maWcuZ2V0KCd3Z0FydGljbGVJZCcpIH0pKSBhcyBQYWdlVHJpYWdlTGlzdFJlc3BvbnNlOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uYW1pbmctY29udmVudGlvblxuXG4gICAgICAgICAgICBpZiAocGF0cm9sUmVzcG9uc2UucGFnZXRyaWFnZWxpc3QucGFnZXNbMF0/LnVzZXJfbmFtZSA9PT0gbXcuY29uZmlnLmdldCgnd2dVc2VyTmFtZScpKSBzaG91bGRQcm9tcHRQYXRyb2wgPSBmYWxzZTtcbiAgICAgICAgICAgIGVsc2UgaWYgKHBhdHJvbFJlc3BvbnNlLnBhZ2V0cmlhZ2VsaXN0LnJlc3VsdCAhPT0gJ3N1Y2Nlc3MnIHx8IHBhdHJvbFJlc3BvbnNlLnBhZ2V0cmlhZ2VsaXN0LnBhZ2VzLmxlbmd0aCA9PT0gMCkgc2hvdWxkUHJvbXB0UGF0cm9sID0gZmFsc2U7XG4gICAgICAgICAgICBlbHNlIHNob3VsZFByb21wdFBhdHJvbCA9ICFOdW1iZXIucGFyc2VJbnQocGF0cm9sUmVzcG9uc2UucGFnZXRyaWFnZWxpc3QucGFnZXNbMF0/LnBhdHJvbF9zdGF0dXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHBhdHJvbENoZWNrYm94OiBPTy51aS5DaGVja2JveElucHV0V2lkZ2V0IHwgdW5kZWZpbmVkLCBwYXRyb2xMYXlvdXQ6IE9PLnVpLldpZGdldCB8IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKHNob3VsZFByb21wdFBhdHJvbCkge1xuICAgICAgICAgICAgcGF0cm9sQ2hlY2tib3ggPSBuZXcgT08udWkuQ2hlY2tib3hJbnB1dFdpZGdldCh7IHNlbGVjdGVkOiB0cnVlIH0pO1xuXG4gICAgICAgICAgICBwYXRyb2xMYXlvdXQgPSBuZXcgT08udWkuV2lkZ2V0KHsgY29udGVudDogW25ldyBPTy51aS5GaWVsZExheW91dChwYXRyb2xDaGVja2JveCwgeyBsYWJlbDogJ01hcmsgYXMgcGF0cm9sbGVkJywgYWxpZ246ICdpbmxpbmUnIH0pXSB9KTtcbiAgICAgICAgICAgIHBhdHJvbExheW91dC4kZWxlbWVudFswXS5zdHlsZS5tYXJnaW5Cb3R0b20gPSAnMCc7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBzdWJtaXRMYXlvdXQgPSBuZXcgT08udWkuSG9yaXpvbnRhbExheW91dCh7IGl0ZW1zOiBbc3VibWl0QnV0dG9uLCBzeW5jVGFsa0xheW91dCwgcGF0cm9sTGF5b3V0XS5maWx0ZXIoQm9vbGVhbikgYXMgT08udWkuV2lkZ2V0W10gfSk7XG4gICAgICAgIHN1Ym1pdExheW91dC4kZWxlbWVudFswXS5zdHlsZS5tYXJnaW5Ub3AgPSAnMTBweCc7XG5cbiAgICAgICAgLyogQWRkIGVsZW1lbnRzIHRvIHNjcmVlbiAqL1xuICAgICAgICBlZGl0b3JCb3guJGVsZW1lbnRbMF0uYXBwZW5kKFxuICAgICAgICAgICAgLi4uKFtzeW5jV2l0aE1haW5CdXR0b24/LiRlbGVtZW50Py5bMF0sIHJlZGlyZWN0SW5wdXRMYXlvdXQuJGVsZW1lbnRbMF0sIHRhZ1NlbGVjdExheW91dC4kZWxlbWVudFswXSwgc3VtbWFyeUlucHV0TGF5b3V0LiRlbGVtZW50WzBdLCBzdWJtaXRMYXlvdXQuJGVsZW1lbnRbMF1dLmZpbHRlcihcbiAgICAgICAgICAgICAgICBCb29sZWFuLFxuICAgICAgICAgICAgKSBhcyBIVE1MRWxlbWVudFtdKSxcbiAgICAgICAgKTtcblxuICAgICAgICBjb250ZW50VGV4dC5wcmVwZW5kKGVkaXRvckJveC4kZWxlbWVudFswXSk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVwZGF0ZXMgdGhlIHN1bW1hcnkgaW5wdXQgcGxhY2Vob2xkZXIuXG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiB1cGRhdGVTdW1tYXJ5KCkge1xuICAgICAgICAgICAgY29uc3QgcmVkaXJlY3RWYWx1ZSA9IHJlZGlyZWN0SW5wdXQuZ2V0VmFsdWUoKS50cmltKCk7XG5cbiAgICAgICAgICAgIGlmICghcmVkaXJlY3RWYWx1ZSkgKHN1bW1hcnlJbnB1dC4kdGFiSW5kZXhlZFswXSBhcyBIVE1MSW5wdXRFbGVtZW50KS5wbGFjZWhvbGRlciA9ICcnO1xuICAgICAgICAgICAgZWxzZSBpZiAoZXhpc3RzKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0Q2hhbmdlZCA9IHJlZGlyZWN0VmFsdWUgIT09IG9sZFJlZGlyZWN0VGFyZ2V0Py5yZXBsYWNlQWxsKCdfJywgJyAnKTtcbiAgICAgICAgICAgICAgICBjb25zdCB0YWdzQ2hhbmdlZCA9IHRhZ1NlbGVjdC5nZXRWYWx1ZSgpLmpvaW4oJzsnKSAhPT0gb2xkUmVkaXJlY3RUYWdzPy5qb2luKCc7Jyk7XG5cbiAgICAgICAgICAgICAgICBpZiAodGFyZ2V0Q2hhbmdlZCAmJiB0YWdzQ2hhbmdlZCkgKHN1bW1hcnlJbnB1dC4kdGFiSW5kZXhlZFswXSBhcyBIVE1MSW5wdXRFbGVtZW50KS5wbGFjZWhvbGRlciA9IGBDaGFuZ2luZyByZWRpcmVjdCB0byBbWyR7cmVkaXJlY3RWYWx1ZX1dXSBhbmQgY2hhbmdpbmcgY2F0ZWdvcml6YXRpb24gdGVtcGxhdGVzYDtcbiAgICAgICAgICAgICAgICBlbHNlIGlmICh0YXJnZXRDaGFuZ2VkKSAoc3VtbWFyeUlucHV0LiR0YWJJbmRleGVkWzBdIGFzIEhUTUxJbnB1dEVsZW1lbnQpLnBsYWNlaG9sZGVyID0gYENoYW5naW5nIHJlZGlyZWN0IHRvIFtbJHtyZWRpcmVjdFZhbHVlfV1dYDtcbiAgICAgICAgICAgICAgICBlbHNlIGlmICh0YWdzQ2hhbmdlZCkgKHN1bW1hcnlJbnB1dC4kdGFiSW5kZXhlZFswXSBhcyBIVE1MSW5wdXRFbGVtZW50KS5wbGFjZWhvbGRlciA9ICdDaGFuZ2luZyBjYXRlZ29yaXphdGlvbiB0ZW1wbGF0ZXMnO1xuICAgICAgICAgICAgICAgIGVsc2UgKHN1bW1hcnlJbnB1dC4kdGFiSW5kZXhlZFswXSBhcyBIVE1MSW5wdXRFbGVtZW50KS5wbGFjZWhvbGRlciA9ICdSZWRpcmVjdCBjbGVhbnVwJztcbiAgICAgICAgICAgIH0gZWxzZSAoc3VtbWFyeUlucHV0LiR0YWJJbmRleGVkWzBdIGFzIEhUTUxJbnB1dEVsZW1lbnQpLnBsYWNlaG9sZGVyID0gYENyZWF0aW5nIHJlZGlyZWN0IHRvIFtbJHtyZWRpcmVjdFZhbHVlfV1dYDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qIExvYWQgY3VycmVudCB0YXJnZXQgYW5kIHRhZ3MsIGlmIGFwcGxpY2FibGUgKi9cbiAgICAgICAgbGV0IG9sZFJlZGlyZWN0VGFyZ2V0OiBzdHJpbmcgfCB1bmRlZmluZWQsIG9sZFJlZGlyZWN0VGFnczogc3RyaW5nW10gfCB1bmRlZmluZWQsIG9sZFJlZGlyZWN0VGFnRGF0YTogUmVjb3JkPHN0cmluZywgc3RyaW5nPiB8IHVuZGVmaW5lZCwgb2xkU3RyYXlUZXh0OiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gICAgICAgIGlmIChleGlzdHMpIHtcbiAgICAgICAgICAgIGNvbnN0IHBhZ2VDb250ZW50ID0gKFxuICAgICAgICAgICAgICAgIChhd2FpdCBuZXcgbXcuQXBpKCkuZ2V0KHsgYWN0aW9uOiAncXVlcnknLCBmb3JtYXR2ZXJzaW9uOiAyLCBwcm9wOiAncmV2aXNpb25zJywgcnZwcm9wOiAnY29udGVudCcsIHJ2c2xvdHM6ICcqJywgdGl0bGVzOiBwYWdlVGl0bGUgfSkpIGFzIFBhZ2VSZXZpc2lvbnNSZXN1bHRcbiAgICAgICAgICAgICkucXVlcnkucGFnZXNbMF0ucmV2aXNpb25zWzBdLnNsb3RzLm1haW4uY29udGVudC50cmltKCk7XG5cbiAgICAgICAgICAgIG9sZFJlZGlyZWN0VGFyZ2V0ID0gL14jcmVkaXJlY3Q6P1xccypcXFtcXFtcXHMqKFteW1xcXXt8fV0rPylcXHMqKD86XFx8W15bXFxde3x9XSs/KT9dXVxccyovaS5leGVjKHBhZ2VDb250ZW50KT8uWzFdO1xuICAgICAgICAgICAgb2xkUmVkaXJlY3RUYWdzID0gKFxuICAgICAgICAgICAgICAgIE9iamVjdC5lbnRyaWVzKHJlZGlyZWN0VGVtcGxhdGVzKVxuICAgICAgICAgICAgICAgICAgICAubWFwKChbdGFnLCByZWRpcmVjdHNdKSA9PlxuICAgICAgICAgICAgICAgICAgICAgICAgW3RhZywgLi4ucmVkaXJlY3RzXS5zb21lKCh0YWdPclJlZGlyZWN0KSA9PiBuZXcgUmVnRXhwKGB7e1xcXFxzKlske3RhZ09yUmVkaXJlY3RbMF0udG9Mb3dlckNhc2UoKX0ke3RhZ09yUmVkaXJlY3RbMF19XSR7dGFnT3JSZWRpcmVjdC5zbGljZSgxKX1cXFxccyooXFxcXHx8fX0pYCkudGVzdChwYWdlQ29udGVudCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPyB0YWdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKSBhcyBzdHJpbmdbXVxuICAgICAgICAgICAgKS5zb3J0KChhLCBiKSA9PiBhLnRvTG93ZXJDYXNlKCkubG9jYWxlQ29tcGFyZShiLnRvTG93ZXJDYXNlKCkpKTtcblxuICAgICAgICAgICAgY29uc3Qgb3JpZ2luYWxSZWRpcmVjdFRhZ3MgPSBPYmplY3QuZW50cmllcyhyZWRpcmVjdFRlbXBsYXRlcylcbiAgICAgICAgICAgICAgICAuZmxhdE1hcCgoW3RhZywgcmVkaXJlY3RzXSkgPT4gW3RhZywgLi4ucmVkaXJlY3RzXSlcbiAgICAgICAgICAgICAgICAubWFwKCh0YWdPclJlZGlyZWN0KSA9PiAobmV3IFJlZ0V4cChge3tcXFxccypbJHt0YWdPclJlZGlyZWN0WzBdLnRvTG93ZXJDYXNlKCl9JHt0YWdPclJlZGlyZWN0WzBdfV0ke3RhZ09yUmVkaXJlY3Quc2xpY2UoMSl9XFxcXHMqKFxcXFx8fH19KWApLnRlc3QocGFnZUNvbnRlbnQpID8gdGFnT3JSZWRpcmVjdCA6IG51bGwpKVxuICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbikgYXMgc3RyaW5nW107XG5cbiAgICAgICAgICAgIG9sZFJlZGlyZWN0VGFnRGF0YSA9IE9iamVjdC5mcm9tRW50cmllcyhcbiAgICAgICAgICAgICAgICBvcmlnaW5hbFJlZGlyZWN0VGFnc1xuICAgICAgICAgICAgICAgICAgICAubWFwKCh0YWcpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1hdGNoID0gbmV3IFJlZ0V4cChge3tcXFxccypbJHt0YWdbMF0udG9Mb3dlckNhc2UoKX0ke3RhZ1swXX1dJHt0YWcuc2xpY2UoMSl9XFxcXHw/KC4qPylcXFxccyp9fWApLmV4ZWMocGFnZUNvbnRlbnQpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdUYWcgPSBPYmplY3QuZW50cmllcyhyZWRpcmVjdFRlbXBsYXRlcykuZmluZCgoW3RlbXBsYXRlLCByZWRpcmVjdHNdKSA9PiBbdGVtcGxhdGUsIC4uLnJlZGlyZWN0c10uaW5jbHVkZXModGFnKSk/LlswXTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoID8gW25ld1RhZywgbWF0Y2hbMV1dIDogbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKSBhcyBbc3RyaW5nLCBzdHJpbmddW10sXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgb2xkU3RyYXlUZXh0ID0gW1xuICAgICAgICAgICAgICAgIHBhZ2VDb250ZW50Lm1hdGNoKC97e3Nob3J0IGRlc2NyaXB0aW9uXFx8Lio/fX0vaSk/LlswXSxcbiAgICAgICAgICAgICAgICBwYWdlQ29udGVudC5tYXRjaCgve3tESVNQTEFZVElUTEU6Lio/fX0vKT8uWzBdLFxuICAgICAgICAgICAgICAgIHBhZ2VDb250ZW50Lm1hdGNoKC97e2l0YWxpYyB0aXRsZVxcfD8uKj99fS9pKT8uWzBdLFxuICAgICAgICAgICAgICAgIHBhZ2VDb250ZW50Lm1hdGNoKC97e0RFRkFVTFRTT1JUOi4qP319Lyk/LlswXSxcbiAgICAgICAgICAgICAgICAuLi4ocGFnZUNvbnRlbnQubWF0Y2goL1xcW1xcW1tDY11hdGVnb3J5Oi4rP11dL2cpID8/IFtdKSxcbiAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pXG4gICAgICAgICAgICAgICAgLmpvaW4oJ1xcbicpO1xuXG4gICAgICAgICAgICBpZiAob2xkUmVkaXJlY3RUYXJnZXQpIHJlZGlyZWN0SW5wdXQuc2V0VmFsdWUob2xkUmVkaXJlY3RUYXJnZXQucmVwbGFjZUFsbCgnXycsICcgJykpO1xuICAgICAgICAgICAgZWxzZSBtdy5ub3RpZnkoJ0NvdWxkIG5vdCBmaW5kIHJlZGlyZWN0IHRhcmdldCEnLCB7IHR5cGU6ICdlcnJvcicgfSk7XG4gICAgICAgICAgICB0YWdTZWxlY3Quc2V0VmFsdWUob2xkUmVkaXJlY3RUYWdzKTtcblxuICAgICAgICAgICAgdXBkYXRlU3VtbWFyeSgpO1xuICAgICAgICB9XG4gICAgfVxufSk7XG4iXSwKICAibWFwcGluZ3MiOiAiO0FBMEJBLEdBQUcsT0FBTyxNQUFNLENBQUMsa0JBQWtCLGdCQUFnQixtQkFBbUIsZ0NBQWdDLG1DQUFtQyxHQUFHLFlBQVk7QUFDcEosTUFBSSxHQUFHLE9BQU8sSUFBSSxtQkFBbUIsSUFBSTtBQUFHO0FBQzVDLE1BQUksQ0FBQyxHQUFHLE9BQU8sSUFBSSxzQkFBc0I7QUFBRztBQUM1QyxNQUFJLEdBQUcsT0FBTyxJQUFJLFVBQVUsTUFBTSxVQUFVLENBQUMsR0FBRyxPQUFPLElBQUksYUFBYTtBQUFHO0FBQzNFLE1BQUksR0FBRyxLQUFLLGNBQWMsT0FBTyxLQUFLLEdBQUcsT0FBTyxJQUFJLGFBQWE7QUFBRztBQUVwRSxRQUFNLGNBQWMsU0FBUyxjQUFjLGtCQUFrQjtBQUU3RCxNQUFJLENBQUM7QUFBYSxXQUFPLEdBQUcsT0FBTyx3Q0FBd0MsRUFBRSxNQUFNLFFBQVEsQ0FBQztBQUU1RixRQUFNLG9CQUFvQixLQUFLO0FBQUEsS0FFdEIsTUFBTSxJQUFJLEdBQUcsSUFBSSxFQUFFLElBQUk7QUFBQSxNQUNwQixRQUFRO0FBQUEsTUFDUixlQUFlO0FBQUEsTUFDZixNQUFNO0FBQUEsTUFDTixRQUFRO0FBQUEsTUFDUixTQUFTO0FBQUEsTUFDVCxRQUFRO0FBQUEsSUFDWixDQUFDLEdBQ0gsTUFBTSxRQUFRLENBQUMsR0FBRyxZQUFZLENBQUMsR0FBRyxPQUFPLE1BQU0sV0FBVztBQUFBLEVBQ2hFO0FBRUEsUUFBTSxZQUFZLEdBQUcsT0FBTyxJQUFJLFlBQVk7QUFDNUMsUUFBTSxrQkFBa0IsR0FBRyxNQUFNLFlBQVksU0FBUztBQUV0RCxNQUFJLENBQUM7QUFBaUIsV0FBTyxHQUFHLE9BQU8sK0JBQStCLEVBQUUsTUFBTSxRQUFRLENBQUM7QUFFdkYsUUFBTSxXQUFZLE1BQU0sSUFBSSxHQUFHLElBQUksRUFBRSxJQUFJLEVBQUUs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QyxDQUFDLElBQUksY0FBYyxNQUFNLENBQUMsQ0FBQyxjQUFjLEVBQUUsS0FBSyxXQUFXLENBQUMsSUFDdkssTUFDQTtBQUFBLE1BQ1YsRUFDQyxPQUFPLE9BQU8sRUFDckIsS0FBSyxDQUFDLEdBQUcsTUFBTSxFQUFFLFlBQVksRUFBRSxjQUFjLEVBQUUsWUFBWSxDQUFDLENBQUM7QUFFL0QsWUFBTSx1QkFBdUIsT0FBTyxRQUFRLGlCQUFpQixFQUN4RCxRQUFRLENBQUMsQ0FBQyxLQUFLLFNBQVMsTUFBTSxDQUFDLEtBQUssR0FBRyxTQUFTLENBQUMsRUFDakQsSUFBSSxDQUFDLGtCQUFtQixJQUFJLE9BQU8sVUFBVSxjQUFjLENBQUMsRUFBRSxZQUFZLENBQUMsR0FBRyxjQUFjLENBQUMsQ0FBQyxJQUFJLGNBQWMsTUFBTSxDQUFDLENBQUMsY0FBYyxFQUFFLEtBQUssV0FBVyxJQUFJLGdCQUFnQixJQUFLLEVBQ2pMLE9BQU8sT0FBTztBQUVuQiwyQkFBcUIsT0FBTztBQUFBLFFBQ3hCLHFCQUNLLElBQUksQ0FBQyxRQUFRO0FBQ1YsZ0JBQU0sUUFBUSxJQUFJLE9BQU8sVUFBVSxJQUFJLENBQUMsRUFBRSxZQUFZLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxJQUFJLElBQUksTUFBTSxDQUFDLENBQUMsaUJBQWlCLEVBQUUsS0FBSyxXQUFXO0FBRW5ILGdCQUFNLFNBQVMsT0FBTyxRQUFRLGlCQUFpQixFQUFFLEtBQUssQ0FBQyxDQUFDLFVBQVUsU0FBUyxNQUFNLENBQUMsVUFBVSxHQUFHLFNBQVMsRUFBRSxTQUFTLEdBQUcsQ0FBQyxJQUFJLENBQUM7QUFFNUgsaUJBQU8sUUFBUSxDQUFDLFFBQVEsTUFBTSxDQUFDLENBQUMsSUFBSTtBQUFBLFFBQ3hDLENBQUMsRUFDQSxPQUFPLE9BQU87QUFBQSxNQUN2QjtBQUNBLHFCQUFlO0FBQUEsUUFDWCxZQUFZLE1BQU0sNkJBQTZCLElBQUksQ0FBQztBQUFBLFFBQ3BELFlBQVksTUFBTSxzQkFBc0IsSUFBSSxDQUFDO0FBQUEsUUFDN0MsWUFBWSxNQUFNLHlCQUF5QixJQUFJLENBQUM7QUFBQSxRQUNoRCxZQUFZLE1BQU0scUJBQXFCLElBQUksQ0FBQztBQUFBLFFBQzVDLEdBQUksWUFBWSxNQUFNLHdCQUF3QixLQUFLLENBQUM7QUFBQSxNQUN4RCxFQUNLLE9BQU8sT0FBTyxFQUNkLEtBQUssSUFBSTtBQUVkLFVBQUk7QUFBbUIsc0JBQWMsU0FBUyxrQkFBa0IsV0FBVyxLQUFLLEdBQUcsQ0FBQztBQUFBO0FBQy9FLFdBQUcsT0FBTyxtQ0FBbUMsRUFBRSxNQUFNLFFBQVEsQ0FBQztBQUNuRSxnQkFBVSxTQUFTLGVBQWU7QUFFbEMsb0JBQWM7QUFBQSxJQUNsQjtBQUFBLEVBQ0o7QUFDSixDQUFDOyIsCiAgIm5hbWVzIjogWyJkYXRhIiwgImVycm9yQ29kZSIsICJlcnJvckluZm8iLCAib3V0cHV0Il0KfQo=
