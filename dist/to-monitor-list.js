// <pre>
// Note: This script was compiled and minified from TypeScript. For a more readable version, see https://github.com/Eejit43/wikipedia-scripts/blob/main/scripts/to-monitor-list.ts

"use strict";(()=>{var a=new mw.Api;async function l(c){return(await a.get({action:"query",formatversion:"2",prop:"revisions",rvprop:"content",rvslots:"main",titles:c})).query.pages[0].revisions?.[0].slots.main.content.trim()}var o=class{link;toCheck;totalToCheck;isRunning=!1;handledRequests=0;load(){mw.util.addCSS(`
.to-monitor-list-count {
    cursor: pointer;
}`);let i=document.querySelector(".mw-editsection").cloneNode(!0);this.link=document.createElement("a"),this.link.href="#",this.link.style.fontWeight="bold",this.link.textContent="Add missing counts",this.link.addEventListener("click",async r=>{if(r.preventDefault(),!this.isRunning){this.isRunning=!0;for(let e of document.querySelectorAll(".to-monitor-list-count"))e.id&&(e.innerHTML='<span style="color: #ed8e07; font-weight: bold">?</span>');await this.loadToCheckData();for(let e of this.toCheck.categories)this.handleCheck(e,async()=>{let t=await a.get({action:"query",list:"search",srinfo:"totalhits",srnamespace:this.getCategory(e),srsearch:`incategory:"${e.category}"`}).catch((s,n)=>(mw.notify(`An error occurred while trying to get category members: ${n?.error?.info??"Unknown error"} (${s})`,{type:"error"}),null));if(t)return t.query.searchinfo.totalhits});for(let e of this.toCheck.searches)this.handleCheck(e,async()=>{let t=await a.get({action:"query",list:"search",srinfo:"totalhits",srnamespace:this.getCategory(e),srsearch:e.search}).catch((s,n)=>(mw.notify(`An error occurred while trying to get search results: ${n?.error?.info??"Unknown error"} (${s})`,{type:"error"}),null));if(t)return t.query.searchinfo.totalhits});for(let e of this.toCheck.whatLinksHere)this.handleCheck(e,async()=>{let t=await a.get({action:"query",list:"backlinks",bllimit:500,blnamespace:this.getCategory(e),bltitle:e.title}).catch((s,n)=>(mw.notify(`An error occurred while trying to get backlinks: ${n?.error?.info??"Unknown error"} (${s})`,{type:"error"}),null));if(t)return t.query.backlinks.length});for(let e of this.toCheck.transclusions)this.handleCheck(e,async()=>{let t=await a.get({action:"query",list:"embeddedin",eilimit:500,einamespace:this.getCategory(e),eititle:e.title}).catch((s,n)=>(mw.notify(`An error occurred while trying to get transclusions: ${n?.error?.info??"Unknown error"} (${s})`,{type:"error"}),null));if(t)return t.query.embeddedin.length})}}),i.querySelector("a").replaceWith(this.link),document.querySelector("h2#Stuff_to_monitor + .mw-editsection").after(i);for(let r of document.querySelectorAll(".to-monitor-list-count"))r.addEventListener("click",()=>{r.innerHTML='<span style="color: #00733f">None</span>'})}async loadToCheckData(){this.toCheck=JSON.parse(await l("User:Eejit43/scripts/to-monitor-list.json")??"{}"),this.totalToCheck=Object.values(this.toCheck).flat().length}async handleCheck(i,r){let e=await r();if(e===void 0)return;let t=document.querySelector(`#to-monitor-list-${i.id}`);if(!t)return mw.notify(`Failed to find element for ID "${i.id}"`);t.innerHTML=e===0?'<span style="color: #00733f">None</span>':`<b><span style="color: #bd2828">${e===500?"500+":e}</span></b>`,this.handledRequests++,this.link.textContent=`Add missing counts (${this.handledRequests}/${this.totalToCheck} loaded)`,this.handledRequests===this.totalToCheck&&setTimeout(()=>{this.isRunning=!1,this.handledRequests=0,this.link.textContent="Add missing counts"},1e3)}getCategory({namespaces:i,notNamespaces:r}){if(!i&&!r)return 0;if(i){let e=i.map(t=>Object.entries(mw.config.get("wgFormattedNamespaces")).find(([,s])=>s===t)).filter(Boolean);return e.length>0?e.map(t=>Number.parseInt(t[0])):0}else return Object.entries(mw.config.get("wgFormattedNamespaces")).filter(([,e])=>!r.includes(e||"Article")).map(([e])=>Number.parseInt(e))}};mw.loader.using(["mediawiki.util"],()=>{mw.config.get("wgPageName")==="User:Eejit43"&&new o().load()});})();

// </pre>
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vdXRpbGl0eS50cyIsICIuLi9zY3JpcHRzL3RvLW1vbml0b3ItbGlzdC50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHR5cGUgeyBBcGlRdWVyeVJldmlzaW9uc1BhcmFtcyB9IGZyb20gJ3R5cGVzLW1lZGlhd2lraS1hcGknO1xuaW1wb3J0IHR5cGUgeyBQYWdlUmV2aXNpb25zUmVzdWx0IH0gZnJvbSAnLi9nbG9iYWwtdHlwZXMnO1xuXG5leHBvcnQgY29uc3QgYXBpID0gbmV3IG13LkFwaSgpO1xuXG4vKipcbiAqIEZldGNoZXMgdGhlIGNvbnRlbnQgb2YgYSBnaXZlbiBwYWdlLlxuICogQHBhcmFtIHRpdGxlIFRoZSB0aXRsZSB0byBmZXRjaC5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFBhZ2VDb250ZW50KHRpdGxlOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gKFxuICAgICAgICAoYXdhaXQgYXBpLmdldCh7XG4gICAgICAgICAgICBhY3Rpb246ICdxdWVyeScsXG4gICAgICAgICAgICBmb3JtYXR2ZXJzaW9uOiAnMicsXG4gICAgICAgICAgICBwcm9wOiAncmV2aXNpb25zJyxcbiAgICAgICAgICAgIHJ2cHJvcDogJ2NvbnRlbnQnLFxuICAgICAgICAgICAgcnZzbG90czogJ21haW4nLFxuICAgICAgICAgICAgdGl0bGVzOiB0aXRsZSxcbiAgICAgICAgfSBzYXRpc2ZpZXMgQXBpUXVlcnlSZXZpc2lvbnNQYXJhbXMpKSBhcyBQYWdlUmV2aXNpb25zUmVzdWx0XG4gICAgKS5xdWVyeS5wYWdlc1swXS5yZXZpc2lvbnM/LlswXS5zbG90cy5tYWluLmNvbnRlbnQudHJpbSgpO1xufVxuIiwgImltcG9ydCB0eXBlIHsgQmFja2xpbmtzUmVzdWx0LCBFbWJlZGRlZGluUmVzdWx0LCBNZWRpYVdpa2lEYXRhRXJyb3IsIFNlYXJjaFJlc3VsdCB9IGZyb20gJ0AvZ2xvYmFsLXR5cGVzJztcbmltcG9ydCB7IGFwaSwgZ2V0UGFnZUNvbnRlbnQgfSBmcm9tICdAL3V0aWxpdHknO1xuaW1wb3J0IHR5cGUgeyBBcGlRdWVyeUJhY2tsaW5rc1BhcmFtcywgQXBpUXVlcnlTZWFyY2hQYXJhbXMgfSBmcm9tICd0eXBlcy1tZWRpYXdpa2ktYXBpJztcblxuaW50ZXJmYWNlIFNlYXJjaERhdGEge1xuICAgIGNhdGVnb3JpZXM6IHsgaWQ6IHN0cmluZzsgY2F0ZWdvcnk6IHN0cmluZzsgbmFtZXNwYWNlcz86IHN0cmluZ1tdOyBub3ROYW1lc3BhY2VzPzogc3RyaW5nW10gfVtdO1xuICAgIHNlYXJjaGVzOiB7IGlkOiBzdHJpbmc7IHNlYXJjaDogc3RyaW5nOyBuYW1lc3BhY2VzPzogc3RyaW5nW107IG5vdE5hbWVzcGFjZXM/OiBzdHJpbmdbXSB9W107XG4gICAgd2hhdExpbmtzSGVyZTogeyBpZDogc3RyaW5nOyB0aXRsZTogc3RyaW5nOyBuYW1lc3BhY2VzPzogc3RyaW5nW107IG5vdE5hbWVzcGFjZXM/OiBzdHJpbmdbXSB9W107XG4gICAgdHJhbnNjbHVzaW9uczogeyBpZDogc3RyaW5nOyB0aXRsZTogc3RyaW5nOyBuYW1lc3BhY2VzPzogc3RyaW5nW107IG5vdE5hbWVzcGFjZXM/OiBzdHJpbmdbXSB9W107XG59XG5cbnR5cGUgU2VhcmNoRGF0YUNoZWNrID0gU2VhcmNoRGF0YVtrZXlvZiBTZWFyY2hEYXRhXVswXTtcblxuLyoqXG4gKiBBbiBpbnN0YW5jZSBvZiB0aGlzIGNsYXNzIGhhbmRsZXMgdGhlIGVudGlyZSBmdW5jdGlvbmFsaXR5IG9mIHRoZSB0by1tb25pdG9yLWxpc3Qgc2NyaXB0LlxuICovXG5jbGFzcyBNb25pdG9yaW5nTGlzdE1hbmFnZXIge1xuICAgIHByaXZhdGUgbGluayE6IEhUTUxBbmNob3JFbGVtZW50O1xuXG4gICAgcHJpdmF0ZSB0b0NoZWNrITogU2VhcmNoRGF0YTtcbiAgICBwcml2YXRlIHRvdGFsVG9DaGVjayE6IG51bWJlcjtcblxuICAgIHByaXZhdGUgaXNSdW5uaW5nID0gZmFsc2U7XG5cbiAgICBwcml2YXRlIGhhbmRsZWRSZXF1ZXN0cyA9IDA7XG5cbiAgICAvKipcbiAgICAgKiBMb2FkcyB0aGUgXCJBZGQgbWlzc2luZyBjb3VudHNcIiBsaW5rIGVsZW1lbnQuXG4gICAgICovXG4gICAgcHVibGljIGxvYWQoKSB7XG4gICAgICAgIG13LnV0aWwuYWRkQ1NTKGBcbi50by1tb25pdG9yLWxpc3QtY291bnQge1xuICAgIGN1cnNvcjogcG9pbnRlcjtcbn1gKTtcblxuICAgICAgICBjb25zdCBmdWxsTGlua0VsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubXctZWRpdHNlY3Rpb24nKSEuY2xvbmVOb2RlKHRydWUpIGFzIEhUTUxTcGFuRWxlbWVudDtcblxuICAgICAgICB0aGlzLmxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XG4gICAgICAgIHRoaXMubGluay5ocmVmID0gJyMnO1xuICAgICAgICB0aGlzLmxpbmsuc3R5bGUuZm9udFdlaWdodCA9ICdib2xkJztcbiAgICAgICAgdGhpcy5saW5rLnRleHRDb250ZW50ID0gJ0FkZCBtaXNzaW5nIGNvdW50cyc7XG4gICAgICAgIHRoaXMubGluay5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jIChldmVudCkgPT4ge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuaXNSdW5uaW5nKSByZXR1cm47XG4gICAgICAgICAgICB0aGlzLmlzUnVubmluZyA9IHRydWU7XG5cbiAgICAgICAgICAgIGZvciAoY29uc3QgZWxlbWVudCBvZiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcudG8tbW9uaXRvci1saXN0LWNvdW50JykpXG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuaWQpIGVsZW1lbnQuaW5uZXJIVE1MID0gJzxzcGFuIHN0eWxlPVwiY29sb3I6ICNlZDhlMDc7IGZvbnQtd2VpZ2h0OiBib2xkXCI+Pzwvc3Bhbj4nO1xuXG4gICAgICAgICAgICBhd2FpdCB0aGlzLmxvYWRUb0NoZWNrRGF0YSgpO1xuXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGNoZWNrIG9mIHRoaXMudG9DaGVjay5jYXRlZ29yaWVzKVxuICAgICAgICAgICAgICAgIHZvaWQgdGhpcy5oYW5kbGVDaGVjayhjaGVjaywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gKGF3YWl0IGFwaVxuICAgICAgICAgICAgICAgICAgICAgICAgLmdldCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAncXVlcnknLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3Q6ICdzZWFyY2gnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNyaW5mbzogJ3RvdGFsaGl0cycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3JuYW1lc3BhY2U6IHRoaXMuZ2V0Q2F0ZWdvcnkoY2hlY2spLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNyc2VhcmNoOiBgaW5jYXRlZ29yeTpcIiR7Y2hlY2suY2F0ZWdvcnl9XCJgLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSBzYXRpc2ZpZXMgQXBpUXVlcnlTZWFyY2hQYXJhbXMpXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKGVycm9yQ29kZSwgZXJyb3JJbmZvKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbXcubm90aWZ5KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgQW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgdHJ5aW5nIHRvIGdldCBjYXRlZ29yeSBtZW1iZXJzOiAkeyhlcnJvckluZm8gYXMgTWVkaWFXaWtpRGF0YUVycm9yKT8uZXJyb3I/LmluZm8gPz8gJ1Vua25vd24gZXJyb3InfSAoJHtlcnJvckNvZGV9KWAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgdHlwZTogJ2Vycm9yJyB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KSkgYXMgU2VhcmNoUmVzdWx0IHwgbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFkYXRhKSByZXR1cm47XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEucXVlcnkhLnNlYXJjaGluZm8udG90YWxoaXRzO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGNoZWNrIG9mIHRoaXMudG9DaGVjay5zZWFyY2hlcylcbiAgICAgICAgICAgICAgICB2b2lkIHRoaXMuaGFuZGxlQ2hlY2soY2hlY2ssIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IChhd2FpdCBhcGlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5nZXQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3F1ZXJ5JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0OiAnc2VhcmNoJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcmluZm86ICd0b3RhbGhpdHMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNybmFtZXNwYWNlOiB0aGlzLmdldENhdGVnb3J5KGNoZWNrKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcnNlYXJjaDogY2hlY2suc2VhcmNoLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSBzYXRpc2ZpZXMgQXBpUXVlcnlTZWFyY2hQYXJhbXMpXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKGVycm9yQ29kZSwgZXJyb3JJbmZvKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbXcubm90aWZ5KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgQW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgdHJ5aW5nIHRvIGdldCBzZWFyY2ggcmVzdWx0czogJHsoZXJyb3JJbmZvIGFzIE1lZGlhV2lraURhdGFFcnJvcik/LmVycm9yPy5pbmZvID8/ICdVbmtub3duIGVycm9yJ30gKCR7ZXJyb3JDb2RlfSlgLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IHR5cGU6ICdlcnJvcicgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSkpIGFzIFNlYXJjaFJlc3VsdCB8IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIGlmICghZGF0YSkgcmV0dXJuO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhLnF1ZXJ5IS5zZWFyY2hpbmZvLnRvdGFsaGl0cztcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZm9yIChjb25zdCBjaGVjayBvZiB0aGlzLnRvQ2hlY2sud2hhdExpbmtzSGVyZSlcbiAgICAgICAgICAgICAgICB2b2lkIHRoaXMuaGFuZGxlQ2hlY2soY2hlY2ssIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IChhd2FpdCBhcGlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5nZXQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3F1ZXJ5JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0OiAnYmFja2xpbmtzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBibGxpbWl0OiA1MDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxuYW1lc3BhY2U6IHRoaXMuZ2V0Q2F0ZWdvcnkoY2hlY2spLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsdGl0bGU6IGNoZWNrLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSBzYXRpc2ZpZXMgQXBpUXVlcnlCYWNrbGlua3NQYXJhbXMpXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKGVycm9yQ29kZSwgZXJyb3JJbmZvKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbXcubm90aWZ5KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgQW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgdHJ5aW5nIHRvIGdldCBiYWNrbGlua3M6ICR7KGVycm9ySW5mbyBhcyBNZWRpYVdpa2lEYXRhRXJyb3IpPy5lcnJvcj8uaW5mbyA/PyAnVW5rbm93biBlcnJvcid9ICgke2Vycm9yQ29kZX0pYCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyB0eXBlOiAnZXJyb3InIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pKSBhcyBCYWNrbGlua3NSZXN1bHQgfCBudWxsO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWRhdGEpIHJldHVybjtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YS5xdWVyeSEuYmFja2xpbmtzLmxlbmd0aDtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZm9yIChjb25zdCBjaGVjayBvZiB0aGlzLnRvQ2hlY2sudHJhbnNjbHVzaW9ucylcbiAgICAgICAgICAgICAgICB2b2lkIHRoaXMuaGFuZGxlQ2hlY2soY2hlY2ssIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IChhd2FpdCBhcGlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5nZXQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3F1ZXJ5JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0OiAnZW1iZWRkZWRpbicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWlsaW1pdDogNTAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVpbmFtZXNwYWNlOiB0aGlzLmdldENhdGVnb3J5KGNoZWNrKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlaXRpdGxlOiBjaGVjay50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gc2F0aXNmaWVzIEFwaVF1ZXJ5QmFja2xpbmtzUGFyYW1zKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKChlcnJvckNvZGUsIGVycm9ySW5mbykgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG13Lm5vdGlmeShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYEFuIGVycm9yIG9jY3VycmVkIHdoaWxlIHRyeWluZyB0byBnZXQgdHJhbnNjbHVzaW9uczogJHsoZXJyb3JJbmZvIGFzIE1lZGlhV2lraURhdGFFcnJvcik/LmVycm9yPy5pbmZvID8/ICdVbmtub3duIGVycm9yJ30gKCR7ZXJyb3JDb2RlfSlgLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IHR5cGU6ICdlcnJvcicgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSkpIGFzIEVtYmVkZGVkaW5SZXN1bHQgfCBudWxsO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWRhdGEpIHJldHVybjtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YS5xdWVyeSEuZW1iZWRkZWRpbi5sZW5ndGg7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGZ1bGxMaW5rRWxlbWVudC5xdWVyeVNlbGVjdG9yKCdhJykhLnJlcGxhY2VXaXRoKHRoaXMubGluayk7XG5cbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaDIjU3R1ZmZfdG9fbW9uaXRvciArIC5tdy1lZGl0c2VjdGlvbicpIS5hZnRlcihmdWxsTGlua0VsZW1lbnQpO1xuXG4gICAgICAgIGZvciAoY29uc3QgZWxlbWVudCBvZiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcudG8tbW9uaXRvci1saXN0LWNvdW50JykpXG4gICAgICAgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuaW5uZXJIVE1MID0gJzxzcGFuIHN0eWxlPVwiY29sb3I6ICMwMDczM2ZcIj5Ob25lPC9zcGFuPic7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBMb2FkcyB0aGUgZGF0YSBvZiBjaGVja3MgdG8gaGFuZGxlLlxuICAgICAqL1xuICAgIHB1YmxpYyBhc3luYyBsb2FkVG9DaGVja0RhdGEoKSB7XG4gICAgICAgIHRoaXMudG9DaGVjayA9IEpTT04ucGFyc2UoKGF3YWl0IGdldFBhZ2VDb250ZW50KCdVc2VyOkVlaml0NDMvc2NyaXB0cy90by1tb25pdG9yLWxpc3QuanNvbicpKSA/PyAne30nKSBhcyBTZWFyY2hEYXRhO1xuXG4gICAgICAgIHRoaXMudG90YWxUb0NoZWNrID0gT2JqZWN0LnZhbHVlcyh0aGlzLnRvQ2hlY2spLmZsYXQoKS5sZW5ndGg7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSGFuZGxlcyBhIGdpdmVuIGNoZWNrLlxuICAgICAqIEBwYXJhbSBjaGVjayBUaGUgY2hlY2sgZGF0YSB0byBoYW5kbGUuXG4gICAgICogQHBhcmFtIGhhbmRsZXIgVGhlIGhhbmRsZXIgdG8gZmluZCB0aGUgY291bnQgZnJvbSBhIGNoZWNrLlxuICAgICAqL1xuICAgIHByaXZhdGUgYXN5bmMgaGFuZGxlQ2hlY2soY2hlY2s6IFNlYXJjaERhdGFDaGVjaywgaGFuZGxlcjogKCkgPT4gUHJvbWlzZTxudW1iZXIgfCB1bmRlZmluZWQ+KSB7XG4gICAgICAgIGNvbnN0IGNvdW50ID0gYXdhaXQgaGFuZGxlcigpO1xuICAgICAgICBpZiAoY291bnQgPT09IHVuZGVmaW5lZCkgcmV0dXJuO1xuXG4gICAgICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjdG8tbW9uaXRvci1saXN0LSR7Y2hlY2suaWR9YCk7XG4gICAgICAgIGlmICghZWxlbWVudCkgcmV0dXJuIG13Lm5vdGlmeShgRmFpbGVkIHRvIGZpbmQgZWxlbWVudCBmb3IgSUQgXCIke2NoZWNrLmlkfVwiYCk7XG4gICAgICAgIGVsZW1lbnQuaW5uZXJIVE1MID1cbiAgICAgICAgICAgIGNvdW50ID09PSAwXG4gICAgICAgICAgICAgICAgPyAnPHNwYW4gc3R5bGU9XCJjb2xvcjogIzAwNzMzZlwiPk5vbmU8L3NwYW4+J1xuICAgICAgICAgICAgICAgIDogYDxiPjxzcGFuIHN0eWxlPVwiY29sb3I6ICNiZDI4MjhcIj4ke2NvdW50ID09PSA1MDAgPyAnNTAwKycgOiBjb3VudH08L3NwYW4+PC9iPmA7XG5cbiAgICAgICAgdGhpcy5oYW5kbGVkUmVxdWVzdHMrKztcbiAgICAgICAgdGhpcy5saW5rLnRleHRDb250ZW50ID0gYEFkZCBtaXNzaW5nIGNvdW50cyAoJHt0aGlzLmhhbmRsZWRSZXF1ZXN0c30vJHt0aGlzLnRvdGFsVG9DaGVja30gbG9hZGVkKWA7XG5cbiAgICAgICAgaWYgKHRoaXMuaGFuZGxlZFJlcXVlc3RzID09PSB0aGlzLnRvdGFsVG9DaGVjaylcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNSdW5uaW5nID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZWRSZXF1ZXN0cyA9IDA7XG4gICAgICAgICAgICAgICAgdGhpcy5saW5rLnRleHRDb250ZW50ID0gJ0FkZCBtaXNzaW5nIGNvdW50cyc7XG4gICAgICAgICAgICB9LCAxMDAwKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBQYXJzZXMgdGhlIHNlYXJjaGVkIGNhdGVnb3JpZXMgZnJvbSB0aGUgY2hlY2sgb2JqZWN0LlxuICAgICAqIEBwYXJhbSBjaGVjayBUaGUgY2hlY2sgb2JqZWN0LlxuICAgICAqIEBwYXJhbSBjaGVjay5uYW1lc3BhY2VzIFRoZSBuYW1lc3BhY2UgdG8gc2VhcmNoIGluLlxuICAgICAqIEBwYXJhbSBjaGVjay5ub3ROYW1lc3BhY2VzIFRoZSBuYW1lc3BhY2VzIHRvIGV4Y2x1ZGUgZnJvbSB0aGUgc2VhcmNoLlxuICAgICAqIEByZXR1cm5zIFRoZSBjYXRlZ29yeSBJRCBvciBhcnJheSBvZiBjYXRlZ29yeSBJRHMuXG4gICAgICovXG4gICAgcHJpdmF0ZSBnZXRDYXRlZ29yeSh7IG5hbWVzcGFjZXMsIG5vdE5hbWVzcGFjZXMgfTogeyBuYW1lc3BhY2VzPzogc3RyaW5nW107IG5vdE5hbWVzcGFjZXM/OiBzdHJpbmdbXSB9KSB7XG4gICAgICAgIGlmICghbmFtZXNwYWNlcyAmJiAhbm90TmFtZXNwYWNlcykgcmV0dXJuIDA7XG4gICAgICAgIGVsc2UgaWYgKG5hbWVzcGFjZXMpIHtcbiAgICAgICAgICAgIGNvbnN0IGZvdW5kTmFtZXNwYWNlcyA9IG5hbWVzcGFjZXNcbiAgICAgICAgICAgICAgICAubWFwKChuYW1lc3BhY2UpID0+XG4gICAgICAgICAgICAgICAgICAgIE9iamVjdC5lbnRyaWVzKG13LmNvbmZpZy5nZXQoJ3dnRm9ybWF0dGVkTmFtZXNwYWNlcycpKS5maW5kKChbLCBuYW1lc3BhY2VOYW1lXSkgPT4gbmFtZXNwYWNlTmFtZSA9PT0gbmFtZXNwYWNlKSxcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKSBhcyBbc3RyaW5nLCBzdHJpbmddW107XG5cbiAgICAgICAgICAgIHJldHVybiBmb3VuZE5hbWVzcGFjZXMubGVuZ3RoID4gMCA/IGZvdW5kTmFtZXNwYWNlcy5tYXAoKGZvdW5kTmFtZXNwYWNlKSA9PiBOdW1iZXIucGFyc2VJbnQoZm91bmROYW1lc3BhY2VbMF0pKSA6IDA7XG4gICAgICAgIH0gZWxzZVxuICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5lbnRyaWVzKG13LmNvbmZpZy5nZXQoJ3dnRm9ybWF0dGVkTmFtZXNwYWNlcycpKVxuICAgICAgICAgICAgICAgIC5maWx0ZXIoKFssIG5hbWVzcGFjZU5hbWVdKSA9PiAhbm90TmFtZXNwYWNlcyEuaW5jbHVkZXMobmFtZXNwYWNlTmFtZSB8fCAnQXJ0aWNsZScpKVxuICAgICAgICAgICAgICAgIC5tYXAoKFtuYW1lc3BhY2VJZF0pID0+IE51bWJlci5wYXJzZUludChuYW1lc3BhY2VJZCkpO1xuICAgIH1cbn1cblxubXcubG9hZGVyLnVzaW5nKFsnbWVkaWF3aWtpLnV0aWwnXSwgKCkgPT4ge1xuICAgIGlmIChtdy5jb25maWcuZ2V0KCd3Z1BhZ2VOYW1lJykgPT09ICdVc2VyOkVlaml0NDMnKSBuZXcgTW9uaXRvcmluZ0xpc3RNYW5hZ2VyKCkubG9hZCgpO1xufSk7XG4iXSwKICAibWFwcGluZ3MiOiAiOzs7bUJBR08sSUFBTUEsRUFBTSxJQUFJLEdBQUcsSUFNMUIsZUFBc0JDLEVBQWVDLEVBQWUsQ0FDaEQsT0FDSyxNQUFNRixFQUFJLElBQUksQ0FDWCxPQUFRLFFBQ1IsY0FBZSxJQUNmLEtBQU0sWUFDTixPQUFRLFVBQ1IsUUFBUyxPQUNULE9BQVFFLENBQ1osQ0FBbUMsR0FDckMsTUFBTSxNQUFNLENBQUMsRUFBRSxZQUFZLENBQUMsRUFBRSxNQUFNLEtBQUssUUFBUSxLQUFLLENBQzVELENDSkEsSUFBTUMsRUFBTixLQUE0QixDQUNoQixLQUVBLFFBQ0EsYUFFQSxVQUFZLEdBRVosZ0JBQWtCLEVBS25CLE1BQU8sQ0FDVixHQUFHLEtBQUssT0FBTztBQUFBO0FBQUE7QUFBQSxFQUdyQixFQUVNLElBQU1DLEVBQWtCLFNBQVMsY0FBYyxpQkFBaUIsRUFBRyxVQUFVLEVBQUks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LEtBQ0ksUUFBTyxPQUFPLFFBQVEsR0FBRyxPQUFPLElBQUksdUJBQXVCLENBQUMsRUFDdkQsT0FBTyxDQUFDLENBQUMsQ0FBRUQsQ0FBYSxJQUFNLENBQUNILEVBQWUsU0FBU0csR0FBaUIsU0FBUyxDQUFDLEVBQ2xGLElBQUksQ0FBQyxDQUFDRSxDQUFXLElBQU0sT0FBTyxTQUFTQSxDQUFXLENBQUMsQ0FDaEUsQ0FDSixFQUVBLEdBQUcsT0FBTyxNQUFNLENBQUMsZ0JBQWdCLEVBQUcsSUFBTSxDQUNsQyxHQUFHLE9BQU8sSUFBSSxZQUFZLElBQU0sZ0JBQWdCLElBQUlsQixFQUFzQixFQUFFLEtBQUssQ0FDekYsQ0FBQyIsCiAgIm5hbWVzIjogWyJhcGkiLCAiZ2V0UGFnZUNvbnRlbnQiLCAidGl0bGUiLCAiTW9uaXRvcmluZ0xpc3RNYW5hZ2VyIiwgImZ1bGxMaW5rRWxlbWVudCIsICJldmVudCIsICJlbGVtZW50IiwgImNoZWNrIiwgImRhdGEiLCAiYXBpIiwgImVycm9yQ29kZSIsICJlcnJvckluZm8iLCAiZ2V0UGFnZUNvbnRlbnQiLCAiaGFuZGxlciIsICJjb3VudCIsICJuYW1lc3BhY2VzIiwgIm5vdE5hbWVzcGFjZXMiLCAiZm91bmROYW1lc3BhY2VzIiwgIm5hbWVzcGFjZSIsICJuYW1lc3BhY2VOYW1lIiwgImZvdW5kTmFtZXNwYWNlIiwgIm5hbWVzcGFjZUlkIl0KfQo=
